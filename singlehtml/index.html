
<!-- This layout has been taken from http://globus.org/provision/ -->


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>FutureGrid 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="None" href="index.html#document-index" /> 
  </head>
  <body>

	
<div style="background-image:url('_static/header_bg.png');background-color: #2E2E2E; text-align: left; padding: 10px 10px 15px 35px">
<table>
  <tr>
    <td>
      <a href="index.html#document-index"><img src="_static/fg-logo-grid.png" border="0" alt="FutureGrid Rain"/></a>
    </td>
    <td>
      <font size="5" color="white"><b><i>FutureGrid</i></b></font><br><br>
      <font size="10" color="white" face="Comic Sans MS"><b><i>Rain</i></b></font>
    </td>
  </tr>
</table>

</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html#document-index">Home</a>|&nbsp;</li>
        <li><a href="index.html#document-whatis">What is it?</a>|&nbsp;</li>
        <li><a href="index.html#document-quickstart">Quickstart</a>|&nbsp;</li>
        <li><a href="index.html#document-documentation">Documentation</a>|&nbsp;</li>
        <li><a href="index.html#document-download">Download</a>|&nbsp;</li>
        <li><a href="index.html#document-support">Support</a>|&nbsp;</li>
        <li><a href="https://portal.futuregrid.org/">Portal</a>|&nbsp;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html#document-index">Table Of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-whatis">What is FutureGrid Rain?</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-quickstart">Rain QuickStart</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-documentation">Rain Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-download">Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-support">Support</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
<body style="background-image:url('_static/header_bg.png');background-color: grey;">
</body>

      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="welcome-to-futuregrid-rain">
<h1>Welcome to FutureGrid Rain!<a class="headerlink" href="#welcome-to-futuregrid-rain" title="Permalink to this headline">¶</a></h1>
<p>FutureGrid Rain is a tool that will allow users to place customized environments like virtual clusters or IaaS frameworks onto resources.
The process of raining goes beyond the services offered by existing scheduling tools due to its higher-level toolset targeting
virtualized and non-virtualized resources. Rain will be able to move resources from one infrastructure to another and compare the
execution of an experiment in the different supported infrastructures.</p>
<p>In order to support Rain we need a flexible image management framework. Thus, Rain includes the FutureGrid Image Management framework which
defines the full life cycle of the images in FutureGrid. It involves the process of creating, customizing,
storing, sharing and registering images for different FutureGrid environments.</p>
<p>This framework allows users to generate personalized abstract images by simply specifying a list of requirements such as OS, architecture,
software, and libraries. These images are generic enough that through manipulations they can be adapted for
several IaaS or HPC infrastructures with little effort by the users. It will support the management of images for
<a class="reference external" href="http://www.nimbusproject.org">Nimbus</a>, <a class="reference external" href="http://open.eucalyptus.com/">Eucalyptus</a>, <a class="reference external" href="http://www.openstack.org">OpenStack</a>,
<a class="reference external" href="http://www.opennebula.org">OpenNebula</a>, and bare-metal HPC infrastructures.</p>
<div class="toctree-wrapper compound">
<span id="document-whatis"></span><div class="section" id="what-is-futuregrid-rain">
<span id="chap-whatis"></span><h2>What is FutureGrid Rain?<a class="headerlink" href="#what-is-futuregrid-rain" title="Permalink to this headline">¶</a></h2>
<div class="section" id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<p>FutureGrid <em>Rain</em> is a tool that will allow users to place customized environments like virtual clusters or IaaS frameworks onto resources.
The process of raining goes beyond the services offered by existing scheduling tools due to its higher-level toolset targeting
virtualized and non-virtualized resources. Rain will be able to move resources from one infrastructure to another and compare the
execution of an experiment in the different supported infrastructures.</p>
<p>In order to support Rain we need a flexible <em>Image Management</em> framework. Thus, Rain includes the FutureGrid Image Management framework which
defines the full life cycle of the images in FutureGrid. It involves the process of creating, customizing, storing,
sharing, and registering images for different FG environments. To this end, we have several components to support the different tasks
involved. First, we have an <em>Image Generation</em> tool that creates and customizes images according to user requirements. The second component
is the <em>Image Repository</em>, which is in charge of storing, cataloging and sharing images. The last component is an <em>Image Registration</em> tool,
which prepares, uploads and registers images for specific environments, like HPC or cloud frameworks. It also decides if an image is secure
enough to be registered or if it needs additional security tests.</p>
<p>Image Management provides the low-level software needed to achieve Dynamic Provisioning and Rain. <em>Dynamic Provisioning</em> is in charge of
allocating machines with the requested image. The requested image must have been previously registered in the infrastructure. On the other
hand, <em>Rain</em> will be our highest level component that will use Dynamic Provisioning and Image Management to provide custom environments
that may or may not exist. Therefore, a Rain request may involve the creation, registration, and provision of one or more images in a set
of machines.</p>
</div>
<div class="section" id="rain">
<h3>Rain<a class="headerlink" href="#rain" title="Permalink to this headline">¶</a></h3>
<p>Due to the variety of services and limited resources provided in FG, it is necessary to enable a mechanism to provision
needed services onto resources. This includes also the assignment of resources to different IaaS or PaaS frameworks.</p>
<p>Rain makes it possible to compare the benefits of IaaS, PaaS performance issues, as well as evaluating which applications
can benefit from such environments and how they must be efficiently configured. As part of this process, we allow the
generation of abstract images and universal image registration with the various infrastructures including Nimbus, Eucalyptus,
OpenNebula, OpenStack, but also bare-metal via the HPC services.</p>
<p>It is one of the unique features about FutureGrid to provide an essential component to make comparisons between the different
infrastructures more easily possible. Rain will offers four main features:</p>
<ul class="simple">
<li>Create customized environments on demand.</li>
<li>Compare different infrastructures.</li>
<li>Move resources from one infrastructure to another by changing the image they are running plus doing needed changes in the framework.</li>
<li>Ease the system administrator burden for creating deployable images.</li>
</ul>
</div>
<div class="section" id="image-management">
<h3>Image Management<a class="headerlink" href="#image-management" title="Permalink to this headline">¶</a></h3>
<p>Image management is a key component in any modern compute infrastructure, regardless if used for virtualized or non-virtualized resources. We distinguish a number
of important processes that are integral part of the life-cycle management of images. They include (a) image creation and customization, (b) sharing the images via
a repository, (c) registering the image into the infrastructure, and (d) image instantiation. The problem of targeting not one, but multiple infrastructures amplifies
the need for tools supporting these processes. Without them, only the most experienced users will be able to manage them under great investment of time.</p>
<img alt="_images/end-to-end-image-management.png" class="align-center" src="_images/end-to-end-image-management.png" style="width: 600px; height: 350px;" />
</div>
<div class="section" id="image-generation">
<span id="sec-whatisimagegeneration"></span><h3>Image Generation<a class="headerlink" href="#image-generation" title="Permalink to this headline">¶</a></h3>
<p>The image generation provides the first step in our image management process allowing users to create images according to their specifications. Since FG is a testbed
that support different type of infrastructures like HPC or IaaS, the images created by this tool are not aimed to any specific environment. Thus, it is at the
registration time when the images are customized to be successfully integrated into the desired infrastructure. This clear separation between image generation
and registration provides a powerful model that allow us to independently increase the OS and infrastructures supported, respectively. Moreover, it
reduces the amount of images that we need to manage in the image repository and therefore the disk usage.</p>
<p>The flowchart depicted in the next figure shows the process followed to create an image.</p>
<img alt="_images/ImageGeneration_detail.png" class="align-center" src="_images/ImageGeneration_detail.png" style="width: 400px; height: 400px;" />
<p>Users initiate the process by specifying their requirements. These requirements can include the selection of the OS type,
version, architecture, software, services, and more. First, the image generation tool searches into the image repository to identify a base image to be cloned,
and if there is no good candidate, the base image is created from scratch. Once we have a base image, the image generation tool installs the software required by
the user. This software must be in the official OS repositories or in the FG software repository. The later contains software developed by the FG team or other
approved software. The installation procedure can be aided by Chef, a configuration management tool to ensure the software is installed and configured properly.
After updating the image, it is stored in the image repository and becomes available for registration into one of the supported infrastructures. Our tool is general
to deal with installation particularities of different operating systems and architectures.</p>
</div>
<div class="section" id="image-repository">
<span id="sec-imagerepo"></span><h3>Image Repository<a class="headerlink" href="#image-repository" title="Permalink to this headline">¶</a></h3>
<p>The image repository catalogs and stores images in a unified repository. It offers a common interface for distinguishing image types for different IaaS frameworks
but also bare-metal images. This allows us to include a diverse set of images contributed not only by the FG development team but also by the user community that
generates such images and wishes to share them. The images are augmented with information about the software stack installed on them including versions, libraries,
and available services. This information is maintained in the catalog and can be searched by users and/or other FG services. Users looking for a specific image can discover
available images fitting their needs using the catalog interface.</p>
<p>The information associated to the images is stored using the fields collected in the next table.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="9%" />
<col width="43%" />
<col width="27%" />
<col width="9%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Field Name</strong></td>
<td><strong>Type</strong></td>
<td><strong>Valid Values</strong></td>
<td><strong>Description</strong></td>
<td><strong>Access</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">imgId</span></tt></td>
<td>String</td>
<td>&nbsp;</td>
<td>Unique identifier</td>
<td>Read-Only</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">owner</span></tt></td>
<td>String</td>
<td>&nbsp;</td>
<td>Image&#8217;s owner</td>
<td>Read-Only</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">os</span></tt></td>
<td>String</td>
<td>&nbsp;</td>
<td>Operating system</td>
<td>Read-Write</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">arch</span></tt></td>
<td>String</td>
<td>&nbsp;</td>
<td>Architecture of the Image</td>
<td>Read-Write</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">description</span></tt></td>
<td>String</td>
<td>&nbsp;</td>
<td>Description of the image</td>
<td>Read-Write</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">tag</span></tt></td>
<td>String list</td>
<td>&nbsp;</td>
<td>Image&#8217;s keywords</td>
<td>Read-Write</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">vmType</span></tt></td>
<td>String</td>
<td>none, xen, kvm, virtualbox, vmware</td>
<td>Virtual machine type</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">imgType</span></tt></td>
<td>String</td>
<td>machine, kernel, eucalyptus, nimbus, opennebula, openstack</td>
<td>Aim of the image</td>
<td>Read-Write</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">permission</span></tt></td>
<td>String</td>
<td>public, private</td>
<td>Access permission to the image</td>
<td>Read-Write</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">imgStatus</span></tt></td>
<td>String</td>
<td>available, locked</td>
<td>Status of the image</td>
<td>Read-Write</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">createdDate</span></tt></td>
<td>Date</td>
<td>&nbsp;</td>
<td>Upload date</td>
<td>Read-Only</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">lastAccess</span></tt></td>
<td>Date</td>
<td>&nbsp;</td>
<td>Last time the image was accessed</td>
<td>Read-Only</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">accessCount</span></tt></td>
<td>Long</td>
<td>&nbsp;</td>
<td># times the image has been accessed</td>
<td>Read-Only</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">size</span></tt></td>
<td>Long</td>
<td>&nbsp;</td>
<td>Size of the image</td>
<td>Read-Only</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="section" id="image-registration">
<span id="sec-whatisimageregistration"></span><h3>Image Registration<a class="headerlink" href="#image-registration" title="Permalink to this headline">¶</a></h3>
<p>Once the image has been created and stored into the repository, we need to register it into the targeted infrastructure before we can instantiate it. Users
requirements are simply the image, the targeted infrastructure and the kernel. The kernel is an optional requirement that allows advance users to select
the most appropriate kernel for their experiments. This tool provides a list of available kernels organized by infrastructure. Nevertheless, users may request
support for other kernels like one customized by them. Registering an image also includes the process of adapting it for the infrastructure. Often we find
differences between them requiring us to provide further customizations, security check, the upload of the image to the infrastructure repository, and registering
it. The process of adaptation and registration is depicted in Figure 4 in more detail. These customizations include the configuration of network IP, DNS, file
system table, and kernel modules. Additional configuration is performed depending on the targeted deployed infrastructure.</p>
<img alt="_images/ImageRegistration_detail.png" class="align-center" src="_images/ImageRegistration_detail.png" style="width: 400px; height: 400px;" />
<p>In the HPC infrastructure the images are converted to network bootable images to be provisioned on bare-metal machines. Here, the customization process configures
the image, so it can be integrated into the pool of deployable images accessible by the scheduler. In our case this is Moab. Hence, if such an image is specified
as part of the job description the scheduler will conduct the provisioning of the image for us. These images are stateless and the system is restored by
reverting to a default OS once the running job requiring a customized image is completed.</p>
<p>Images targeted for cloud infrastructures need to be converted into VM disks. These images also need some additional configuration to enable VM’s
contextualization in the selected cloud. Our plan is to support the main IaaS clouds, namely Eucalyptus, Nimbus, OpenStack, OpenNebula, and Amazon
Web Service (AWS). As our tool is extensible, we can also support other cloud frameworks.</p>
</div>
</div>
<span id="document-quickstart"></span><div class="section" id="rain-quickstart">
<span id="quickstart"></span><h2>Rain QuickStart<a class="headerlink" href="#rain-quickstart" title="Permalink to this headline">¶</a></h2>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>At this moment, our software only provides command line interfaces. Thus, users need access to the machine where the client part of the
software is installed. Currently, this is installed and configured in the India cluster (<tt class="docutils literal"><span class="pre">india.futuregrid.org</span></tt>). Since our software
is going to interact with different cloud infrastructures, users need to have the appropriated credentials for each case.</p>
<ul class="simple">
<li>If users want to register and run images on Eucalyptus, they need an Eucalyptus account, download and uncompress the credentials (see
<a class="reference external" href="https://portal.futuregrid.org/tutorials/eucalyptus">FG Eucalyptus Tutorial</a>). The important file is
the <tt class="docutils literal"><span class="pre">eucarc</span></tt> that contains the needed information about Eucalyptus and the user.</li>
<li>If users want to register and run images on OpenStack, they need an OpenStack account (see
<a class="reference external" href="https://portal.futuregrid.org/tutorials/openstack">FG OpenStack Tutorial</a>). User credentials should be in his <tt class="docutils literal"><span class="pre">HOME</span></tt> directory of the
India cluster. After uncompressing the credentials file, user will find the <tt class="docutils literal"><span class="pre">novarc</span></tt> file that contains important information
about Nimbus and the user.</li>
<li>If users want to register and run images on Nimbus, they need a Nimbus account
(<a class="reference external" href="https://portal.futuregrid.org/tutorials/nimbus">FG Nimbus Tutorial</a>). We are going to use the Nimbus infrastructure available
in the Hotel cluster from India (The other Nimbus deployments should work if they have the kernels needed by the images).
User credentials should be in his <tt class="docutils literal"><span class="pre">HOME</span></tt> directory of the Hotel cluster (<tt class="docutils literal"><span class="pre">hotel.futuregrid.org</span></tt>). Users have to copy and uncompress
their credentials in their <tt class="docutils literal"><span class="pre">HOME</span></tt> directory of India. Then, users have to create a directory called <tt class="docutils literal"><span class="pre">.nimbus</span></tt> in their <tt class="docutils literal"><span class="pre">HOME</span></tt> directory
of India and copy the files <tt class="docutils literal"><span class="pre">usercert.pem</span></tt> and <tt class="docutils literal"><span class="pre">userkey.pem</span></tt>. Other important file is the <tt class="docutils literal"><span class="pre">hotel.conf</span></tt> that contains information
about Nimbus and the user user.</li>
</ul>
<p>Once users have the appropriate accounts, they can login on India and use the module functionality to load the environment variables:</p>
<blockquote>
<div><div class="highlight-python"><pre>$ ssh &lt;username&gt;@india.futuregrid.org
$ module load futuregrid</pre>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At this point, users have to explicitly request access to the Image Management and rain tools by sending a ticket to <a class="reference external" href="https://portal.futuregrid.org/help">https://portal.futuregrid.org/help</a>.</p>
</div>
</div>
<div class="section" id="fg-shell-vs-command-line-interfaces">
<h3>FG-Shell vs Command Line Interfaces<a class="headerlink" href="#fg-shell-vs-command-line-interfaces" title="Permalink to this headline">¶</a></h3>
<p>To ease the use of the FG tools, we have created a shell that provides a common interface for all these tools. So, users just need to
remember how to execute the shell. Once users login into the shell, a number of features will be exposed to them. These features include
help, command&#8217;s auto-completion, and list of available commands organized by tool. Moreover, users only need to type the password
when they login into the shell.</p>
<p>Users can log into the shell by executing:</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-shell -u &lt;username&gt;</pre>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Users need to use their FutureGrid portal password.</p>
</div>
<p>More information about using the shell can be found in the <a class="reference internal" href="index.html#man-shell"><em>FutureGrid Shell Manual</em></a>.</p>
</div>
<div class="section" id="using-image-repository">
<h3>Using Image Repository<a class="headerlink" href="#using-image-repository" title="Permalink to this headline">¶</a></h3>
<p>The Image Repository is a service to query, store, and update images through a unique and common interface. Next, we show some examples of
the Image Repository usage (<tt class="docutils literal"><span class="pre">fg-repo</span></tt> command). More details can be found in the <a class="reference internal" href="index.html#man-repo"><em>Image Repository Manual</em></a>.</p>
<p>Additionally, the Image Repository manages the user database for all the image management components. This database is used to authorize users, to
control the user&#8217;s quotas and to record usage information. Therefore, this database complements the LDAP server which is mainly focused on the
user authentication.</p>
<p>When using <tt class="docutils literal"><span class="pre">fg-shell</span></tt>, users need to load the Image Repository context by executing <tt class="docutils literal"><span class="pre">use</span> <span class="pre">repo</span></tt> inside the shell. The Image Repository environment
is also included in the Image Management (<tt class="docutils literal"><span class="pre">image</span></tt>) and Rain (<tt class="docutils literal"><span class="pre">rain</span></tt>) contexts. Once there is an active context, the <tt class="docutils literal"><span class="pre">help</span></tt> command
will show only the available commands for such context. Available contexts can be listed using the <tt class="docutils literal"><span class="pre">contexts</span></tt> command. More information
about the shell can be found in the <a class="reference internal" href="index.html#man-shell"><em>FutureGrid Shell Manual</em></a>.</p>
<ul>
<li><p class="first">Upload an image</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-repo -p /home/javi/image.iso "vmtype=kvm&amp;os=Centos5&amp;arch=i386&amp;description=this is a test description&amp;tag=tsttag1, tsttag2&amp;permission=private" -u jdiaz
$ fg-repo -p /home/javi/image.iso "ImgType=Openstack&amp;os=Ubuntu&amp;arch=x86_64&amp;description=this is a test description" -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>put  /home/javi/image.iso ImgType=Openstack&amp;os=Ubuntu&amp;arch=x86_64&amp;description=this is a test description</pre>
</div>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The &amp; character is used to separate different metadata fields.</p>
</div>
<ul>
<li><p class="first">Get an image</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-repo -g 964160263274803087640112 -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>get 964160263274803087640112</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Modify the metadata of an image</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-repo -m 964160263274803087640112 "ImgType=Opennebula&amp;os=Ubuntu10" -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>modify 964160263274803087640112 ImgType=Opennebula&amp;os=Ubuntu10</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Query Image Repository</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-repo -q "* where vmType=kvm" -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>list * where vmType=kvm</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Add user to the Image Repository</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-repo --useradd juan -u jdiaz
$ fg-repo --usersetstatus juan active</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>user -a juan
user -m juan status active</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="using-image-generation">
<h3>Using Image Generation<a class="headerlink" href="#using-image-generation" title="Permalink to this headline">¶</a></h3>
<p>This component creates images, according to user requirements, that can be registered in FutureGrid. Since FG is a testbed that
supports different type of infrastructures like HPC or IaaS frameworks, the images created by this tool are not aimed at any specific
environment. Thus, it is at registration time when the images are customized to be successfully integrated into the desired infrastructure.</p>
<p>Next, we provide some examples of the Image Generation usage (<tt class="docutils literal"><span class="pre">fg-generate</span></tt> command). More details can be found in the <a class="reference internal" href="index.html#man-generate"><em>Image Generation Manual</em></a>.</p>
<p>When using <tt class="docutils literal"><span class="pre">fg-shell</span></tt>, users need to load the Image Management context by executing <tt class="docutils literal"><span class="pre">use</span> <span class="pre">image</span></tt> inside the shell. The Image Management
environment is also included in the Rain (<tt class="docutils literal"><span class="pre">rain</span></tt>) contexts. Once there is an active context,
the <tt class="docutils literal"><span class="pre">help</span></tt> command will show only the available commands for such context. Available contexts can be listed using the <tt class="docutils literal"><span class="pre">contexts</span></tt>
command. More information about the shell can be found in the <a class="reference internal" href="index.html#man-shell"><em>FutureGrid Shell Manual</em></a>.</p>
<ul>
<li><p class="first">Generate a CentOS image</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-generate -o centos -v 5 -a x86_64 -s wget,emacs,python26 -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>generate -o centos -v 5 -a x86_64 -s wget,emacs,python26</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Generate an Ubuntu image</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-generate -o ubuntu -v 10.10 -a x86_64 -s wget,openmpi-bin -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>generate -o ubuntu -v 10.10 -a x86_64 -s wget,emacs,python26</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="using-image-registration">
<h3>Using Image Registration<a class="headerlink" href="#using-image-registration" title="Permalink to this headline">¶</a></h3>
<p>This tool is responsible for customizing images for specific infrastructures and registering them in such infrastructures.
Currently, we fully support HPC (bare-metal machines), Eucalyptus, OpenStack, and Nimbus infrastructures. OpenNebula is also implemented but
we do not have this infrastructure in production yet.</p>
<p>Next, we provide some examples of the image registration usage (<tt class="docutils literal"><span class="pre">fg-register</span></tt> command). A detailed manual can be found in
the <a class="reference internal" href="index.html#man-register"><em>Image Registration Manual</em></a></p>
<p>When using <tt class="docutils literal"><span class="pre">fg-shell</span></tt>, users need to load the Image Management context by executing <tt class="docutils literal"><span class="pre">use</span> <span class="pre">image</span></tt> inside the shell. The Image Management
environment also loads the Image Repository context. The Image Management is also included in the Rain (<tt class="docutils literal"><span class="pre">rain</span></tt>) contexts. Once there is an
active context, the <tt class="docutils literal"><span class="pre">help</span></tt> command will show only the available commands for such context. Available contexts can be listed
using the <tt class="docutils literal"><span class="pre">contexts</span></tt> command. More information about the shell can be found in the <a class="reference internal" href="index.html#man-shell"><em>FutureGrid Shell Manual</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>To register an image in the HPC infrastructure, users need to specify the name of that HPC machine that they want to use with
the -x/&#8211;xcat option. The rest of the needed information will be taken from the configuration file.</li>
<li>To register an image in Eucalyptus, OpenStack and Nimbus infrastructures, you need to provide a file with the environment variables
using the -v/&#8211;varfile option.</li>
</ul>
</div>
<ul>
<li><p class="first">Register an image for the HPC Infrastructure India</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-register -r 964160263274803087640112 -x india -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>register -r 964160263274803087640112 -x india</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Register an image for OpenStack</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-register -r 964160263274803087640112 -s -v ~/novarc -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>register -r 964160263274803087640112 -s -v ~/novarc</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Customize an image for Ecualyptus but do not register it (here <tt class="docutils literal"><span class="pre">-v</span> <span class="pre">~/eucarc</span></tt> is not needed because we are not going to register the image
in the infrastructure)</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-register -r 964160263274803087640112 -e -g -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>register -r 964160263274803087640112 -e -g</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Register an image for Nimbus</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-register -r 964160263274803087640112 -n -v ~/hotel.conf -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>register -r 964160263274803087640112 -n -v ~/hotel.conf</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">List available kernels for the HPC infrastructure India</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>fg-register --listkernels -x india -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>hpclistkernels india</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">List available kernels for OpenStack</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>fg-register --listkernels -s -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">cloudlistkernels</span> <span class="o">-</span><span class="n">s</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="using-rain">
<h3>Using RAIN<a class="headerlink" href="#using-rain" title="Permalink to this headline">¶</a></h3>
<p>This component allow users to dynamically register FutureGrid software environments as requirement of a job submission.
This component will make use of the previous registration tool. Currently we only support HPC job submissions.</p>
<p>Next, we provide some examples of the Rain usage (<tt class="docutils literal"><span class="pre">fg-rain</span></tt> command). A detailed manual can be found in the <a class="reference internal" href="index.html#man-rain"><em>Rain Manual</em></a>.</p>
<p>When using <tt class="docutils literal"><span class="pre">fg-shell</span></tt>, users need to load the Image Management context by executing <tt class="docutils literal"><span class="pre">use</span> <span class="pre">rain</span></tt> inside the shell. The Rain
environment also loads the Image Repository and Image Management contexts. Once there is an active context,
the <tt class="docutils literal"><span class="pre">help</span></tt> command will show only the available commands for such context. Available contexts can be listed using the <tt class="docutils literal"><span class="pre">contexts</span></tt>
command. More information about the shell can be found in the <a class="reference internal" href="index.html#man-shell"><em>FutureGrid Shell Manual</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>To register an image in the HPC infrastructure, users need to specify the name of that HPC machine that they want to use with
the -x/&#8211;xcat option. The rest of the needed information will be taken from the configuration file.</li>
<li>To register an image in Eucalyptus, OpenStack and Nimbus infrastructures, you need to provide a file with the environment variables
using the -v/&#8211;varfile option.</li>
</ul>
</div>
<ul>
<li><p class="first">Run a job in 4 nodes on India using an image stored in the Image Repository (This involves the registration of the image in the HPC infrastructure)</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-rain -r 1231232141 -x india -m 4 -j myscript.sh -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>use rain    #if your prompt is different to fg-rain&gt;
fg-rain&gt; launch -r 1231232141 -x india -m 4 -j myscript.sh</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Run a job in 2 nodes on India using an image already registered in the HPC Infrastructure India</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-rain -i centosjavi434512 -x india -m 2 -j myscript.sh -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>use rain    #if your prompt is different to fg-rain&gt;
fg-rain&gt; launch -i centosjavi434512 -x india -m 2 -j myscript.sh</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Interactive mode. Instantiate two VMs using an image already registered on OpenStack</p>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-rain -i ami-00000126 -s -v ~/novarc -m 2 -I -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>use rain    #if your prompt is different to fg-rain&gt;
fg-rain&gt; launch -i ami-00000126 -s -v ~/novarc -m 2 -I</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Run an MPI job in six VM using an image already registered on Eucalyptus (the image has to have the <tt class="docutils literal"><span class="pre">mpich2</span></tt> package installed)</p>
<p>Content of <tt class="docutils literal"><span class="pre">mpichjob.sh</span></tt>:</p>
<blockquote>
<div><div class="highlight-python"><pre>#!/bin/bash

#real home is /tmp/jdiaz/
#VM home is /N/u/jdiaz/
#$HOME/machines is a file with the VMs involved in this job

cd /tmp/N/u/jdiaz/mpichexample/

mpiexec.hydra -machinefile /N/u/jdiaz/machines -np `wc -l /N/u/jdiaz/machines |  cut -d" " -f1` /tmp/N/u/jdiaz/example/a.out &gt; /tmp/N/u/jdiaz/output.mpichexample</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the CLI</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-rain -i ami-00000126 -e -v ~/eucarc -j mpichjob.sh -m 6 -u jdiaz</pre>
</div>
</div></blockquote>
<ul class="simple">
<li>Using the Shell</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>use rain    #if your prompt is different to fg-rain&gt;
fg-rain&gt; launch -i ami-00000126 -e -v ~/eucarc -j mpichjob.sh -m 6</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<span id="document-documentation"></span><div class="section" id="rain-documentation">
<span id="documentation"></span><h2>Rain Documentation<a class="headerlink" href="#rain-documentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="user-documentation">
<h3>User Documentation<a class="headerlink" href="#user-documentation" title="Permalink to this headline">¶</a></h3>
<p>In this section you will find information on how to use the command line interfaces of our tools.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These tools require users to authenticate using their usernames and portal passwords.</p>
</div>
<div class="toctree-wrapper compound">
<span id="document-man-repo"></span><div class="section" id="image-repository-fg-repo">
<span id="man-repo"></span><h4>Image Repository (fg-repo)<a class="headerlink" href="#image-repository-fg-repo" title="Permalink to this headline">¶</a></h4>
<p>The Image Repository is a service to query, store, and update images through a unique and common interface.</p>
<div class="section" id="fg-repo">
<h5>fg-repo<a class="headerlink" href="#fg-repo" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><pre>usage: fg-repo [-h] -u user [-d]
               (-q [AttributeString] | -g imgId | -p imgFile [AttributeString ...] | -m imgId AttributeString
                 | -r imgId [imgId ...] | -s imgId permissionString | --useradd userId | --userdel userId
                 | --userlist | --setuserquota userId quotaExpresion | --setuserrole userId role | --setuserstatus userId status
                 | --histimg [imgId] | --histuser [userId])
               [--nopasswd]

Options between brackets are not required. Parenthesis means that you need to specify one of the options.</pre>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Option</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-h/--help</span></tt></td>
<td>Shows help information and exit.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-u/--user</span> <span class="pre">&lt;userName&gt;</span></tt></td>
<td>FutureGrid HPC user name, that is, the one used to login into the FG resources.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-q/--list</span> <span class="pre">[queryString]</span></tt></td>
<td>Get list of images that meet the criteria.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-g/--get</span> <span class="pre">&lt;imgId&gt;</span></tt></td>
<td>Get an image by specifying its unique identifier.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-p/--put</span> <span class="pre">&lt;imgFile&gt;</span> <span class="pre">[attributeString]</span></tt></td>
<td>Store image into the repository and its metadata defined in <tt class="docutils literal"><span class="pre">attributeString</span></tt>. Default metadata is provided if the argument is missing.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-m/--modify</span> <span class="pre">&lt;imgId&gt;</span> <span class="pre">&lt;attributeString&gt;</span></tt></td>
<td>Modify the metadata associated with the image.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-r/--remove</span> <span class="pre">&lt;imgId&gt;</span> <span class="pre">[imgId</span> <span class="pre">...]</span></tt></td>
<td>Delete images from the Repository.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-s/--setpermission</span> <span class="pre">&lt;imgId&gt;</span> <span class="pre">&lt;permissionString&gt;</span></tt></td>
<td>Change the permission of a particular image. Valid values are <tt class="docutils literal"><span class="pre">public</span></tt>, <tt class="docutils literal"><span class="pre">private</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--histimg</span> <span class="pre">[imgId]</span></tt></td>
<td>Get usage information an image. If no argument provided, it shows the usage information of all images.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--nopasswd</span></tt></td>
<td>If this option is used, the password is not requested. This is intended for systems daemons like Inca.</td>
</tr>
</tbody>
</table>
<p>The following options are available only for users with <tt class="docutils literal"><span class="pre">admin</span></tt> role.</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Option</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--useradd</span> <span class="pre">&lt;userId&gt;</span></tt></td>
<td>Add a new user to the image management database.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--userdel</span> <span class="pre">&lt;userId&gt;</span></tt></td>
<td>Delete an user from the image management database.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--userlist</span></tt></td>
<td>List of users.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--setuserquota</span> <span class="pre">&lt;userId&gt;</span> <span class="pre">&lt;quota&gt;</span></tt></td>
<td>Modify the quota of a user. The quota is given in bytes, but math expressions are allowed (<tt class="docutils literal"><span class="pre">4*1024*1024</span></tt>). By default each user has 4GB of disk space.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--setuserrole</span>&nbsp; <span class="pre">&lt;userId&gt;</span> <span class="pre">&lt;role&gt;</span></tt></td>
<td>Modify the role of a user. Valid values: <tt class="docutils literal"><span class="pre">admin</span></tt> and <tt class="docutils literal"><span class="pre">user</span></tt> roles.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--setuserstatus</span> <span class="pre">&lt;userId&gt;</span> <span class="pre">&lt;status&gt;</span></tt></td>
<td>Modify the status of a user. Valid values: <tt class="docutils literal"><span class="pre">pending</span></tt>, <tt class="docutils literal"><span class="pre">active</span></tt>, and <tt class="docutils literal"><span class="pre">inactive</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--histuser</span> <span class="pre">[userId]</span></tt></td>
<td>Get usage info of an User. If no argument provided, it shows the usage information of all users. This option can be used by normal users to show their own information</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>While using the command line interface, the <tt class="docutils literal"><span class="pre">attributeString</span></tt>, <tt class="docutils literal"><span class="pre">queryString</span></tt> and <tt class="docutils literal"><span class="pre">quotaExpression</span></tt> arguments must be enclosed by <strong>&#8220;</strong> characters.</p>
<ul class="last simple">
<li>A <tt class="docutils literal"><span class="pre">attributeString</span></tt> can be composed by a list of metadata fields separated by the &amp; character. Valid metadata fields are:<ul>
<li><tt class="docutils literal"><span class="pre">vmtype</span></tt>: it can be <tt class="docutils literal"><span class="pre">none</span></tt>, <tt class="docutils literal"><span class="pre">xen</span></tt>, <tt class="docutils literal"><span class="pre">kvm</span></tt>, <tt class="docutils literal"><span class="pre">virtualbox</span></tt>, <tt class="docutils literal"><span class="pre">vmware</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">imgtype</span></tt>: it can be <tt class="docutils literal"><span class="pre">machine</span></tt>, <tt class="docutils literal"><span class="pre">kernel</span></tt>, <tt class="docutils literal"><span class="pre">eucalyptus</span></tt>, <tt class="docutils literal"><span class="pre">nimbus</span></tt>, <tt class="docutils literal"><span class="pre">opennebula</span></tt>, <tt class="docutils literal"><span class="pre">openstack</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">os</span></tt>: String.</li>
<li><tt class="docutils literal"><span class="pre">arch</span></tt>: String.</li>
<li><tt class="docutils literal"><span class="pre">description</span></tt>: String.</li>
<li><tt class="docutils literal"><span class="pre">tag</span></tt>: List of Strings.</li>
<li><tt class="docutils literal"><span class="pre">permission</span></tt>: it can be <tt class="docutils literal"><span class="pre">public</span></tt>, <tt class="docutils literal"><span class="pre">private</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">imgStatus</span></tt>: it can be <tt class="docutils literal"><span class="pre">available</span></tt>, <tt class="docutils literal"><span class="pre">locked</span></tt>.</li>
</ul>
</li>
<li>Valid <tt class="docutils literal"><span class="pre">queryString</span></tt> are:<ul>
<li>&#8220;*&#8221;</li>
<li>&#8220;* where field=XX&#8221;</li>
<li>&#8220;field1,field2 where field3=XX&#8221;</li>
</ul>
</li>
<li>Valid <tt class="docutils literal"><span class="pre">quotaExpression</span></tt> (in bytes): &#8220;4294967296&#8221;, &#8220;2048 * 1024&#8221;</li>
</ul>
</div>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Upload an image</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-repo -p /home/javi/image.iso "vmtype=kvm&amp;os=Centos5&amp;arch=i386&amp;description=this is a test description&amp;tag=tsttag1, tsttag2&amp;permission=private" -u jdiaz
$ fg-repo -p /home/javi/image.iso "ImgType=Openstack&amp;os=Ubuntu&amp;arch=x86_64&amp;description=this is a test description" -u jdiaz</pre>
</div>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The &amp; character is used to separate different metadata fields.</p>
</div>
<ul>
<li><p class="first">Get an image</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-repo -g 964160263274803087640112 -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Modify the metadata of an image</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-repo -m 964160263274803087640112 "ImgType=Opennebula&amp;os=Ubuntu10" -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Query Image Repository</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-repo -q "* where vmType=kvm" -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Add user to the Image Repository</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-repo --useradd juan -u jdiaz
$ fg-repo --usersetstatus juan active</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<span id="document-man-generate"></span><div class="section" id="image-generation-fg-generate">
<span id="man-generate"></span><h4>Image Generation (fg-generate)<a class="headerlink" href="#image-generation-fg-generate" title="Permalink to this headline">¶</a></h4>
<p>This service generates images with the requested OS and software stacks specification.</p>
<div class="section" id="fg-generate">
<h5>fg-generate<a class="headerlink" href="#fg-generate" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><pre>usage: fg-generate [-h] -u USER [-d] -o OSName [-v OSversion] [-a arch]
                   [--baseimage | -s software] [--scratch] [-n givenname]
                   [-e description] [-g] [-z SIZE] [--nopasswd]

Options between brackets are not required. Parenthesis means that you need to specify one of the options.</pre>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Option</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-h/--help</span></tt></td>
<td>Shows help information and exit.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-u/--user</span> <span class="pre">&lt;userName&gt;</span></tt></td>
<td>FutureGrid HPC user name, that is, the one used to login into the FG resources.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-o/--os</span> <span class="pre">&lt;osName&gt;</span></tt></td>
<td>Specify the desired Operating System for the new image. Currently, CentOS and Ubuntu are supported</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-v/--version</span> <span class="pre">&lt;osVersion&gt;</span></tt></td>
<td>Operating System version. In the case of Centos, it can be 5 or 6. In the case of Ubuntu, it can be karmic(9.10), lucid(10.04), maverick(10.10), natty (11.04)</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-a/--arch</span> <span class="pre">&lt;arch&gt;</span></tt></td>
<td>Destination hardware architecture (x86_64 or i386)</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--baseimage</span></tt></td>
<td>Generate a Base Image that will be used to generate other images. In this way, the image generation process will be faster.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-s/--software</span> <span class="pre">&lt;software&gt;</span></tt></td>
<td>List of software packages, separated by commas, that will be installed in the image.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--scratch</span></tt></td>
<td>Generate the image from scratch without using any Base Image from the repository.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-n/--name</span> <span class="pre">&lt;givenname&gt;</span></tt></td>
<td>Desired recognizable name of the image.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-e/--description</span> <span class="pre">&lt;description&gt;</span></tt></td>
<td>Short description of the image and its purpose.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-g/--getimg</span></tt></td>
<td>Retrieve the image instead of uploading to the image repository.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-z/--size</span> <span class="pre">&lt;SIZE&gt;</span></tt></td>
<td>Specify the size of the Image in GigaBytes. The size must be large enough to install all the software required. The default and minimum size is 1.5GB, which is enough for most cases.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">--nopasswd</span></tt></td>
<td>If this option is used, the password is not requested. This is intended for systems daemons like Inca.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Generate a CentOS image</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-generate -o centos -v 5 -a x86_64 -s wget,emacs,python26 -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Generate an Ubuntu image</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-generate -o ubuntu -v 10.10 -a x86_64 -s wget,openmpi-bin -u jdiaz</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<span id="document-man-register"></span><div class="section" id="image-registration-fg-register">
<span id="man-register"></span><h4>Image Registration (fg-register)<a class="headerlink" href="#image-registration-fg-register" title="Permalink to this headline">¶</a></h4>
<p>This service registers images in the selected infrastructures. After this process, images become available for instantiation in such infrastructures.</p>
<div class="section" id="fg-register">
<h5>fg-register<a class="headerlink" href="#fg-register" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><pre>usage: fg-register [-h] -u user [-d] (-i ImgFile | -r ImgId | -l | -t)
                   [-k Kernel version] [-a ramdiskId]
                   (-x MachineName | -e [Address:port] | -o [Address] | -n [Address] | -s [Address])
                   [-v VARFILE] [-g] [-p] [-w] [--nopasswd] [-j]

Options between brackets are not required. Parenthesis means that you need to specify one of the options.</pre>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Option</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-h/--help</span></tt></td>
<td>Shows help information and exit.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-u/--user</span> <span class="pre">&lt;userName&gt;</span></tt></td>
<td>FutureGrid HPC user name, that is, the one used to login into the FG resources.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-i/--image</span> <span class="pre">&lt;imgFile&gt;</span></tt></td>
<td>Select the image to register by specifying its location. The image is a tgz file that contains the manifest and image files.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-r/--imgid</span> <span class="pre">&lt;imgId&gt;</span></tt></td>
<td>Select the image to register by specifying its Id in the repository.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-k/--kernel</span> <span class="pre">&lt;version&gt;</span></tt></td>
<td>Specify the desired kernel.
<strong>Case a)</strong> if the image has to be adapted (any image generated with <tt class="docutils literal"><span class="pre">fg-generate</span></tt>) this option can be used to select one of the
available kernels. Both kernelId and ramdiskId will be selected according to the selected kernel. This case is for any infrastructure.
<strong>Case b)</strong> if the image is ready to be registered, you may need to specify the id of the kernel in the infrastructure.
This case is when <tt class="docutils literal"><span class="pre">-j/--justregister</span></tt> is used and only for cloud infrastructures.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-a/--ramdisk</span> <span class="pre">&lt;ramdiskId&gt;</span></tt></td>
<td>Specify the desired ramdisk that will be associated to your image in the cloud infrastructure. This option is only needed
if <tt class="docutils literal"><span class="pre">-j/--justregister</span></tt> is used.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-l/--list</span></tt></td>
<td>List images registered in the HPC or Cloud infrastructures.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-t/--listkernels</span></tt></td>
<td>List kernels available for HPC or Cloud infrastructures.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-x/--xcat</span> <span class="pre">&lt;MachineName&gt;</span></tt></td>
<td>Register the image into the HPC infrastructure named <tt class="docutils literal"><span class="pre">MachineName</span></tt> (minicluster, india ...).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-e/--euca</span> <span class="pre">[Address:port]</span></tt></td>
<td>Register the image into the Eucalyptus Infrastructure, which is specified in the argument. The argument should not be needed.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-s/--openstack</span> <span class="pre">[Address]</span></tt></td>
<td>Register the image into the OpenStack Infrastructure, which is specified in the argument. The argument should not be needed.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-n/--nimbus</span> <span class="pre">[Address]</span></tt></td>
<td>Register the image into the Nimbus Infrastructure, which is specified in the argument. The argument should not be needed.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-o/--opennebula</span> <span class="pre">[Address]</span></tt></td>
<td>Register the image into the OpenStack Infrastructure, which is specified in the argument. The argument should not be needed.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-v/--varfile</span> <span class="pre">&lt;VARFILE&gt;</span></tt></td>
<td>Path of the environment variable files. Currently this is used by Eucalyptus, OpenStack and Nimbus.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-g/--getimg</span></tt></td>
<td>Customize the image for a particular cloud framework but does not register it. So the user gets the image file.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-p/--noldap</span></tt></td>
<td>If this option is active, FutureGrid LDAP will not be configured in the image. This option only works for Cloud registrations.
LDAP configuration is needed to run jobs using <tt class="docutils literal"><span class="pre">fg-rain</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-w/--wait</span></tt></td>
<td>Wait until the image is available in the targeted infrastructure. Currently this is used by Eucalyptus and OpenStack.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--nopasswd</span></tt></td>
<td>If this option is used, the password is not requested. This is intended for systems daemons like Inca.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-j,</span> <span class="pre">--justregister</span></tt></td>
<td>It assumes that the image is ready to run in the selected infrastructure. Thus, no additional configuration will be performed.
Only valid for Cloud infrastructures. (This is basically a wrapper of the tools that register images into the cloud infrastructures)</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>To register an image in the HPC infrastructure, users need to specify the name of that HPC machine that they want to use with
the -x/&#8211;xcat option. The rest of the needed information will be taken from the configuration file.</li>
<li>To register an image in Eucalyptus, OpenStack and Nimbus infrastructures, you need to provide a file with the environment variables
using the -v/&#8211;varfile option.</li>
</ul>
</div>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Register an image for the HPC Infrastructure India</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-register -r 964160263274803087640112 -x india -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Register an image for OpenStack</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-register -r 964160263274803087640112 -s -v ~/novarc -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Customize an image for Ecualyptus but do not register it (here <tt class="docutils literal"><span class="pre">-v</span> <span class="pre">~/eucarc</span></tt> is not needed because we are not going to register the image
in the infrastructure)</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-register -r 964160263274803087640112 -e -g -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Register an image for Nimbus</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-register -r 964160263274803087640112 -n -v ~/hotel.conf -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">List available kernels for the HPC infrastructure India</p>
<blockquote>
<div><div class="highlight-python"><pre>fg-register --listkernels -x india -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">List available kernels for OpenStack</p>
<blockquote>
<div><div class="highlight-python"><pre>fg-register --listkernels -s -u jdiaz</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<span id="document-man-rain"></span><div class="section" id="rain-fg-rain">
<span id="man-rain"></span><h4>Rain (fg-rain)<a class="headerlink" href="#rain-fg-rain" title="Permalink to this headline">¶</a></h4>
<p>Rain is a service that a command to dynamically deploy a FutureGrid software environments and stacks.</p>
<div class="section" id="fg-rain">
<h5>fg-rain<a class="headerlink" href="#fg-rain" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><pre>usage: fg-rain [-h] -u user [-d] [-k Kernel version]
               (-i ImgId | -r ImgId) (-x MachineName | -e [Address:port] | -s [Address])
               [-v VARFILE] [-m #instances] [-w hours]
               (-j JOBSCRIPT | -I) [--nopasswd]

Options between brackets are not required. Parenthesis means that you need to specify one of the options.</pre>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Option</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-h/--help</span></tt></td>
<td>Shows help information and exit.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-u/--user</span> <span class="pre">&lt;userName&gt;</span></tt></td>
<td>FutureGrid HPC user name, that is, the one used to login into the FG resources.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-k/--kernel</span> <span class="pre">&lt;version&gt;</span></tt></td>
<td>Specify the desired kernel (<tt class="docutils literal"><span class="pre">fg-register</span></tt> can list the available kernels for each infrastructure).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-i/--registeredimageid</span> <span class="pre">&lt;imgId&gt;</span></tt></td>
<td>Select the image to use by specifying its Id in the target infrastructure. This assumes that the image is registered in the selected infrastructure.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-r/--imgid</span> <span class="pre">&lt;imgId&gt;</span></tt></td>
<td>Select the image to use by specifying its Id in the repository. The image will be automatically registered in the infrastructure before the job is executed.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-x/--xcat</span> <span class="pre">&lt;MachineName&gt;</span></tt></td>
<td>Use the HPC infrastructure named <tt class="docutils literal"><span class="pre">MachineName</span></tt> (minicluster, india ...).</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-e/--euca</span> <span class="pre">[Address:port]</span></tt></td>
<td>Use the Eucalyptus Infrastructure, which is specified in the argument. The argument should not be needed.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-s/--openstack</span> <span class="pre">[Address]</span></tt></td>
<td>Use the OpenStack Infrastructure, which is specified in the argument. The argument should not be needed.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-n/--nimbus</span> <span class="pre">[Address]</span></tt></td>
<td><em>(NOT yet supported)</em> Use the Nimbus Infrastructure, which is specified in the argument. The argument should not be needed.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-o/--opennebula</span> <span class="pre">[Address]</span></tt></td>
<td><em>(NOT yet supported)</em> Use the OpenStack Infrastructure, which is specified in the argument. The argument should not be needed.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-v/--varfile</span> <span class="pre">&lt;VARFILE&gt;</span></tt></td>
<td>Path of the environment variable files. Currently this is used by Eucalyptus, OpenStack and Nimbus.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-m/--numberofmachines</span> <span class="pre">&lt;#instances&gt;</span></tt></td>
<td>Number of machines needed.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-w/--walltime</span> <span class="pre">&lt;hours&gt;</span></tt></td>
<td>How long to run (in hours). You may use decimals. This is used for HPC and Nimbus.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-j/--jobscript</span> <span class="pre">&lt;JOBSCRIPT&gt;</span></tt></td>
<td>Script to execute on the provisioned images. In the case of Cloud environments, the user home directory is mounted in <tt class="docutils literal"><span class="pre">/tmp/N/u/&lt;username&gt;</span></tt>.
The <tt class="docutils literal"><span class="pre">/N/u/&lt;username&gt;</span></tt> is only used for ssh between VM and store the ips of the parallel job in a file called <tt class="docutils literal"><span class="pre">/N/u/&lt;username&gt;/machines</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-I/--interactive</span></tt></td>
<td>Interactive mode. It boots VMs or provisions bare-metal machines. Then, the user is automatically logged into one of the VMs/machines.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--nopasswd</span></tt></td>
<td>If this option is used, the password is not requested. This is intended for systems daemons like Inca.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Run a job in 4 nodes using an image stored in the Image Repository (This involves the registration of the image on xCAT/Moab)</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-rain -r 1231232141 -x india -m 4 -j myscript.sh -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Run a job in 2 nodes using an image already registered on xCAT/Moab</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-rain -i centosjavi434512 -x india -m 2 -j myscript.sh -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Interactive mode. Instantiate two VMs using an image already registered on OpenStack</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-rain -i ami-00000126 -s -v ~/novarc -m 2 -I -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Run a job in a VM using an image already registered on Eucalyptus</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-rain -i ami-00000126 -e -v ~/eucarc -j myscript.sh -u jdiaz</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Run an MPI job in six VM using an image already registered on Eucalyptus (the image has to have the <tt class="docutils literal"><span class="pre">mpich2</span></tt> package installed)</p>
<blockquote>
<div><div class="highlight-python"><pre>$ fg-rain -i ami-00000126 -e -v ~/eucarc -j mpichjob.sh -m 6 -u jdiaz</pre>
</div>
</div></blockquote>
<p>Content of <tt class="docutils literal"><span class="pre">mpichjob.sh</span></tt>:</p>
<blockquote>
<div><div class="highlight-python"><pre>#!/bin/bash

#real home is /tmp/jdiaz/
#VM home is /N/u/jdiaz/
#$HOME/machines is a file with the VMs involved in this job

cd /tmp/N/u/jdiaz/mpichexample/

mpiexec.hydra -machinefile /N/u/jdiaz/machines -np `wc -l /N/u/jdiaz/machines |  cut -d" " -f1` /tmp/N/u/jdiaz/example/a.out &gt; /tmp/N/u/jdiaz/output.mpichexample</pre>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<span id="document-man-shell"></span><div class="section" id="futuregrid-shell-fg-shell">
<span id="man-shell"></span><h4>FutureGrid Shell (fg-shell)<a class="headerlink" href="#futuregrid-shell-fg-shell" title="Permalink to this headline">¶</a></h4>
<p>The FutureGrid shell simplifies the access to the different FutureGrid software components. This shell is a common entry point for every components that offer a
customized environment where only the FutureGrid commands are available. It has features similar to the regular GNU/Linux shell like command auto-completion.</p>
<div class="section" id="fg-shell">
<h5>fg-shell<a class="headerlink" href="#fg-shell" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><pre>usage: fg-shell [-h] -u user [-q] [-i] [-f script_file] [--nopasswd]

Options between brackets are not required. Parenthesis means that you need to specify one of the options.</pre>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Option</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-h/--help</span></tt></td>
<td>Shows help information and exit.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-u/--user</span> <span class="pre">&lt;userName&gt;</span></tt></td>
<td>FutureGrid HPC user name, that is, the one used to login into the FG resources.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-q/--quiet</span></tt></td>
<td>Prevent to load banner and welcome messages</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">-i/--interactive</span></tt></td>
<td>After the commands are interpreted the shell is put into interactive mode</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">-f/--file</span> <span class="pre">&lt;script_file&gt;</span></tt></td>
<td>Execute commands from a file.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">--nopasswd</span></tt></td>
<td>If this option is used, the password is not requested. This is intended for systems daemons like Inca.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="usage">
<h5>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">The shell is executed by typing:</p>
<blockquote>
<div><div class="highlight-python"><pre>fg-shell -u &lt;username&gt;</pre>
</div>
</div></blockquote>
<p>After executing the previous command and typing your password, the prompt should change to <tt class="docutils literal"><span class="pre">fg&gt;</span></tt>.</p>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Using shell from outside FutureGrid:</strong> If the shell is installed outside of FutureGrid, users will not be able to enter in the shell using their passwords. The security reasons, the LDAP server
cannot be contacted from outside of FutureGrid. Therefore, users will have to use the option <tt class="docutils literal"><span class="pre">--nopasswd</span></tt> and set their password inside the shell by
executing the command <tt class="docutils literal"><span class="pre">setpasswd</span></tt>. In this way, users can authenticate against the different FutureGrid components without typing the password everytime.</p>
</div>
<p>This is useful when a user install the shell in his local machine because he will not be able to enter in the shell typing his password.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>Context concept:</strong> It is essential to understand how to use the shell the concept <strong>CONTEXT</strong>. A context is an environment specialized for a particular tool or service.
This allows us to use only the components we are interested on and organize the commands by component. For example, if we want to use the image repository,
we initialize its context by typing <tt class="docutils literal"><span class="pre">use</span> <span class="pre">repo</span></tt> and only the image repository commands will be available. See <tt class="docutils literal"><span class="pre">contexts</span></tt> and <tt class="docutils literal"><span class="pre">use</span></tt> commands.</p>
</div>
<ul class="simple">
<li>Autocompletion by pressing tab key.</li>
<li>System commands can be executed directly from the shell. If the command typed does not exists inside the shell, it tries to execute it as system command.
Moreover, the shell will execute as system commands any command preceded by the <strong>!</strong> character.</li>
</ul>
<p>Next, we explain the available commands that you can find inside the FutureGrid Shell.</p>
</div>
<div class="section" id="generic-commands">
<h5>Generic Commands<a class="headerlink" href="#generic-commands" title="Permalink to this headline">¶</a></h5>
<p>Commands listed in this section are available in any context.</p>
<ul>
<li><p class="first">Help Related Commands</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first last"><strong>Command</strong></p>
</td>
<td><p class="first last"><strong>Description</strong></p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">help</span> <span class="pre">[command]</span></tt></p>
</td>
<td><p class="first last">Show help message for a command or List of all available commands organized by context if we are in the generic context <tt class="docutils literal"><span class="pre">fg&gt;</span></tt> (see <tt class="docutils literal"><span class="pre">use</span></tt> and <tt class="docutils literal"><span class="pre">context</span></tt> commands).
However, if we are in a specific context (e.g. <tt class="docutils literal"><span class="pre">fg-repo&gt;</span></tt>) it only show the generic commands and the specific commands of this particular context.</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">manual</span></tt></p>
</td>
<td><p class="first last">List help message for all commands in the shell.</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">shortcuts</span></tt></p>
</td>
<td><p class="first last">List all available shortcuts.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">CONTEXT Related Commands</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first last"><strong>Command</strong></p>
</td>
<td><p class="first last"><strong>Description</strong></p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">contexts</span></tt></p>
</td>
<td><p class="first last">List of available contexts.</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">use</span> <span class="pre">[context]</span></tt></p>
</td>
<td><p class="first last">Change the Shell CONTEXT to use a specified FG component. If no argument is provided, it returns to the default context.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">History Related Commands</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first last"><strong>Command</strong></p>
</td>
<td><p class="first last"><strong>Description</strong></p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">history</span></tt>, <tt class="docutils literal"><span class="pre">hist</span></tt> and <tt class="docutils literal"><span class="pre">hi</span></tt></p>
</td>
<td><p class="first last">Show historic of executed commands.</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">historysession</span></tt>, <tt class="docutils literal"><span class="pre">hists</span></tt> and <tt class="docutils literal"><span class="pre">his</span></tt></p>
</td>
<td><p class="first last">Show historic of the commands executed in the current session.</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">l</span></tt>, <tt class="docutils literal"><span class="pre">li</span></tt></p>
</td>
<td><p class="first last">List last executed command.</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">save</span> <span class="pre">[N]</span></tt></p>
</td>
<td><p class="first last">Save session history to a file. N =&gt; number of command (from <tt class="docutils literal"><span class="pre">historysession</span></tt>), or *.  Most recent command if omitted.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">Execution Related Commands</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first last"><strong>Command</strong></p>
</td>
<td><p class="first last"><strong>Description</strong></p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">load</span> <span class="pre">&lt;filename&gt;</span></tt> and <tt class="docutils literal"><span class="pre">exec</span> <span class="pre">&lt;filename&gt;</span></tt></p>
</td>
<td><p class="first last">Load commands from an script and stay in the shell</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">pause</span> <span class="pre">[text]</span></tt></p>
</td>
<td><p class="first last">Displays the specified text then waits for the user to press RETURN.</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">py</span> <span class="pre">[command]</span></tt></p>
</td>
<td><p class="first last">py  &lt;command&gt;: Executes a Python command.
py: Enters interactive Python mode. End with <tt class="docutils literal"><span class="pre">Ctrl-D</span></tt> (Unix) / <tt class="docutils literal"><span class="pre">Ctrl-Z</span></tt> (Windows), <tt class="docutils literal"><span class="pre">quit()</span></tt>, <tt class="docutils literal"><span class="pre">exit()</span></tt>.</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">run,</span> <span class="pre">r</span></tt></p>
</td>
<td><p class="first last">Re-run the last executed command</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">script</span> <span class="pre">[filename]</span></tt></p>
</td>
<td><p class="first last">When Script is active, all commands executed are stored in a file. Activate it by executing: <tt class="docutils literal"><span class="pre">script</span> <span class="pre">[file]</span></tt>. If no argument
is provided, the file will be called <tt class="docutils literal"><span class="pre">script</span></tt> and will be located in your current directory. To finish and store the commands execute: <tt class="docutils literal"><span class="pre">script</span> <span class="pre">end</span></tt></p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">User-Settable Parameters Related Commands</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first last"><strong>Command</strong></p>
</td>
<td><p class="first last"><strong>Description</strong></p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">setpassword</span></tt></p>
</td>
<td><p class="first last">Set the password for the current session without leaving the shell. The password is stored encrypted</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">set</span> <span class="pre">[parameter]</span> <span class="pre">[value]</span></tt></p>
</td>
<td><p class="first last">Sets a cmd2 parameter. Call without arguments for a list of settable parameters with their values.</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">show</span></tt></p>
</td>
<td><p class="first last">List of settable parameters with their values.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="image-repository">
<h5>Image Repository<a class="headerlink" href="#image-repository" title="Permalink to this headline">¶</a></h5>
<p>These commands are available when Image Repository (<tt class="docutils literal"><span class="pre">repo</span></tt>) or Image Management (<tt class="docutils literal"><span class="pre">image</span></tt>) contexts are active. To activate the image repository context
execute <tt class="docutils literal"><span class="pre">use</span> <span class="pre">repo</span></tt>. If we execute <tt class="docutils literal"><span class="pre">help</span></tt>, we will see which commands are generic and which ones are specific of this context.</p>
<ul>
<li><p class="first">Image Related Commands</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><p class="first last"><strong>Command</strong></p>
</td>
<td><p class="first last"><strong>Description</strong></p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">list</span> <span class="pre">[queryString]</span></tt></p>
</td>
<td><p class="first last">Get list of images that meet the criteria.</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">get</span> <span class="pre">&lt;imgId&gt;</span></tt></p>
</td>
<td><p class="first last">Get an image by specifying its unique identifier.</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">put</span> <span class="pre">&lt;imgFile&gt;</span> <span class="pre">[attributeString]</span></tt></p>
</td>
<td><p class="first last">Store image into the repository and its metadata defined in <tt class="docutils literal"><span class="pre">attributeString</span></tt>. Default metadata is provided if the argument is missing.</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">modify</span> <span class="pre">&lt;imgId&gt;</span> <span class="pre">&lt;attributeString&gt;</span></tt></p>
</td>
<td><p class="first last">Modify the metadata associated with the image.</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">remove</span> <span class="pre">&lt;imgId&gt;</span></tt></p>
</td>
<td><p class="first last">Delete images from the Repository.</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last"><tt class="docutils literal"><span class="pre">setpermission</span> <span class="pre">&lt;imgId&gt;</span> <span class="pre">&lt;permissionString&gt;</span></tt></p>
</td>
<td><p class="first last">Change the permission of a particular image. Valid values are <tt class="docutils literal"><span class="pre">public</span></tt>, <tt class="docutils literal"><span class="pre">private</span></tt>.</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last"><tt class="docutils literal"><span class="pre">histimg</span> <span class="pre">[imgId]</span></tt></p>
</td>
<td><p class="first last">Get usage information an image. If no argument provided, it shows the usage information of all images.</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">User Related Commands</p>
<p>The following options are available only for users with <tt class="docutils literal"><span class="pre">admin</span></tt> role.</p>
</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Command</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">user</span> <span class="pre">&lt;options&gt;</span></tt></td>
<td><p class="first">Manage image management user&#8217;s database.</p>
<p><strong>options</strong></p>
<p><tt class="docutils literal"><span class="pre">-a/--add</span> <span class="pre">&lt;userId&gt;</span></tt>  Add a new user to the image management database.</p>
<p><tt class="docutils literal"><span class="pre">-d/--del</span> <span class="pre">&lt;userId&gt;</span></tt>  Delete an user from the image management database.</p>
<p><tt class="docutils literal"><span class="pre">-l,</span> <span class="pre">--list</span></tt>   List of users.</p>
<p class="last"><tt class="docutils literal"><span class="pre">-m/--modify</span> <span class="pre">&lt;userId&gt;</span> <span class="pre">&lt;quota/role/status&gt;</span> <span class="pre">&lt;value&gt;</span></tt> Modify quota, role or status of an user.</p>
</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">histuser</span> <span class="pre">[userId]</span></tt></td>
<td>Get usage info of an User. If no argument provided, it shows the usage information of all users. This option can be used by normal users to show their own information</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="image-generation">
<h5>Image Generation<a class="headerlink" href="#image-generation" title="Permalink to this headline">¶</a></h5>
<p>These commands are available when the Image Management (<tt class="docutils literal"><span class="pre">image</span></tt>) or the Rain (<tt class="docutils literal"><span class="pre">rain</span></tt>) contexts are active. To activate the image management context execute
<tt class="docutils literal"><span class="pre">use</span> <span class="pre">image</span></tt>. If we execute <tt class="docutils literal"><span class="pre">help</span></tt>, we will see which commands are generic and which ones are specific of this context.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Command</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">generate</span> <span class="pre">&lt;options&gt;</span></tt></td>
<td><p class="first">Generates images with the requested OS and software stacks specification.</p>
<p><strong>options</strong></p>
<p><tt class="docutils literal"><span class="pre">-o/--os</span> <span class="pre">&lt;osName&gt;</span></tt>                Specify the desired Operating System for the new image. Currently, CentOS and Ubuntu are supported</p>
<p><tt class="docutils literal"><span class="pre">-v/--version</span> <span class="pre">&lt;osVersion&gt;</span></tt>        Operating System version. In the case of Centos, it can be 5 or 6. In the case of Ubuntu, it can be karmic(9.10), lucid(10.04), maverick(10.10), natty(11.04)</p>
<p><tt class="docutils literal"><span class="pre">-a/--arch</span> <span class="pre">&lt;arch&gt;</span></tt>                Destination hardware architecture (x86_64 or i386)</p>
<p><tt class="docutils literal"><span class="pre">--baseimage</span></tt>                     Generate a Base Image that will be used to generate other images. In this way, the image generation process will be faster.</p>
<p><tt class="docutils literal"><span class="pre">-s/--software</span> <span class="pre">&lt;software&gt;</span></tt>        List of software packages, separated by commas, that will be installed in the image.</p>
<p><tt class="docutils literal"><span class="pre">--scratch</span></tt>                       Generate the image from scratch without using any Base Image from the repository.</p>
<p><tt class="docutils literal"><span class="pre">-n/--name</span> <span class="pre">&lt;givenname&gt;</span></tt>           Desired recognizable name of the image.</p>
<p><tt class="docutils literal"><span class="pre">-e/--description</span> <span class="pre">&lt;description&gt;</span></tt>  Short description of the image and its purpose.</p>
<p><tt class="docutils literal"><span class="pre">-g/--getimg</span></tt>                     Retrieve the image instead of uploading to the image repository.</p>
<p class="last"><tt class="docutils literal"><span class="pre">-z/--size</span> <span class="pre">&lt;SIZE&gt;</span></tt>                Specify the size of the Image in GigaBytes. The size must be large enough to install all the software required.
The default and minimum size is 1.5GB, which is enough for most cases.</p>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="image-register">
<h5>Image Register<a class="headerlink" href="#image-register" title="Permalink to this headline">¶</a></h5>
<p>These commands are available when the Image Management (<tt class="docutils literal"><span class="pre">image</span></tt>) or the Rain (<tt class="docutils literal"><span class="pre">rain</span></tt>) contexts are active. To activate the image management context execute
<tt class="docutils literal"><span class="pre">use</span> <span class="pre">image</span></tt>. If we execute <tt class="docutils literal"><span class="pre">help</span></tt>, we will see which commands are generic and which ones are specific of this context.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Command</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">register</span> <span class="pre">&lt;options&gt;</span></tt></td>
<td><p class="first">Registers images in the selected infrastructures. After this process, images become available for instantiation in such infrastructures.</p>
<p><strong>Options</strong></p>
<p><tt class="docutils literal"><span class="pre">-k/--kernel</span> <span class="pre">&lt;version&gt;</span></tt>      Specify the desired kernel.</p>
<p><tt class="docutils literal"><span class="pre">-i/--image</span> <span class="pre">&lt;imgFile&gt;</span></tt>       Select the image to register by specifying its location. The image is a tgz file that contains the manifest and image files.</p>
<p><tt class="docutils literal"><span class="pre">-r/--imgid</span> <span class="pre">&lt;imgId&gt;</span></tt>         Select the image to register by specifying its Id in the repository.</p>
<p><tt class="docutils literal"><span class="pre">-x/--xcat</span> <span class="pre">&lt;MachineName&gt;</span></tt>    Register the image into the HPC infrastructure named <tt class="docutils literal"><span class="pre">MachineName</span></tt> (minicluster, india ...).</p>
<p><tt class="docutils literal"><span class="pre">-e/--euca</span> <span class="pre">[Address:port]</span></tt>   Register the image into the Eucalyptus Infrastructure, which is specified in the argument. The argument should not be needed.</p>
<p><tt class="docutils literal"><span class="pre">-s/--openstack</span> <span class="pre">[Address]</span></tt>   Register the image into the OpenStack Infrastructure, which is specified in the argument. The argument should not be needed.</p>
<p><tt class="docutils literal"><span class="pre">-n/--nimbus</span> <span class="pre">[Address]</span></tt>      Register the image into the Nimbus Infrastructure, which is specified in the argument. The argument should not be needed.</p>
<p><tt class="docutils literal"><span class="pre">-o/--opennebula</span> <span class="pre">[Address]</span></tt>  Register the image into the OpenStack Infrastructure, which is specified in the argument. The argument should not be needed.</p>
<p><tt class="docutils literal"><span class="pre">-v/--varfile</span> <span class="pre">&lt;VARFILE&gt;</span></tt>     Path of the environment variable files. Currently this is used by Eucalyptus, OpenStack and Nimbus.</p>
<p><tt class="docutils literal"><span class="pre">-g/--getimg</span></tt>                Customize the image for a particular cloud framework but does not register it. So the user gets the image file.</p>
<p><tt class="docutils literal"><span class="pre">-p/--noldap</span></tt>                If this option is active, FutureGrid LDAP will not be configured in the image. This option only works for Cloud registrations.
LDAP configuration is needed to run jobs using <tt class="docutils literal"><span class="pre">fg-rain</span></tt></p>
<p class="last"><tt class="docutils literal"><span class="pre">-w/--wait</span></tt>                  Wait until the image is available in the targeted infrastructure. Currently this is used by Eucalyptus and OpenStack.</p>
</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">cloudlist</span> <span class="pre">&lt;options&gt;</span></tt></td>
<td><p class="first">List images registered in the Cloud infrastructures.</p>
<p><strong>Options</strong></p>
<p><tt class="docutils literal"><span class="pre">-e/--euca</span> <span class="pre">[Address:port]</span></tt> List images registered into the Eucalyptus Infrastructure, which is specified in the argument. The argument should not be needed.</p>
<p><tt class="docutils literal"><span class="pre">-n</span> <span class="pre">/</span> <span class="pre">--nimbus</span> <span class="pre">[Address]</span></tt> List images registered into the Nimbus Infrastructure, which is specified in the argument. The argument should not be needed.</p>
<p><tt class="docutils literal"><span class="pre">-o</span> <span class="pre">/</span> <span class="pre">--opennebula</span> <span class="pre">[Address]</span></tt> List images registered into the OpenNebula Infrastructure, which is specified in the argument. The argument should not be needed.</p>
<p class="last"><tt class="docutils literal"><span class="pre">-s</span> <span class="pre">/</span> <span class="pre">--openstack</span> <span class="pre">[Address]</span></tt> List images registered into the OpenStack Infrastructure, which is specified in the argument. The argument should not be needed.</p>
</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">cloudlistkernels</span> <span class="pre">&lt;options&gt;</span></tt></td>
<td><p class="first">List kernels available for the Cloud infrastructures.</p>
<p><strong>Options</strong></p>
<p><tt class="docutils literal"><span class="pre">-e/--euca</span> <span class="pre">[Address:port]</span></tt></p>
<p><tt class="docutils literal"><span class="pre">-n</span> <span class="pre">/</span> <span class="pre">--nimbus</span> <span class="pre">[Address]</span></tt></p>
<p><tt class="docutils literal"><span class="pre">-o</span> <span class="pre">/</span> <span class="pre">--opennebula</span> <span class="pre">[Address]</span></tt></p>
<p class="last"><tt class="docutils literal"><span class="pre">-s</span> <span class="pre">/</span> <span class="pre">--openstack</span> <span class="pre">[Address]</span></tt></p>
</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">hpclist</span> <span class="pre">&lt;machine&gt;</span></tt></td>
<td>List images registered in the HPC infrastructure named <tt class="docutils literal"><span class="pre">machine</span></tt> (minicluster, india ...).</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">hpclistkernels</span> <span class="pre">&lt;machine&gt;</span></tt></td>
<td>List kernels available for HPC infrastructure named <tt class="docutils literal"><span class="pre">machine</span></tt> (minicluster, india ...).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h5>
<p><strong>Context Usage</strong></p>
<ul>
<li><p class="first">Show list of available contexts</p>
<div class="highlight-python"><pre>$ fg-shell -u jdiaz
fg&gt; contexts</pre>
</div>
<ul>
<li><p class="first">The output shows all available contexts</p>
<div class="highlight-python"><pre>FG Contexts:
------------
repo
image
rain
hadoop</pre>
</div>
</li>
</ul>
</li>
<li><p class="first">Users can select any of the previous contexts with the <tt class="docutils literal"><span class="pre">use</span></tt> command. Then, the environment of this particular context is initialized.</p>
<div class="highlight-python"><pre>fg&gt; use repo
fg-repo&gt;</pre>
</div>
</li>
<li><p class="first">Return to the normal context</p>
<div class="highlight-python"><pre>fg-repo&gt; use
fg&gt;</pre>
</div>
</li>
</ul>
<p><strong>Help Usage</strong></p>
<ul>
<li><p class="first">List available commands in the generic context</p>
<div class="highlight-python"><pre>$ fg-shell -u jdiaz
fg&gt; help</pre>
</div>
<ul>
<li><p class="first">The output shows the list of generic commands and the list of commands that are available in each of the contexts. Note that the commands listed for each context
are only available when that particular context has been loaded. Some contexts load other contexts as part of their requirements, as we explained before.</p>
<div class="highlight-python"><pre>A complete manual can be found in https://portal.futuregrid.org/man/fg-shell

Generic Documented commands (type help &lt;topic&gt;):
================================================
contexts  history         load    py    save    setpasswd  use
exec      historysession  manual  quit  script  shortcuts
help      li              pause   run   set     show

Image Repository commands. Execute "use repo" to use them. (type help &lt;topic&gt;):
===============================================================================
get  histimg  histuser  list  modify  put  remove  setpermission  user

Apache Hadoop commands. Execute "use hadoop" to use them. (type help &lt;topic&gt;):
==============================================================================
runjob  runscript

Image Management commands. Execute "use image" to use them. (type help &lt;topic&gt;):
================================================================================
cloudlist  cloudlistkernels  generate  hpclist  hpclistkernels  register

FG Dynamic Provisioning commands. Execute "use rain" to use them. (type help &lt;topic&gt;):
======================================================================================
launch

Please select a CONTEXT by executing use &lt;context_name&gt;
Execute 'contexts' command to see the available context names</pre>
</div>
</li>
</ul>
</li>
<li><p class="first">List available commands in the <tt class="docutils literal"><span class="pre">image</span></tt> context (this contexts also loads the <tt class="docutils literal"><span class="pre">repo</span></tt> contexts)</p>
<div class="highlight-python"><pre>fg&gt; use image
fg-image&gt; help</pre>
</div>
<ul>
<li><p class="first">The output is something like this.</p>
<div class="highlight-python"><pre>A complete manual can be found in https://portal.futuregrid.org/man/fg-shell

General documented commands (type help &lt;topic&gt;):
================================================
contexts  history         load    py    save    setpasswd  use
exec      historysession  manual  quit  script  shortcuts
help      li              pause   run   set     show

Specific documented commands in the repo context (type help &lt;topic&gt;):
=====================================================================
get  histimg  histuser  list  modify  put  remove  setpermission  user

Specific documented commands in the image context (type help &lt;topic&gt;):
======================================================================
cloudlist  cloudlistkernels  generate  hpclist  hpclistkernels  register</pre>
</div>
</li>
</ul>
</li>
</ul>
<p><strong>General Shell Usage</strong></p>
<ul>
<li><p class="first">Session example where we get an image, list all the images which <tt class="docutils literal"><span class="pre">os</span></tt> is centos, add an user and activate it.</p>
<div class="highlight-python"><pre>$ fg-shell

fg&gt; use repo
fg-repo&gt; get image123123123
fg-repo&gt; list * where os=centos
fg-repo&gt; user -a javi
fg-repo&gt; user -m javi status active</pre>
</div>
</li>
<li><p class="first">Record the executed commands in an script.</p>
<div class="highlight-python"><pre>$fg-shell
fg&gt; script myscript.txt
fg&gt; use repo
fg-repo&gt; put /tmp/image.img vmtype=xen &amp; imgtype=opennebula &amp; os=linux &amp; arch=x86_64
fg-repo&gt; list
fg-repo&gt; script end</pre>
</div>
<ul class="simple">
<li>This will create a file called myscript.txt with this content:</li>
</ul>
<blockquote>
<div><div class="highlight-python"><pre>use repo
put /tmp/image.img vmtype=xen &amp; imgtype=opennebula &amp; os=linux &amp; arch=x86_64
list</pre>
</div>
</div></blockquote>
</li>
<li><p class="first">Execute shell commands stored in a file. Then exits from the shell</p>
<div class="highlight-python"><pre>$ cat myscript.txt| fg-shell</pre>
</div>
</li>
<li><p class="first">Execute shell commands stored in a file from the shell. This stay in the shell.</p>
<div class="highlight-python"><pre>$ fg-shell -u jdiaz
fg&gt; load myscript.txt</pre>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="section" id="administrator-documentation">
<h3>Administrator Documentation<a class="headerlink" href="#administrator-documentation" title="Permalink to this headline">¶</a></h3>
<p>In this section you will find information on software deployment details.</p>
<div class="toctree-wrapper compound">
<span id="document-install"></span><span class="target" id="chap-install-futuregrid"></span><div class="section" id="installing-futuregrid-rain">
<h4>Installing FutureGrid Rain<a class="headerlink" href="#installing-futuregrid-rain" title="Permalink to this headline">¶</a></h4>
<p>You can install the FutureGrid Rain using one of the following procedures.</p>
<ul class="simple">
<li><a class="reference internal" href="index.html#easy-install"><em>Using the &#8220;easy_install&#8221; tool</em></a>. This is the simplest option, as <tt class="docutils literal"><span class="pre">easy_install</span></tt>
will take care of downloading and installing not just FutureGrid Rain but also its dependencies.
You must already have <a class="reference external" href="http://www.python.org/">Python</a> (version 2.6 or higher) and
<a class="reference external" href="http://packages.python.org/distribute/">Python Distribute</a> (version 0.6.15 or higher)
installed on your machine (or you must be able to install them). To check if both are installed,
try running <tt class="docutils literal"><span class="pre">easy_install</span> <span class="pre">--version</span></tt> from the command line. If the command is available, and it
prints out a version number equal or higher than 0.6.15, you will be able to install FutureGrid Rain
using <tt class="docutils literal"><span class="pre">easy_install</span></tt>.</li>
<li><a class="reference internal" href="index.html#source-tarball"><em>Using a source tarball</em></a>. If you are unable to install FutureGrid Rain using
<tt class="docutils literal"><span class="pre">easy_install</span></tt>, you can download a tarball with the FutureGrid Rain source code. Your machine must
have Python installed on it, but not the Python Distribute package (the tarball includes a setup
script that will automatically download and install Python Distribute for you).</li>
<li><a class="reference internal" href="index.html#github-install"><em>Downloading the latest code from GitHub</em></a>. Choose this option if you want to track
the latest code in our GitHub repository,</li>
</ul>
<div class="section" id="using-easy-install">
<span id="easy-install"></span><h5>Using <tt class="docutils literal"><span class="pre">easy_install</span></tt><a class="headerlink" href="#using-easy-install" title="Permalink to this headline">¶</a></h5>
<p>This option has the following prerequisites:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.python.org/">Python</a> 2.6 or higher. If Python is not available on your machine,
you can find installation instructions here: <a class="reference external" href="http://www.python.org/getit/">http://www.python.org/getit/</a>. Take into account that,
if you are using a Linux distribution, you should be able to install it using your distribution&#8217;s
package manager (e.g., <tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">python</span></tt> on Debian and Ubuntu). If you are using a Mac,
Python is included by default; however, if your version is too old, take a look at the following
instructions: <a class="reference external" href="http://www.python.org/getit/mac/">http://www.python.org/getit/mac/</a></li>
<li><a class="reference external" href="http://packages.python.org/distribute/">Python Distribute</a> 0.6.15 or higher. As noted above,
you can verify if this package is installed by running <tt class="docutils literal"><span class="pre">easy_install</span> <span class="pre">--version</span></tt>. If it is not
available, you can find installation instructions here: <a class="reference external" href="http://pypi.python.org/pypi/distribute#installation-instructions">http://pypi.python.org/pypi/distribute#installation-instructions</a>.
Take into account that, although Python Distribute is included as an optional package in most
Linux distributions, it is sometimes available under the name &#8220;Setuptools&#8221; (e.g., <tt class="docutils literal"><span class="pre">python-setuptools</span></tt>
in Debian and Ubuntu systems), since Python Distribute is a fork of the Setuptools project.</li>
</ul>
<p>If you meet these prerequisites, you should be able to
install FutureGrid Rain simply by running this as <tt class="docutils literal"><span class="pre">root</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre>easy_install -U futuregrid
</pre></div>
</div>
<p>If you are using Ubuntu or Mac OS X, you will likely just need to run this:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo easy_install -U futuregrid
</pre></div>
</div>
<p>If you do not have administrative privileges on your machine, you will have to install FutureGrid Rain
under your regular user account:</p>
<div class="highlight-bash"><div class="highlight"><pre>easy_install -U futuregrid --user
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Installing FutureGrid Rain in your home directory will install the FutureGrid Rain commands
in <tt class="docutils literal"><span class="pre">~/.local/bin</span></tt>, which may not be in your PATH environment variable. If not, make sure to
update the definition of your PATH environment variable (e.g., in the <tt class="docutils literal"><span class="pre">~/.profile</span></tt> file if
you are using a BASH shell).</p>
<p>Alternatively, you can also request that the commands be installed in a directory that is
already in your $PATH. You may want to use <tt class="docutils literal"><span class="pre">~/bin/</span></tt>, as most Linux distributions will
automatically include that directory in your PATH.</p>
<div class="last highlight-bash"><div class="highlight"><pre>easy_install -U futuregrid  --user -s ~/bin/
</pre></div>
</div>
</div>
</div>
<div class="section" id="using-a-source-tarball">
<span id="source-tarball"></span><h5>Using a source tarball<a class="headerlink" href="#using-a-source-tarball" title="Permalink to this headline">¶</a></h5>
<p>If you do not have Python Distribute, or are unable to install it, you can still install FutureGrid Rain
by downloading a source tarball yourself. This tarball contains an installation script
that will install and setup Python Distribute, and then proceed to install FutureGrid Rain.</p>
<p>You will first have to download the latest source tarball from the Python Package Index:
<a class="reference external" href="http://pypi.python.org/pypi/futuregrid">http://pypi.python.org/pypi/futuregrid</a></p>
<p>Next, untar the tarball and run the installation script as <tt class="docutils literal"><span class="pre">root</span></tt>:</p>
<pre class="literal-block">
tar xvzf futuregrid-1.0.tar.gz
cd futuregrid-1.0
python setup.py install
</pre>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are using Ubuntu or Mac OS X, you will likely just need to run this:</p>
<div class="last highlight-bash"><div class="highlight"><pre>sudo python setup.py install
</pre></div>
</div>
</div>
<p>If you do not have administrative privileges on your machine, you can choose to install
everything inside your home directory:</p>
<div class="highlight-bash"><div class="highlight"><pre>python setup.py install --user
</pre></div>
</div>
</div>
<div class="section" id="tracking-latest-code-from-github">
<span id="github-install"></span><h5>Tracking latest code from GitHub<a class="headerlink" href="#tracking-latest-code-from-github" title="Permalink to this headline">¶</a></h5>
<p>If you want to use the latest version of our code from our GitHub repository, the steps
are similar to installing a source tarball. However, instead of downloading a tarball, you
will use git to clone our repository on your machine. Simply run the following:</p>
<div class="highlight-bash"><div class="highlight"><pre>git clone git@github.com:futuregrid/rain.git
</pre></div>
</div>
<p>This will create a directory called <tt class="docutils literal"><span class="pre">rain</span></tt>. In it, you will find the same <tt class="docutils literal"><span class="pre">setup.py</span></tt>
script described in the previous section. If you want to install FutureGrid Rain, and not
make any modifications to the code, you should run <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">install</span></tt> as described
in the previous section.</p>
<p>If you intend to modify the code, and want the FutureGrid Rain commands to use the code
in the git repository you&#8217;ve created on your machine, you can instead install FutureGrid
Rain in &#8220;developer&#8221; mode:</p>
<div class="highlight-bash"><div class="highlight"><pre>python setup.py develop
</pre></div>
</div>
<p>This will install FutureGrid Rain but, instead of copying the Python source code
to a system directory, it will create a pointer to the source directory you checked out.
That way, any changes you make to the source code will take effect immediately
(without having to reinstall FutureGrid Rain).</p>
<p>Take into account that there are, at least, two branches in our GitHub repository: <tt class="docutils literal"><span class="pre">master</span></tt>
and <tt class="docutils literal"><span class="pre">dev</span></tt>. The former always contains the latest stable release, including bug fixes, and
the former contains the very latest version of our code (which may not work as reliably
as the code in the <tt class="docutils literal"><span class="pre">master</span></tt> branch). By default, your repository will track the <tt class="docutils literal"><span class="pre">master</span></tt>
branch. To switch to the <tt class="docutils literal"><span class="pre">dev</span></tt> branch, run the following:</p>
<div class="highlight-bash"><div class="highlight"><pre>git checkout dev
</pre></div>
</div>
<p>To pull the latest changes from our GitHub repository, run the following:</p>
<div class="highlight-bash"><div class="highlight"><pre>git pull origin
</pre></div>
</div>
</div>
</div>
<span id="document-configure_futuregrid"></span><div class="section" id="setting-up-the-futuregrid-software">
<span id="chap-configure-futuregrid"></span><h4>Setting up the FutureGrid Software<a class="headerlink" href="#setting-up-the-futuregrid-software" title="Permalink to this headline">¶</a></h4>
<div class="section" id="configuration-files">
<h5>Configuration Files<a class="headerlink" href="#configuration-files" title="Permalink to this headline">¶</a></h5>
<p>There are two places where we can locate the configuration files. Our software will look into these places in the following order:</p>
<ol class="arabic simple">
<li>In the directory <tt class="docutils literal"><span class="pre">~/.fg/</span></tt></li>
<li>In the directory <tt class="docutils literal"><span class="pre">/etc/futuregrid/</span></tt></li>
</ol>
<p>If you have installed FutureGrid Rain using the tarball file (<a class="reference internal" href="index.html#source-tarball"><em>Using a source tarball</em></a>) you will find the configuration
sample files in /etc/futuregrid/. Otherwise, you can download them as a <a class="reference external" href="futuregrid-docs-configsamples_1.0.tar.gz">tarball</a> or a <a class="reference external" href="futuregrid-docs-configsamples_1.0.zip">ZIP file</a>.</p>
<p><strong>Server Side</strong>: The configuration file has to be renamed as <tt class="docutils literal"><span class="pre">fg-server.conf</span></tt>.</p>
<p><strong>Client Side</strong>: The configuration file has to be renamed as <tt class="docutils literal"><span class="pre">fg-client.conf</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you configure several clients or servers in the same machine, the <tt class="docutils literal"><span class="pre">fg-client.conf</span></tt> or <tt class="docutils literal"><span class="pre">fg-server.conf</span></tt> must be the same file.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In the <strong>Client Side</strong>, the path of the log files must be relative to each users. Using the <tt class="docutils literal"><span class="pre">$HOME</span></tt> directory is a good idea.</p>
</div>
</div>
<div class="section" id="setting-up-ldap">
<h5>Setting up LDAP<a class="headerlink" href="#setting-up-ldap" title="Permalink to this headline">¶</a></h5>
<p>The authentication of our software is based on LDAP. So, we need to configure some options in the configuration files to make it possible.</p>
<div class="section" id="server-side">
<h6>Server Side<a class="headerlink" href="#server-side" title="Permalink to this headline">¶</a></h6>
<p>We need to configure the <tt class="docutils literal"><span class="pre">[LDAP]</span></tt> section. This is going to be use by all servers. More information about this section
of the server configuration file can be found in <a class="reference internal" href="index.html#fg-server-ldap"><em>LDAP section</em></a>.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>LDAP<span class="o">]</span>
<span class="nv">LDAPHOST</span><span class="o">=</span> ldap.futuregrid.org
<span class="nv">LDAPUSER</span><span class="o">=</span> <span class="nv">uid</span><span class="o">=</span>rainadmin,ou<span class="o">=</span>People,dc<span class="o">=</span>futuregrid,dc<span class="o">=</span>org
<span class="nv">LDAPPASS</span><span class="o">=</span> passwordrainadmin
<span class="nv">log</span><span class="o">=</span> ~/fg-auth.log
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="client-side">
<h6>Client Side<a class="headerlink" href="#client-side" title="Permalink to this headline">¶</a></h6>
<p>We need to configure the <tt class="docutils literal"><span class="pre">[LDAP]</span></tt> section. This is going to be use by the FutureGrid Shell. This allows the shell to store
your encrypted password once it has been validated. In this way, you won&#8217;t have to type to password again during that session. More information
about this section of the client configuration file can be found in <a class="reference internal" href="index.html#fg-client-ldap"><em>LDAP section</em></a>.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>LDAP<span class="o">]</span>
<span class="nv">LDAPHOST</span><span class="o">=</span>ldap.futuregrid.org
<span class="nv">log</span><span class="o">=</span>~/fg-auth.log
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<div class="section" id="setting-up-an-http-server">
<h5>Setting up an http Server<a class="headerlink" href="#setting-up-an-http-server" title="Permalink to this headline">¶</a></h5>
<p>This server will contain configuration files and kernel files that are needed by the different components of the FutureGrid software.</p>
<ol class="arabic">
<li><p class="first">Setting up an Apache server.</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo yum install httpd

or

sudo apt-get install apache2

sudo /etc/init.d/httpd start
</pre></div>
</div>
</li>
<li><p class="first">Copy all configuration files into <tt class="docutils literal"><span class="pre">/var/www/html/</span></tt> or the directory specified in <tt class="docutils literal"><span class="pre">httpd.conf</span></tt> if you are not using the default options.
The configuration files are in the FutureGrid private svn.</p>
</li>
</ol>
</div>
<div class="section" id="setting-up-the-image-repository">
<h5>Setting up the Image Repository<a class="headerlink" href="#setting-up-the-image-repository" title="Permalink to this headline">¶</a></h5>
<p>In this section we explain how to configure the Image Repository.</p>
<div class="section" id="imagerepo-config">
<span id="id1"></span><h6>Server Side<a class="headerlink" href="#imagerepo-config" title="Permalink to this headline">¶</a></h6>
<p>In the Server side we need to configure several sections. The main one is the <tt class="docutils literal"><span class="pre">[RepoServer]</span></tt> and we have to create another section with the
of the backend system that we want to use (see <a class="reference internal" href="index.html#fg-server-reposerver"><em>RepoServer section</em></a>). Our image repository support different
backends that are described in the next table:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="40%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Backend option</th>
<th class="head">Storage for Image Files</th>
<th class="head">Storage for Metadata</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>mysql</td>
<td>Posix Filesystem</td>
<td>MySQL</td>
</tr>
<tr class="row-odd"><td>mongodb</td>
<td>MongoDB</td>
<td>MongoDB</td>
</tr>
<tr class="row-even"><td>swiftmysql</td>
<td>Swift</td>
<td>MySQL</td>
</tr>
<tr class="row-odd"><td>swiftmmongo</td>
<td>Swift</td>
<td>MongoDB</td>
</tr>
<tr class="row-even"><td>cumulusmysql</td>
<td>Cumulus</td>
<td>MySQL</td>
</tr>
<tr class="row-odd"><td>cumulusmmongo</td>
<td>Cumulus</td>
<td>MongoDB</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Installation instructions for the software to be used as storage backend can be found in
<a class="reference internal" href="index.html#chap-install-repobackend"><em>Installing Image Repository Backends</em></a></p>
</div>
<p>Our predefined option is <tt class="docutils literal"><span class="pre">cumulusmongo</span></tt>. Thus, the <tt class="docutils literal"><span class="pre">[RepoServer]</span></tt> section looks like:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>RepoServer<span class="o">]</span>
<span class="nv">port</span> <span class="o">=</span> 56792
<span class="nv">proc_max</span> <span class="o">=</span> 10
<span class="nv">refresh</span> <span class="o">=</span> 20
<span class="nv">nopasswdusers</span> <span class="o">=</span> testuser:127.0.0.1,127.0.0.2; testuser2:127.0.0.1
<span class="nv">backend</span> <span class="o">=</span> cumulusmongo
<span class="nv">log</span> <span class="o">=</span> ~/reposerver.log
<span class="nv">log_level</span> <span class="o">=</span> debug
<span class="nv">ca_cert</span><span class="o">=</span> /etc/futuregrid/certs/imdserver/cacert.pem
<span class="nv">certfile</span><span class="o">=</span> /etc/futuregrid/certs/imdserver/imdscert.pem
<span class="nv">keyfile</span><span class="o">=</span> /etc/futuregrid/certs/imdserver/privkey.pem
<span class="nv">restConfFile</span> <span class="o">=</span> /etc/futuregrid/fg-restrepo.conf
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may need to configure the iptables to open the port specified in the <tt class="docutils literal"><span class="pre">port</span></tt> option to allow the communication with the client.</p>
</div>
<p>Since we have specified <tt class="docutils literal"><span class="pre">backend</span> <span class="pre">=</span> <span class="pre">cumulusmongo</span></tt>, we also have to add a section named <tt class="docutils literal"><span class="pre">[cumulusmongo]</span></tt>
(see <a class="reference internal" href="index.html#repo-backend-example"><em>Backend Example Section</em></a>)</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>cumulusmongo<span class="o">]</span>
<span class="nv">address</span> <span class="o">=</span> localhost:23000
<span class="nv">userAdmin</span> <span class="o">=</span>
<span class="nv">configfile</span> <span class="o">=</span>
<span class="nv">addressS</span> <span class="o">=</span> 192.168.1.2
<span class="nv">userAdminS</span> <span class="o">=</span> PgkhmT23FUv7aRZND7BOW
<span class="nv">configfileS</span> <span class="o">=</span> /etc/futuregrid/cumulus.conf
<span class="nv">imgStore</span> <span class="o">=</span>/temp/
</pre></div>
</div>
</div></blockquote>
<p>The <tt class="docutils literal"><span class="pre">imgStore</span></tt> directory is where the images are uploaded to the server via ssh. This is a temporal directory for all the different backends
but the mysql one. The permission of this directory must be 777 to allow everyone to upload images. Moreover, when this is used as temporal
directory, <strong>the bit t must be disabled</strong> because the user that executes the server (i.e. <tt class="docutils literal"><span class="pre">imageman</span></tt>) must be able to remove the images from
the temporal directory after it has been uploaded to the final destination. By default any directory that you creates has this bit disabled.
However, the /tmp directory existing in your system has this bit enabled.</p>
<p>The files specified in the <tt class="docutils literal"><span class="pre">configfile</span></tt> and <tt class="docutils literal"><span class="pre">configfileS</span></tt> options contain the password of the services. These files look like:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>client<span class="o">]</span>
<span class="nv">password</span><span class="o">=</span>complicatedpass
</pre></div>
</div>
</div></blockquote>
<p>In case we want to use a different configuration, we may need to install the python modules to support that.</p>
<blockquote>
<div><ul>
<li><p class="first">MySQL (MySQL has to be installed before you install the python module)</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo easy_install MySQL-python
</pre></div>
</div>
</li>
<li><p class="first">Swift</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo easy_install python-cloudfiles
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>Additionally, if we want to configure the Rest Interface Server, we need to specify the option <tt class="docutils literal"><span class="pre">restConfFile</span></tt> in <tt class="docutils literal"><span class="pre">[RepoServer]</span></tt> Section to identify its
configuration file. In this configuration file we need to specify the information about the Rest Interface. A simple configuration file is:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>global<span class="o">]</span>
log.error_file <span class="o">=</span> <span class="s1">&#39;cherrypy.error.log&#39;</span>
log.accessfile <span class="o">=</span> <span class="s1">&#39;cherrypy.access.log&#39;</span>
server.socket_host <span class="o">=</span> <span class="s2">&quot;0.0.0.0&quot;</span>
server.socket_port <span class="o">=</span> 8443
server.thread_pool <span class="o">=</span> 10
server.ssl_module<span class="o">=</span><span class="s2">&quot;builtin&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>To enable https, we need to install <tt class="docutils literal"><span class="pre">pyopenssl</span></tt>,</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>sudo easy_install python-cloudfiles

or

sudo apt-get/yum install python-openssl
</pre></div>
</div>
</div></blockquote>
<p>have x509 certificates and modify the configuration file:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>global<span class="o">]</span>
log.error_file <span class="o">=</span> <span class="s1">&#39;cherrypy.error.log&#39;</span>
log.accessfile <span class="o">=</span> <span class="s1">&#39;cherrypy.access.log&#39;</span>
server.socket_host <span class="o">=</span> <span class="s2">&quot;0.0.0.0&quot;</span>
server.socket_port <span class="o">=</span> 8443
server.thread_pool <span class="o">=</span> 10
server.ssl_module<span class="o">=</span><span class="s2">&quot;pyopenssl&quot;</span>
server.ssl_certificate<span class="o">=</span><span class="s2">&quot;server.crt&quot;</span>
server.ssl_private_key<span class="o">=</span><span class="s2">&quot;server.key&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>Once you have the configuration files ready and the backend software installed, you can start the image repository and the rest interface
servers by executing <tt class="docutils literal"><span class="pre">IRServer.py</span></tt> and <tt class="docutils literal"><span class="pre">IRRestServer.py</span></tt> respectively.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We recommend to have a system user that run all the servers. In this way it will be easier to manage the sudoers file when necessary.</p>
</div>
</div>
<div class="section" id="imagerepository-client-conf">
<span id="id2"></span><h6>Client Side<a class="headerlink" href="#imagerepository-client-conf" title="Permalink to this headline">¶</a></h6>
<p>In the client side, we need to configure the <tt class="docutils literal"><span class="pre">[Repo]</span></tt> section. More information
about this section of the client configuration file can be found in <a class="reference internal" href="index.html#fg-client-repo"><em>Repo section</em></a>.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>Repo<span class="o">]</span>
<span class="nv">port</span> <span class="o">=</span> 56792
<span class="nv">serveraddr</span><span class="o">=</span>localhost
<span class="nv">log</span><span class="o">=</span>~/clientrepo.log
<span class="nv">log_level</span><span class="o">=</span>debug
<span class="nv">ca_cert</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdclient/cacert.pem
<span class="nv">certfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdclient/imdccert.pem
<span class="nv">keyfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdclient/privkey.pem
</pre></div>
</div>
</div></blockquote>
<p>Once you have everything set up, you need to create the users in the image repository. Although users are managed in the LDAP server, the image
repository also maintain a database with users to control user&#8217;s access, quotas, store statistics, etc. This database is also used by the rest
of the framework The first user that you create will have the <tt class="docutils literal"><span class="pre">admin</span></tt> role by default. In this way, you can create more users. The command
to add an user is:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="nb">fg</span>-repo --useradd &lt;userid&gt;
</pre></div>
</div>
</div></blockquote>
<p>The executable file of this client is <tt class="docutils literal"><span class="pre">fg-repo</span></tt>. More information about how to use the image repository can be found in the <a class="reference internal" href="index.html#man-repo"><em>Image Repository Manual</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The userid created in the image repository must be the same that in LDAP.</p>
</div>
</div>
<div class="section" id="image-repository-check-list">
<h6>Image Repository Check List<a class="headerlink" href="#image-repository-check-list" title="Permalink to this headline">¶</a></h6>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="39%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">Server Side (<tt class="docutils literal"><span class="pre">fg-server.conf</span></tt>)</th>
<th class="head">Client Side (<tt class="docutils literal"><span class="pre">fg-client.conf</span></tt>)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Access to</strong></td>
<td><ul class="first last simple">
<li>Storage Backend</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Users must be able to SSH the server machine to retrieve/upload images</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><strong>Configure</strong></td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">[RepoServer]</span></tt> section</li>
<li><tt class="docutils literal"><span class="pre">[LDAP]</span></tt> section</li>
<li>Rest config file specified in <tt class="docutils literal"><span class="pre">[RepoServer]</span></tt> section</li>
</ul>
</td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">[Repo]</span></tt> section</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><strong>Executables</strong></td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">IRServer.py</span></tt> (Server for CLI)</li>
<li><tt class="docutils literal"><span class="pre">IRRestServer.py</span></tt> (Server for Rest Interface)</li>
</ul>
</td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">fg-repo</span></tt></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="setting-up-the-image-generator">
<h5>Setting up the Image Generator<a class="headerlink" href="#setting-up-the-image-generator" title="Permalink to this headline">¶</a></h5>
<p>In this section we explain how to configure the Image Generator</p>
<div class="section" id="id3">
<h6>Server Side<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h6>
<p>In the Server side we need to configure the <tt class="docutils literal"><span class="pre">[GenerateServer]</span></tt> Section (see <a class="reference internal" href="index.html#fg-server-generateserver"><em>GenerateServer section</em></a>).</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>GenerateServer<span class="o">]</span>
<span class="nv">port</span> <span class="o">=</span> 56791
<span class="nv">proc_max</span> <span class="o">=</span> 5
<span class="nv">refresh</span> <span class="o">=</span> 20
<span class="nv">wait_max</span> <span class="o">=</span> 3600
<span class="nv">nopasswdusers</span> <span class="o">=</span> testuser:127.0.0.1,127.0.0.2;testuser2:127.0.0.1
<span class="nv">vmfile_centos</span> <span class="o">=</span> 5:/srv/cloud/one/share/examples/centos5_context.one,6:/srv/cloud/one/share/examples/centos6_context.one
<span class="nv">vmfile_rhel</span> <span class="o">=</span>
<span class="nv">vmfile_ubuntu</span> <span class="o">=</span> /srv/cloud/one/share/examples/ubuntu_context.one
<span class="nv">vmfile_debian</span> <span class="o">=</span>
<span class="nv">xmlrpcserver</span> <span class="o">=</span> http://localhost:2633/RPC2
<span class="nv">bridge</span> <span class="o">=</span> br1
<span class="nv">addrnfs</span> <span class="o">=</span> 192.168.1.6
<span class="nv">tempdirserver</span> <span class="o">=</span> /srv/scratch/
<span class="nv">tempdir</span> <span class="o">=</span> /media/
<span class="nv">http_server</span> <span class="o">=</span> http://fg-gravel.futuregrid.edu/
<span class="nv">oneuser</span> <span class="o">=</span> oneadmin
<span class="nv">onepass</span> <span class="o">=</span> f8377c90fcfd699f0ddbdcb30c2c9183d2d933ea
<span class="nv">log</span> <span class="o">=</span> ~/fg-image-generate-server.log
<span class="nv">log_level</span><span class="o">=</span>debug
<span class="nv">ca_cert</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdserver/cacert.pem
<span class="nv">certfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdserver/imdscert.pem
<span class="nv">keyfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdserver/privkey.pem
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You may need to configure the iptables to open the port specified in the <tt class="docutils literal"><span class="pre">port</span></tt> option to allow the communication with the client.</p>
</div>
<p>As we described in the <a class="reference internal" href="index.html#sec-whatisimagegeneration"><em>Image Generation Section</em></a>, the Image Generator is supported by a IaaS cloud.
Currently, we use <a class="reference external" href="http://www.opennebula.org/">OpenNebula</a> for this purpose. Therefore, it is a requirement to have an OpenNebula
cloud installed and configured with at least one compute node. Additionally, you need to have the VMs that will be used to generate
the images and the templates. The VM templates are specified in the</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="c">#---------------------------------------</span>
<span class="c"># VM definition</span>
<span class="c">#---------------------------------------</span>
<span class="nv">NAME</span> <span class="o">=</span> <span class="s2">&quot;centos5&quot;</span>
<span class="nv">CPU</span>    <span class="o">=</span> 1
<span class="nv">MEMORY</span> <span class="o">=</span> 1024
<span class="nv">OS</span> <span class="o">=</span> <span class="o">[</span>
  <span class="nv">arch</span><span class="o">=</span><span class="s2">&quot;x86_64&quot;</span>
  <span class="o">]</span>
<span class="nv">DISK</span> <span class="o">=</span> <span class="o">[</span>
  <span class="nb">source</span>   <span class="o">=</span> <span class="s2">&quot;/srv/cloud/images/centos-5.6c1.img&quot;</span>,
  <span class="nv">target</span>   <span class="o">=</span> <span class="s2">&quot;hda&quot;</span>,
  <span class="nb">readonly</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span>
  <span class="o">]</span>
<span class="nv">NIC</span> <span class="o">=</span> <span class="o">[</span> <span class="nv">NETWORK_ID</span><span class="o">=</span>0<span class="o">]</span>
<span class="nv">NIC</span> <span class="o">=</span> <span class="o">[</span> <span class="nv">NETWORK_ID</span><span class="o">=</span>1<span class="o">]</span>
<span class="nv">FEATURES</span><span class="o">=[</span> <span class="nv">acpi</span><span class="o">=</span><span class="s2">&quot;no&quot;</span> <span class="o">]</span>
<span class="nv">CONTEXT</span> <span class="o">=</span> <span class="o">[</span>
   <span class="nv">files</span> <span class="o">=</span> <span class="s2">&quot;/srv/cloud/images/centos/init.sh /srv/cloud/images/imageman_key.pub&quot;</span>,
   <span class="nv">target</span> <span class="o">=</span> <span class="s2">&quot;hdc&quot;</span>,
   <span class="nv">root_pubkey</span> <span class="o">=</span> <span class="s2">&quot;imageman_key.pub&quot;</span>
   <span class="o">]</span>
<span class="nv">GRAPHICS</span> <span class="o">=</span> <span class="o">[</span>
  <span class="nb">type</span>    <span class="o">=</span> <span class="s2">&quot;vnc&quot;</span>,
  <span class="nv">listen</span>  <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>
  <span class="o">]</span>
</pre></div>
</div>
</div></blockquote>
<p>Configure the scratch directory specified in the <tt class="docutils literal"><span class="pre">tempdirserver</span></tt> option. For that, we need to export via NFS the directory to allow the VMs
to mount as scratch disk. Assuming that the <tt class="docutils literal"><span class="pre">tempdirserver</span></tt> option is <tt class="docutils literal"><span class="pre">/srv/scratch</span></tt> and the subnet is <tt class="docutils literal"><span class="pre">192.168.1.0/24</span></tt>, the configuration
steps are:</p>
<ol class="arabic">
<li><p class="first">Install NFS support</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo apt-get install nfs-common

or

sudo yum install nfs-utils
</pre></div>
</div>
</li>
<li><p class="first">Create directories</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo mkdir -p /srv/scratch
sudo chmod 777 /srv/scratch
</pre></div>
</div>
</li>
<li><p class="first">Export directories. Edit <tt class="docutils literal"><span class="pre">/etc/exports</span></tt> file to insert the following line:</p>
<div class="highlight-bash"><div class="highlight"><pre>/srv/scratch 192.168.1.*<span class="o">(</span>rw,async,no_subtree_check,no_root_squash<span class="o">)</span> 192.168.1.*<span class="o">(</span>rw,async,no_subtree_check,no_root_squash<span class="o">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Refresh NFS server</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo exportfs -r
</pre></div>
</div>
</li>
</ol>
<p>Configure user that is going to execute the server. Let&#8217;s assume that the name of this user is <tt class="docutils literal"><span class="pre">imageman</span></tt>:</p>
<ol class="arabic">
<li><p class="first">Configure ssh to don&#8217;t check the host id. This is needed for login into the VMs because the same IP will be associated to different
VMs over time. So, we need to edit the <tt class="docutils literal"><span class="pre">$HOME/.ssh/config</span></tt> file to insert the next lines. The permissons of this file is 644.</p>
<div class="highlight-bash"><div class="highlight"><pre>Host *
      StrictHostKeyChecking no
</pre></div>
</div>
</li>
<li><p class="first">Edit <tt class="docutils literal"><span class="pre">sudoers</span></tt> file by executing <tt class="docutils literal"><span class="pre">visudo</span></tt> as <tt class="docutils literal"><span class="pre">root</span></tt> user and add the following lines:</p>
<div class="highlight-bash"><div class="highlight"><pre>imageman <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/bin/python *
imageman <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /usr/sbin/chroot *
imageman <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /bin/mount *
imageman <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span> NOPASSWD: /bin/umount *
</pre></div>
</div>
</li>
</ol>
<p>Configure the Image Repository client because the Image Generation must be able to retrieve and upload images to the repository. See
<a class="reference internal" href="index.html#imagerepository-client-conf"><em>Setting up Image Repository Client</em></a>. The <tt class="docutils literal"><span class="pre">imageman</span></tt> user must be able to ssh the Image Repository
Server machine without introducing password or passphrase. Therefore, we need to put the <tt class="docutils literal"><span class="pre">imageman</span></tt> public key in the <tt class="docutils literal"><span class="pre">authorized_keys</span></tt>
of the machine where the Image Repository Server is running.</p>
<p>Once everything is set up you can start the server by execution <tt class="docutils literal"><span class="pre">IMGenerateServer.py</span></tt> as <tt class="docutils literal"><span class="pre">imageman</span></tt> user.</p>
</div>
<div class="section" id="id4">
<h6>Client Side<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h6>
<p>In the client side, we need to configure the <tt class="docutils literal"><span class="pre">[Generation]</span></tt> section. More information
about this section of the client configuration file can be found in <a class="reference internal" href="index.html#fg-client-repo"><em>Repo section</em></a>.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>Generation<span class="o">]</span>
<span class="nv">serveraddr</span> <span class="o">=</span> <span class="nb">fg</span>-gravel.futuregrid.edu
<span class="nv">port</span> <span class="o">=</span> 56791
<span class="nv">log</span><span class="o">=</span>~/clientgen.log
<span class="nv">log_level</span><span class="o">=</span>debug
<span class="nv">ca_cert</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdclient/cacert.pem
<span class="nv">certfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdclient/imdccert.pem
<span class="nv">keyfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdclient/privkey.pem
</pre></div>
</div>
</div></blockquote>
<p>The executable file of this client is <tt class="docutils literal"><span class="pre">fg-generate</span></tt>.  More information about how to use the image generation can be found in the <a class="reference internal" href="index.html#man-generate"><em>Image Generation Manual</em></a>.</p>
</div>
<div class="section" id="image-generation-check-list">
<h6>Image Generation Check List<a class="headerlink" href="#image-generation-check-list" title="Permalink to this headline">¶</a></h6>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="51%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">Server Side (<tt class="docutils literal"><span class="pre">fg-server.conf</span></tt>)</th>
<th class="head">Client Side (<tt class="docutils literal"><span class="pre">fg-client.conf</span></tt>)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Access to</strong></td>
<td><ul class="first last simple">
<li>OpenNebula Cloud</li>
<li>Image Repository (ssh access with no password or passphrase to the server machine)</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Users must be able to SSH the server machine to retrieve images</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><strong>Configure</strong></td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">[GenerateServer]</span></tt> section</li>
<li><tt class="docutils literal"><span class="pre">[LDAP]</span></tt> section</li>
<li><tt class="docutils literal"><span class="pre">/etc/sudoers</span></tt> file</li>
<li>Export scratch directory for VMs</li>
<li>Image Repository client</li>
</ul>
</td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">[Generation]</span></tt> section</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><strong>Executables</strong></td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">IMGenerateServer.py</span></tt> (Server for CLI)</li>
</ul>
</td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">fg-generate</span></tt></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="setting-up-the-image-registrator">
<h5>Setting up the Image Registrator<a class="headerlink" href="#setting-up-the-image-registrator" title="Permalink to this headline">¶</a></h5>
<p>In this section we explain how to configure the Image Registrator for Cloud and HPC infrastructures.</p>
<div class="section" id="server-side-for-cloud-infrastructures">
<h6>Server Side for Cloud infrastructures<a class="headerlink" href="#server-side-for-cloud-infrastructures" title="Permalink to this headline">¶</a></h6>
<p>Here we need to configure the <tt class="docutils literal"><span class="pre">[RegisterServerIaas]</span></tt> Section (see <a class="reference internal" href="index.html#fg-server-registerserveriaas"><em>RegisterServerIaas section</em></a>).</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>RegisterServerIaas<span class="o">]</span>
<span class="nv">port</span> <span class="o">=</span> 56793
<span class="nv">proc_max</span> <span class="o">=</span> 5
<span class="nv">refresh</span> <span class="o">=</span> 20
<span class="nv">nopasswdusers</span> <span class="o">=</span> testuser:127.0.0.1,127.0.0.2;testuser2:127.0.0.1
<span class="nv">tempdir</span> <span class="o">=</span> /temp/
<span class="nv">http_server</span><span class="o">=</span>http://fg-gravel.futuregrid.edu/
<span class="nv">default_eucalyptus_kernel</span> <span class="o">=</span> 2.6.27.21-0.1-xen
<span class="nv">eucalyptus_auth_kernels</span> <span class="o">=</span> 2.6.27.21-0.1-xen:eki-78EF12D2:eri-5BB61255; 2.6.27.21-0.1-xen-test:eki-test:eri-test
<span class="nv">default_nimbus_kernel</span> <span class="o">=</span> 2.6.27.21-0.1-xen
<span class="nv">nimbus_auth_kernels</span> <span class="o">=</span> 2.6.27.21-0.1-xen:2.6.27.21-0.1-xen:2.6.27.21-0.1-xen; test1:test1:test1
<span class="nv">default_openstack_kernel</span> <span class="o">=</span> 2.6.28-11-generic
<span class="nv">openstack_auth_kernels</span> <span class="o">=</span> 2.6.28-11-generic:aki-00000026:ari-00000027
<span class="nv">default_opennebula_kernel</span> <span class="o">=</span> 2.6.35-22-generic
<span class="nv">opennebula_auth_kernels</span> <span class="o">=</span> 2.6.35-22-generic: /srv/cloud/images/vmlinuz-2.6.35-22-generic:/srv/cloud/images/initrd-2.6.35-22-generic.img
<span class="nv">log</span> <span class="o">=</span> ~/fg-image-register-server-iaas.log
<span class="nv">log_level</span> <span class="o">=</span> debug
<span class="nv">ca_cert</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdserver/cacert.pem
<span class="nv">certfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdserver/imdscert.pem
<span class="nv">keyfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdserver/privkey.pem
</pre></div>
</div>
</div></blockquote>
<p>Configure user that is going to execute the server. Let&#8217;s assume that the name of this user is <tt class="docutils literal"><span class="pre">imageman</span></tt> and the <tt class="docutils literal"><span class="pre">tempdir</span></tt> option is <tt class="docutils literal"><span class="pre">/temp/</span></tt>.
We need to edit the <tt class="docutils literal"><span class="pre">sudoers</span></tt> file by executing <tt class="docutils literal"><span class="pre">visudo</span></tt> as <tt class="docutils literal"><span class="pre">root</span></tt> user and add the following lines:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>Defaults:imageman    !requiretty
User_Alias <span class="nv">SOFTWAREG</span> <span class="o">=</span> imageman
Cmnd_Alias <span class="nv">IMMANCOMND</span> <span class="o">=</span>
                     /bin/chmod * /temp/*, <span class="se">\</span>
                     /bin/mkdir -p /temp/*, <span class="se">\</span>
                     /bin/mount -o loop /temp/* /temp/*, <span class="se">\</span>
                     /bin/rm <span class="o">[</span>-<span class="o">]</span>* /temp/*, <span class="se">\</span>
                     /bin/sed -i s/enforcing/disabled/g /temp/*, <span class="se">\</span>
                     /bin/tar xvfz /temp/* -C /temp/*, <span class="se">\</span>
                     /bin/umount /temp/*, <span class="se">\</span>
                     /usr/bin/tee -a /temp/*, <span class="se">\</span>
                     /usr/sbin/chroot /temp/*, <span class="se">\</span>
                     /usr/bin/wget * -O /temp/*, <span class="se">\</span>
                     /bin/tar xfz /temp/* --directory /temp/*, <span class="se">\</span>
                     /bin/mv -f /temp/* /temp/*, <span class="se">\</span>
                     /bin/chown root<span class="se">\:</span>root /temp/*
SOFTWAREG <span class="nv">ALL</span> <span class="o">=</span> NOPASSWD: IMMANCOMND
</pre></div>
</div>
</div></blockquote>
<p>Configure the Image Repository client because the Image Generation must be able to retrieve and upload images to the repository. See
<a class="reference internal" href="index.html#imagerepository-client-conf"><em>Setting up Image Repository Client</em></a>. The <tt class="docutils literal"><span class="pre">imageman</span></tt> user must be able to ssh the Image Repository
Server machine without introducing password or passphrase. Therefore, we need to put the <tt class="docutils literal"><span class="pre">imageman</span></tt> public key in the <tt class="docutils literal"><span class="pre">authorized_keys</span></tt>
of the machine where the Image Repository Server is running.</p>
<p>Once everything is set up you can start the server by execution <tt class="docutils literal"><span class="pre">IMRegisterServerIaas.py</span></tt> as <tt class="docutils literal"><span class="pre">imageman</span></tt> user.</p>
</div>
<div class="section" id="server-side-for-hpc-infrastructures">
<h6>Server Side for HPC infrastructures<a class="headerlink" href="#server-side-for-hpc-infrastructures" title="Permalink to this headline">¶</a></h6>
<p>As we described in the <a class="reference internal" href="index.html#sec-whatisimageregistration"><em>Image Registration Section</em></a>, the Image Registration for HPC is supported
by a xCAT and Moab. Therefore, it is a requirement to have an such software installed in our HPC infrastructure. To interact with
xCAT and Moab we have two services called <tt class="docutils literal"><span class="pre">IMRegisterServerXcat.py</span></tt> and <tt class="docutils literal"><span class="pre">IMRegisterServerMoab.py</span></tt>, respectively.</p>
<p>The <tt class="docutils literal"><span class="pre">IMRegisterServerXcat.py</span></tt> will copy the image into the xCAT directories and register the image in the xCAT tables. Our service
can run in any machine that has the
<a class="reference external" href="http://sourceforge.net/apps/mediawiki/xcat/index.php?title=Granting_Users_xCAT_privileges">xCAT client</a> configured
and access to the directories <tt class="docutils literal"><span class="pre">/install/netboot/</span></tt>, <tt class="docutils literal"><span class="pre">/tftpboot/</span></tt> and <tt class="docutils literal"><span class="pre">/etc/xcat</span></tt>. The directories can be mounted via NFS and we
only make changes in the first two directories. The last one is needed for xCAT client.</p>
<p>Here we need to configure the <tt class="docutils literal"><span class="pre">[RegisterServerXcat]</span></tt> Section (see <a class="reference internal" href="index.html#fg-server-registerserverxcat"><em>RegisterServerXcat section</em></a>).</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>RegisterServerXcat<span class="o">]</span>
<span class="nv">xcat_port</span><span class="o">=</span>56789
<span class="nv">xcatNetbootImgPath</span><span class="o">=</span>/install/netboot/
<span class="nv">nopasswdusers</span> <span class="o">=</span> testuser:127.0.0.1,127.0.0.0;testuser:127.0.0.1
<span class="nv">http_server</span><span class="o">=</span>http://fg-gravel.futuregrid.edu/
<span class="nv">log</span><span class="o">=</span><span class="nb">fg</span>-image-register-server-xcat.log
<span class="nv">log_level</span><span class="o">=</span>debug
<span class="nv">test_mode</span><span class="o">=</span>False
<span class="nv">default_xcat_kernel_centos</span> <span class="o">=</span> 5:2.6.18-164.el5,6:2.6.32-220.4.2.el6
<span class="nv">default_xcat_kernel_ubuntu</span> <span class="o">=</span> karmic:2.6.35-22-generic,lucid:2.6.35-22-generic,maverick:2.6.35-22-generic,natty:2.6.35-22-generic
<span class="nv">auth_kernels_centos</span> <span class="o">=</span> 5:2.6.18-164.el5,2.6.18-164.el5-test12; 6:2.6.32-220.4.2.el6, 2.6.32-220.4.2.el6-test
<span class="nv">auth_kernels_ubuntu</span> <span class="o">=</span> karmic:2.6.35-22-generic,2.6.35-22-generic-test; lucid:2.6.35-22-generic;maverick:2.6.35-22-generic,2.6.35-22-generic-test12;natty:2.6.35-22-generic
<span class="nv">tempdir</span><span class="o">=</span>/temp/
<span class="nv">ca_cert</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdserver/cacert.pem
<span class="nv">certfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdserver/imdscert.pem
<span class="nv">keyfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdserver/privkey.pem
<span class="nv">max_diskusage</span><span class="o">=</span>88
</pre></div>
</div>
</div></blockquote>
<p>Configure user that is going to execute the server. Let&#8217;s assume that the name of this user is <tt class="docutils literal"><span class="pre">imageman</span></tt>  and the <tt class="docutils literal"><span class="pre">tempdir</span></tt> option is <tt class="docutils literal"><span class="pre">/temp/</span></tt>.
We need to edit the <tt class="docutils literal"><span class="pre">sudoers</span></tt> file by executing <tt class="docutils literal"><span class="pre">visudo</span></tt> as <tt class="docutils literal"><span class="pre">root</span></tt> user and add the following lines:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>Defaults:imageman    !requiretty
User_Alias <span class="nv">SOFTWAREG</span> <span class="o">=</span> imageman
Cmnd_Alias <span class="nv">IMMANCOMND</span> <span class="o">=</span> /bin/chmod 600 /install/netboot/*, <span class="se">\</span>
                     /bin/chmod 644 /install/netboot/*, <span class="se">\</span>
                     /bin/chmod 755 /install/netboot/*, <span class="se">\</span>
                     /bin/chmod 777 /install/netboot/*, <span class="se">\</span>
                     /bin/chmod +x /install/netboot/*, <span class="se">\</span>
                     /bin/chmod * /temp/*, <span class="se">\</span>
                     /bin/chown root<span class="se">\:</span>root /install/netboot/*, <span class="se">\</span>
                     /bin/cp /install/netboot/* *, <span class="se">\</span>
                     /bin/cp <span class="o">[</span>-<span class="o">]</span>* /install/netboot/* , <span class="se">\</span>
                     /bin/mkdir -p /install/netboot/*, <span class="se">\</span>
                     /bin/mkdir -p /install/netboot/*, <span class="se">\</span>
                     /bin/mkdir -p /install/netboot/* /install/netboot/*, <span class="se">\</span>
                     /bin/mkdir -p /tftpboot/xcat/*, <span class="se">\</span>
                     /bin/mkdir -p /temp/*, <span class="se">\</span>
                     /bin/mount -o loop /install/netboot/* /install/netboot/*, <span class="se">\</span>
                     /bin/mount -o loop /temp/* /temp/*, <span class="se">\</span>
                     /bin/mv -f /install/netboot/* /install/netboot/*, <span class="se">\</span>
                     /bin/mv -f /temp/* /install/netboot/*, <span class="se">\</span>
                     /bin/mv /install/netboot/* /install/netboot/*, <span class="se">\</span>
                     /bin/rm <span class="o">[</span>-<span class="o">]</span>* /install/netboot/*, <span class="se">\</span>
                     /bin/rm <span class="o">[</span>-<span class="o">]</span>* /temp/*, <span class="se">\</span>
                     /bin/sed -i s/enforcing/disabled/g /install/netboot/*, <span class="se">\</span>
                     /bin/sed -i * /install/netboot/*, <span class="se">\</span>
                     /bin/sed -i * /temp/*, <span class="se">\</span>
                     /bin/tar xfz /install/netboot/* -C /install/netboot/*, <span class="se">\</span>
                     /bin/tar xfz /install/netboot/* --directory /install/netboot/*, <span class="se">\</span>
                     /bin/tar xvfz /temp/* -C /temp/*, <span class="se">\</span>
                     /bin/umount /install/netboot/*, <span class="se">\</span>
                     /bin/umount /temp/*, <span class="se">\</span>
                     /usr/bin/tee -a /install/netboot/*, <span class="se">\</span>
                     /usr/bin/tee -a /temp/*, <span class="se">\</span>
                     /usr/bin/tee -a /opt/moab//tools/msm/images.txt, <span class="se">\</span>
                     /usr/bin/wget * -O /install/netboot/*, <span class="se">\</span>
                     /usr/bin/wget * -O /tftpboot/xcat/*, <span class="se">\</span>
                     /usr/sbin/chroot /install/netboot/*, <span class="se">\</span>
                     /usr/sbin/chroot /temp/*, <span class="se">\</span>
                     /usr/bin/wget * -O /temp/*, <span class="se">\</span>
                     /bin/tar xfz /temp/* --directory /temp/*, <span class="se">\</span>
                     /bin/mv -f /temp/* /temp/*, <span class="se">\</span>
                     /bin/chown root<span class="se">\:</span>root /temp/*
SOFTWAREG <span class="nv">ALL</span> <span class="o">=</span> NOPASSWD: IMMANCOMND
</pre></div>
</div>
</div></blockquote>
<p>Configure the Image Repository client because the Image Generation must be able to retrieve and upload images to the repository. See
<a class="reference internal" href="index.html#imagerepository-client-conf"><em>Setting up Image Repository Client</em></a>. The <tt class="docutils literal"><span class="pre">imageman</span></tt> user must be able to ssh the Image Repository
Server machine without introducing password or passphrase. Therefore, we need to put the <tt class="docutils literal"><span class="pre">imageman</span></tt> public key in the <tt class="docutils literal"><span class="pre">authorized_keys</span></tt>
of the machine where the Image Repository Server is running.</p>
<p>Once everything is set up you can start the server by execution <tt class="docutils literal"><span class="pre">IMRegisterServerXcat.py</span></tt> as <tt class="docutils literal"><span class="pre">imageman</span></tt> user.</p>
<p>On the other hand, we have the <tt class="docutils literal"><span class="pre">IMRegisterServerMoab.py</span></tt> that register the image in Moab. This server must be running in the same machine
where Moab is. In our case, it is running on the Login node. This server is very light as it only modify the <tt class="docutils literal"><span class="pre">/opt/moab/tools/msm/images.txt</span></tt>
file and recycle the Moab scheduler.</p>
<p>Here we need to configure the <tt class="docutils literal"><span class="pre">[RegisterServerMoab]</span></tt> Section (see <a class="reference internal" href="index.html#fg-server-registerservermoab"><em>RegisterServerMoab section</em></a>).</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>RegisterServerMoab<span class="o">]</span>
<span class="nv">moab_port</span> <span class="o">=</span> 56790
<span class="nv">moabInstallPath</span> <span class="o">=</span> /opt/moab/
<span class="nv">log</span> <span class="o">=</span> /var/log/fg/fg-image-register-server-moab.log
<span class="nv">log_level</span> <span class="o">=</span> debug
<span class="nv">ca_cert</span><span class="o">=</span>/etc/futuregrid/imdserver/cacert.pem
<span class="nv">certfile</span><span class="o">=</span>/etc/futuregrid/imdserver/imdscert.pem
<span class="nv">keyfile</span><span class="o">=</span>/etc/futuregrid/imdserver/privkey.pem
</pre></div>
</div>
</div></blockquote>
<p>Configure user that is going to execute the server. Let&#8217;s assume that the name of this user is <tt class="docutils literal"><span class="pre">imageman</span></tt>. We need to edit the <tt class="docutils literal"><span class="pre">sudoers</span></tt>
file by executing <tt class="docutils literal"><span class="pre">visudo</span></tt> as <tt class="docutils literal"><span class="pre">root</span></tt> user and add the following lines:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>Defaults:imageman    !requiretty
User_Alias <span class="nv">SOFTWAREG</span> <span class="o">=</span> imageman
Cmnd_Alias <span class="nv">IMMANCMND</span> <span class="o">=</span> /usr/bin/tee -a /opt/moab/tools/msm/images.txt, <span class="se">\</span>
                       /opt/moab/bin/mschedctl -R
SOFTWAREG <span class="nv">ALL</span> <span class="o">=</span> NOPASSWD: IMMANCOMND
</pre></div>
</div>
</div></blockquote>
<p>Once everything is set up you can start the server by execution <tt class="docutils literal"><span class="pre">IMRegisterServerMoab.py</span></tt> as <tt class="docutils literal"><span class="pre">imageman</span></tt> user.</p>
</div>
<div class="section" id="id5">
<h6>Client Side<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h6>
<p>In the client side, we need to configure the <tt class="docutils literal"><span class="pre">[Register]</span></tt> section. More information
about this section of the client configuration file can be found in <a class="reference internal" href="index.html#fg-client-repo"><em>Repo section</em></a>.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>Register<span class="o">]</span>
<span class="nv">xcat_port</span> <span class="o">=</span> 56789
<span class="nv">moab_port</span> <span class="o">=</span> 56790
<span class="nv">iaas_serveraddr</span> <span class="o">=</span> localhost
<span class="nv">iaas_port</span> <span class="o">=</span> 56793
<span class="nv">tempdir</span><span class="o">=</span>/tmp/
<span class="nv">http_server</span> <span class="o">=</span> http://fg-gravel.futuregrid.edu/
<span class="nv">log</span><span class="o">=</span>~/clientregister.log
<span class="nv">log_level</span><span class="o">=</span>debug
<span class="nv">ca_cert</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdclient/cacert.pem
<span class="nv">certfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdclient/imdccert.pem
<span class="nv">keyfile</span><span class="o">=</span>/opt/futuregrid/futuregrid/etc/imdclient/privkey.pem
</pre></div>
</div>
</div></blockquote>
<p>We also need to configure a section per machine supported. In our case, we support two machines <tt class="docutils literal"><span class="pre">[minicluster]</span></tt> and <tt class="docutils literal"><span class="pre">[india]</span></tt>. In this way,
users can specify the machine where they want to register their images.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>minicluster<span class="o">]</span>
<span class="nv">loginmachine</span><span class="o">=</span>localhost
<span class="nv">moabmachine</span><span class="o">=</span>localhost
<span class="nv">xcatmachine</span><span class="o">=</span>localhost

<span class="o">[</span>india<span class="o">]</span>
<span class="nv">loginmachine</span><span class="o">=</span>&lt;machine_address1&gt;
<span class="nv">moabmachine</span><span class="o">=</span>&lt;machine_address1&gt;
<span class="nv">xcatmachine</span><span class="o">=</span>&lt;machine_address1&gt;
</pre></div>
</div>
</div></blockquote>
<p>We use the euca2tools to register images in the Eucalyptus and OpenStack cloud infrastructures. Thus, they are required to be available.</p>
<p>The executable file of this client is <tt class="docutils literal"><span class="pre">fg-register</span></tt>.  More information about how to use the Image Registration can be found
in the <a class="reference internal" href="index.html#man-register"><em>Image Registration Manual</em></a>.</p>
</div>
<div class="section" id="image-registration-check-list">
<h6>Image Registration Check List<a class="headerlink" href="#image-registration-check-list" title="Permalink to this headline">¶</a></h6>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="21%" />
<col width="31%" />
<col width="13%" />
<col width="31%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">Server Side Cloud (<tt class="docutils literal"><span class="pre">fg-server.conf</span></tt>)</th>
<th class="head">Server Side HPC (<tt class="docutils literal"><span class="pre">fg-server.conf</span></tt>)</th>
<th class="head">Server Side Moab (<tt class="docutils literal"><span class="pre">fg-server.conf</span></tt>)</th>
<th class="head">Client Side (<tt class="docutils literal"><span class="pre">fg-client.conf</span></tt>)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Access to</strong></td>
<td><ul class="first last simple">
<li>Image Repository (ssh access no password/passphrase to the server machine)</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Image Repository (ssh access no password/passphrase to the server machine)</li>
<li><tt class="docutils literal"><span class="pre">/install/netboot/</span></tt>, <tt class="docutils literal"><span class="pre">/tftpboot/</span></tt> and <tt class="docutils literal"><span class="pre">/etc/xcat/</span></tt> directories of the machine where xCAT server is installed</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Execute in the machine where Moab is running</li>
<li><tt class="docutils literal"><span class="pre">/etc/moab/tools/msm/images.txt</span></tt> file</li>
</ul>
</td>
<td><ul class="first last simple">
<li>Users must be able to SSH the machine where the <tt class="docutils literal"><span class="pre">IMRegisterServerIaas.py</span></tt> server is running to retrieve images</li>
<li>Eucalyptus (Euca2ools), OpenStack (Euca2ools), Nimbus (boto) and OpenNebula</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><strong>Configure</strong></td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">[RegisterServerIaas]</span></tt> section</li>
<li><tt class="docutils literal"><span class="pre">[LDAP]</span></tt> section</li>
<li><tt class="docutils literal"><span class="pre">/etc/sudoers</span></tt> file</li>
<li>Image Repository client</li>
</ul>
</td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">[RegisterServerIaas]</span></tt> section</li>
<li><tt class="docutils literal"><span class="pre">[LDAP]</span></tt> section</li>
<li><tt class="docutils literal"><span class="pre">/etc/sudoers</span></tt> file</li>
<li>xCAT client</li>
<li>Image Repository client</li>
</ul>
</td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">[RegisterServerMoab]</span></tt> section</li>
<li><tt class="docutils literal"><span class="pre">/etc/sudoers</span></tt> file</li>
</ul>
</td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">[Register]</span></tt> section</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><strong>Executables</strong></td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">IMRegisterServerIaas.py</span></tt> (Server for CLI)</li>
</ul>
</td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">IMRegisterServerXcat.py</span></tt> (Server for CLI)</li>
</ul>
</td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">IMRegisterServerMoab.py</span></tt></li>
</ul>
</td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">fg-register</span></tt></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="setting-up-the-rain">
<h5>Setting up the Rain<a class="headerlink" href="#setting-up-the-rain" title="Permalink to this headline">¶</a></h5>
<p>In this section we explain how to configure the Rain.</p>
<div class="section" id="id6">
<h6>Client Side<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h6>
<p>Rain is currently under development and therefore its functionality is limited. The current functionality allows users to place images onto resources and run their jobs.
Hence, it makes use of the image management tools and the infrastructures clients. This means that we need to configure the <tt class="docutils literal"><span class="pre">[Rain]</span></tt> section of the
<tt class="docutils literal"><span class="pre">fg-client.conf</span></tt> file and the rest of the image management components. More information about this section of the client configuration file can be
found in <a class="reference internal" href="index.html#fg-client-rain"><em>Rain section</em></a>.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>Rain<span class="o">]</span>
<span class="nv">moab_max_wait</span> <span class="o">=</span> 480
<span class="nv">moab_images_file</span> <span class="o">=</span> /opt/moab/tools/msm/images.txt
<span class="nv">refresh</span> <span class="o">=</span> 20
<span class="nv">log</span><span class="o">=</span>~/clientrain.log
<span class="nv">log_level</span><span class="o">=</span>debug
</pre></div>
</div>
</div></blockquote>
<p>The executable file of this client is <tt class="docutils literal"><span class="pre">fg-rain</span></tt>.  More information about how to use the Rain can be found in the <a class="reference internal" href="index.html#man-rain"><em>Rain Manual</em></a>.</p>
</div>
<div class="section" id="rain-check-list">
<h6>Rain Check List<a class="headerlink" href="#rain-check-list" title="Permalink to this headline">¶</a></h6>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">Client Side (<tt class="docutils literal"><span class="pre">fg-client.conf</span></tt>)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Access to</strong></td>
<td><ul class="first last simple">
<li>Moab/Torque client</li>
<li>Eucalyptus, OpenStack, Nimbus and OpenNebula</li>
<li>FutureGrid Image Management services</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><strong>Configure</strong></td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">[Rain]</span></tt> section</li>
<li>Client and Servers of the Image Repository, Generation and Registration componenets</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><strong>Executables</strong></td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">fg-rain</span></tt></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="setting-up-the-futuregrid-shell">
<h5>Setting up the FutureGrid Shell<a class="headerlink" href="#setting-up-the-futuregrid-shell" title="Permalink to this headline">¶</a></h5>
<p>In this section we explain how to configure the FutureGrid Shell.</p>
<p>The FutureGrid Shell is a client side interface. Therefore, we need to configure the <tt class="docutils literal"><span class="pre">[fg-shell]</span></tt> section of the <tt class="docutils literal"><span class="pre">fg-client.conf</span></tt> file.
More information about this section of the client configuration file can be found in <a class="reference internal" href="index.html#fg-client-fgshell"><em>fg-shell section</em></a>.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span><span class="nb">fg</span>-shell<span class="o">]</span>
<span class="nb">history</span><span class="o">=</span>~/fgshellhist.txt
<span class="nv">log</span><span class="o">=</span>~/fg-shell.log
<span class="nv">log_level</span><span class="o">=</span>debug
</pre></div>
</div>
</div></blockquote>
<p>Since this shell is a wrapper for our tools, we need to configure each individual tool before we can use all the advantages of the shell. Moreover, we need to configure the
<tt class="docutils literal"><span class="pre">[LDAP]</span></tt> section in the <tt class="docutils literal"><span class="pre">fg-client.conf</span></tt> file.</p>
<p>The executable file of this client is <tt class="docutils literal"><span class="pre">fg-shell</span></tt>.  More information about how to use the FutureGrid Shell can be found in the <a class="reference internal" href="index.html#man-shell"><em>FutureGrid Shell Manual</em></a>.</p>
<div class="section" id="futuregrid-shell-check-list">
<h6>FutureGrid Shell Check List<a class="headerlink" href="#futuregrid-shell-check-list" title="Permalink to this headline">¶</a></h6>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&nbsp;</th>
<th class="head">Client Side (<tt class="docutils literal"><span class="pre">fg-client.conf</span></tt>)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Access to</strong></td>
<td><ul class="first last simple">
<li>FutureGrid Image Management services</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><strong>Configure</strong></td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">[fg-shell]</span></tt> section</li>
<li><tt class="docutils literal"><span class="pre">[LDAP]</span></tt> section</li>
<li>Client and Servers of the Image Repository, Generation and Registration componenets</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><strong>Executables</strong></td>
<td><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">fg-shell</span></tt></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-install_repobackend"></span><div class="section" id="installing-image-repository-backends">
<span id="chap-install-repobackend"></span><h4>Installing Image Repository Backends<a class="headerlink" href="#installing-image-repository-backends" title="Permalink to this headline">¶</a></h4>
<div class="section" id="deployment-of-mongodb">
<h5>Deployment of MongoDB<a class="headerlink" href="#deployment-of-mongodb" title="Permalink to this headline">¶</a></h5>
<p>In this section we are going to explain how to install a single MongoDB service. More information can be found in <a class="reference external" href="http://www.mongodb.org/">MongoDB</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In MongoDB the databases and tables are created automatically</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">MongoDB is case sensitive</p>
</div>
<div class="section" id="install-mongodb-on-rhel">
<h6>Install MongoDB on RHEL<a class="headerlink" href="#install-mongodb-on-rhel" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">For all 64-bit RPM-based distributions with yum, create the file <tt class="docutils literal"><span class="pre">/etc/yum.repos.d/10gen.repo</span></tt> and add the following lines:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="o">[</span>10gen<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>10gen Repository
<span class="nv">baseurl</span><span class="o">=</span>http://downloads-distro.mongodb.org/repo/redhat/os/x86_64
<span class="nv">gpgcheck</span><span class="o">=</span>0
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Install MongoDB</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>sudo yum install mongo-*
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create DB directory</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>sudo mkdir -p /data/db/
sudo chown <span class="sb">`</span>id -u<span class="sb">`</span> /data/db     <span class="c">#The owner must be the user that is going to execute mongodb server</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Run MongoDB</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>mongod --port 23000 --dbpath /data/db/ --fork --logpath<span class="o">=</span>/data/db/mongo.log
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<p><strong>Rebuild spider monkey</strong></p>
<p>This is only needed if after running MongoDB you get warning message like this:</p>
<blockquote>
<div><div class="highlight-bash"><pre>warning: some regex utf8 things will not work.  pcre build doesn't have --enable-unicode-properties</pre>
</div>
</div></blockquote>
<p>Rebuilding spider monkey from RHEL (<a class="reference external" href="http://www.mongodb.org/display/DOCS/Building+Spider+Monkey">Building Spider Monkey</a>).</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>sudo yum erase xulrunner
sudo yum install curl
curl -O ftp://ftp.mozilla.org/pub/mozilla.org/js/js-1.7.0.tar.gz
tar zxvf js-1.7.0.tar.gz
<span class="nb">cd </span>js/src
<span class="nb">export </span><span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">&quot;-DJS_C_STRINGS_ARE_UTF8&quot;</span>
make -f Makefile.ref
<span class="nv">JS_DIST</span><span class="o">=</span>/usr make -f Makefile.ref <span class="nb">export</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="install-mongodb-on-ubuntu-10-10">
<h6>Install MongoDB on Ubuntu 10.10<a class="headerlink" href="#install-mongodb-on-ubuntu-10-10" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Add MongoDB repository to the aptitude soucers file <tt class="docutils literal"><span class="pre">/etc/apt/sources.list</span></tt>.</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>deb http://downloads.mongodb.org/distros/ubuntu 10.10 10gen
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Install MongoDB</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>sudo apt-key adv --keyserver keyserver.ubuntu.com --recv 7F0CEB10
sudo apt-get update
sudo apt-get install mongodb-stable
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create DB directory</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>sudo mkdir -p /data/db/
sudo chown <span class="sb">`</span>id -u<span class="sb">`</span> /data/db
Run MongoDB
mongod --port 23000 --dbpath /data/db/ --fork --logpath<span class="o">=</span>/data/db/mongo.log
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="install-mongodb-on-macosx">
<h6>Install MongoDB on MacOSX<a class="headerlink" href="#install-mongodb-on-macosx" title="Permalink to this headline">¶</a></h6>
<p>Via homebrew (<a class="reference external" href="http://www.mongodb.org/display/DOCS/Quickstart+OS+X">MongoDB OSX</a>)</p>
<ul>
<li><p class="first">Install homebrew if you have not yet done</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>ruby -e <span class="s2">&quot;$(curl -fsSLk https://gist.github.com/raw/323731/install_homebrew.rb)&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Install mongodb via homebrew</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>brew update
brew install mongodb
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create DB directory</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>sudo mkdir -p /data/db/
sudo chown <span class="sb">`</span>id -u<span class="sb">`</span> /data/db
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Run MongoDB</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>/usr/local/Cellar/mongodb/1.6.5-x86_64/bin/mongod --port 23000 --dbpath /data/db/ --fork --logpath<span class="o">=</span>/data/db/mongo.log
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Work with client by executing mongo localhost:23000 in a different terminal</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>db.foo.save <span class="o">(</span> <span class="o">{</span>a:1<span class="o">}</span> <span class="o">)</span>
db.foo.find <span class="o">()</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">In case you use macports, replace two first steps with</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>sudo port install mongodb
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="deployment-of-cumulus">
<h5>Deployment of Cumulus<a class="headerlink" href="#deployment-of-cumulus" title="Permalink to this headline">¶</a></h5>
<p>In this section we are going to explain how to install and configure Cumulus. More information can be found in <a class="reference external" href="http://www.nimbusproject.org/">Nimbus Project</a></p>
<ul>
<li><p class="first">Check the dependencies from the <a class="reference external" href="http://www.nimbusproject.org/docs/2.8/admin/z2c/service-dependencies.html">Cumulus Requirements</a>.</p>
</li>
<li><p class="first">Download and Install the software</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>wget http://www.nimbusproject.org/downloads/nimbus-iaas-2.9-src.tar.gz

tar vxfz nimbus-iaas-2.9-src.tar.gz
<span class="nb">cd </span>nimbus-iaas-2.9-src/cumulus
sudo mkdir /opt/cumulus
sudo chown -R user:user /opt/cumulus
./cumulus-install.sh /opt/cumulus/
mkdir ~/.nimbus
cp /opt/cumulus/etc/cumulus.ini ~/.nimbus
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Test the software</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd</span> /opt/cumulus/tests
./run-all.sh
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Run service</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>/opt/cumulus/bin/cumulus &amp;
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create user</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>/opt/cumulus/bin/cumulus-add-user javi
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p class="first">Output:</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>ID : eqe0YoRAs2GT1sDvPZKAU
password : S9Ii7QqcCQxDecrezMn6o5frSFvXhThYWmCE4S7nAf
quota : None
canonical_id : 048db304-6b4c-11df-897b-001de0a80259
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember the <tt class="docutils literal"><span class="pre">ID</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt> to fill out the fg-server.conf file (the <tt class="docutils literal"><span class="pre">ID</span></tt> will be the <tt class="docutils literal"><span class="pre">userAdminS</span></tt> and the <tt class="docutils literal"><span class="pre">password</span></tt> will be in
the file specified in <tt class="docutils literal"><span class="pre">configfileS</span></tt>). More details can be found in <a class="reference internal" href="index.html#imagerepo-config"><em>Configure Image Repository</em></a>.</p>
</div>
<ul class="simple">
<li>More Information<ul>
<li><a class="reference external" href="http://www.nimbusproject.org/docs/2.9/faq.html#cumulusnonimbus">Cumulus F.A.Q.</a></li>
<li><a class="reference external" href="http://www.mcs.anl.gov/~bresnaha/cumulus/cumulusinst.html">Cumulus Video</a></li>
<li><a class="reference external" href="http://www.nimbusproject.org/docs/2.9/admin/reference.html#cumulus">Cumulus Administrator Reference</a></li>
<li><a class="reference external" href="ttps://github.com/nimbusproject/nimbus/blob/master/cumulus/docs/QUICKSTART.txt">Cumulus Quickstarth</a></li>
<li><a class="reference external" href="https://github.com/nimbusproject/nimbus/blob/master/cumulus/docs/README.txt">Cumulus Readme</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="deployment-of-mysql">
<h5>Deployment of MySQL<a class="headerlink" href="#deployment-of-mysql" title="Permalink to this headline">¶</a></h5>
<p>In this section we are going to explain how to install and configure MySQL.</p>
<ul>
<li><p class="first">Installing MySQL</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>apt-get install mysql-client mysql-common mysql-server

or

yum install mysql mysql-server mysql-devel
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Login into Mysql</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>mysql -u root -p
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create User that will manage the image repository databases</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>CREATE USER <span class="s1">&#39;IRUser&#39;</span>@<span class="s1">&#39;localhost&#39;</span> IDENTIFIED BY <span class="s1">&#39;complicatedpass&#39;</span>;
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create databases. The name of the database is different depending on the configuration selected in the Image Repository (see <a class="reference internal" href="index.html#imagerepo-config"><em>Configure Image Repository</em></a>).</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="24%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><p class="first last">Backend option</p>
</th>
<th class="head"><p class="first last">Database Name</p>
</th>
<th class="head"><p class="first last">Command to create the Database</p>
</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><p class="first last">mysql</p>
</td>
<td><p class="first last">images</p>
</td>
<td><p class="first last">create database images;</p>
</td>
</tr>
<tr class="row-odd"><td><p class="first last">swiftmysql</p>
</td>
<td><p class="first last">imagesS</p>
</td>
<td><p class="first last">create database imagesS;</p>
</td>
</tr>
<tr class="row-even"><td><p class="first last">cumulusmysql</p>
</td>
<td><p class="first last">imagesC</p>
</td>
<td><p class="first last">create database imagesC;</p>
</td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p class="first">Create the tables for the selected database. This example is with the <tt class="docutils literal"><span class="pre">images</span></tt> databases. You will need to do the same with the others if you plan to use
these storage configurations.</p>
<ul>
<li><p class="first">Select the database to be used</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>use images;
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Create tables</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>create table meta <span class="o">(</span> imgId varchar<span class="o">(</span>100<span class="o">)</span> primary key, os varchar<span class="o">(</span>100<span class="o">)</span>, arch varchar<span class="o">(</span>100<span class="o">)</span>, owner varchar<span class="o">(</span>100<span class="o">)</span>, description varchar<span class="o">(</span>200<span class="o">)</span>,
    tag varchar<span class="o">(</span>200<span class="o">)</span>, vmType  varchar<span class="o">(</span>100<span class="o">)</span>, imgType varchar<span class="o">(</span>100<span class="o">)</span>, permission varchar<span class="o">(</span>100<span class="o">)</span>, imgStatus varchar<span class="o">(</span>100<span class="o">)</span> <span class="o">)</span>;

create table data <span class="o">(</span> imgId varchar<span class="o">(</span>100<span class="o">)</span> primary key, imgMetaData varchar<span class="o">(</span>100<span class="o">)</span>, imgUri varchar<span class="o">(</span>200<span class="o">)</span>, createdDate datetime, lastAccess datetime,
     accessCount long, size long, extension varchar <span class="o">(</span>50<span class="o">)</span>, FOREIGN KEY <span class="o">(</span>imgMetaData<span class="o">)</span> REFERENCES meta<span class="o">(</span>imgId<span class="o">)</span> ON UPDATE CASCADE ON DELETE CASCADE <span class="o">)</span>;

create table users <span class="o">(</span>userId varchar<span class="o">(</span>100<span class="o">)</span> primary key, cred varchar<span class="o">(</span>200<span class="o">)</span>, fsCap long, fsUsed long, lastLogin datetime, status varchar<span class="o">(</span>100<span class="o">)</span>,
     role varchar<span class="o">(</span>100<span class="o">)</span>, ownedimgs long<span class="o">)</span>;
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Give all permission to the user created</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>GRANT ALL PRIVILEGES ON images.* TO <span class="s1">&#39;IRUser&#39;</span> IDENTIFIED BY <span class="s1">&#39;userpassword&#39;</span>;
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember the <tt class="docutils literal"><span class="pre">userId</span></tt> (<tt class="docutils literal"><span class="pre">IRUser</span></tt>) and <tt class="docutils literal"><span class="pre">password</span></tt> (<tt class="docutils literal"><span class="pre">userpassword</span></tt>) to fill out the fg-server.conf file (the <tt class="docutils literal"><span class="pre">userId</span></tt> will be the <tt class="docutils literal"><span class="pre">userAdmin</span></tt> and
the <tt class="docutils literal"><span class="pre">password</span></tt> will be in the file specified in <tt class="docutils literal"><span class="pre">configfile</span></tt>). More details can be found in <a class="reference internal" href="index.html#imagerepo-config"><em>Configure Image Repository</em></a>.</p>
</div>
</div>
<div class="section" id="deployment-of-swift">
<h5>Deployment of Swift<a class="headerlink" href="#deployment-of-swift" title="Permalink to this headline">¶</a></h5>
<p>OpenStack provides some manuals to explain how to deploy Swift.</p>
<ul class="simple">
<li>Manual to deploy a <a class="reference external" href="http://swift.openstack.org/development_saio.html">Test Infrastructure</a>.</li>
<li>Manual to deploy a <a class="reference external" href="http://swift.openstack.org/howto_installmultinode.html">Multi-Node Infrastructure</a>. In this case, we recommend
installing the proxy server in the same machine where the Image Repository is installed.</li>
</ul>
<p><strong>Notes for RHEL 5</strong></p>
<ul>
<li><p class="first">Install Python 2.6</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>sudo rpm -Uvh http://yum.chrislea.com/centos/5/i386/chl-release-5-3.noarch.rpm
sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CHL
sudo yum install python26
sudo yum install python26-devel

or

sudo wget ftp://ftp.univie.ac.at/systems/linux/fedora/epel/5/i386/epel-release-5-4.noarch.rpm
sudo rpm -Uvh epel-release-5-4.noarch.rpm
sudo yum install python26
sudo yum install python26-devel
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Setuptools</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>yum install python26-distribute
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Install python modules</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>easy_install-2.6 netifaces eventlet setuptools virtualenv paste PasteDeploy webob pysqlite uuid xattr repoze.what configobj coverage formencode
netifaces nose paramiko paste pastedeploy pastescript scgi
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Install sqlite3</p>
<blockquote>
<div><div class="highlight-bash"><div class="highlight"><pre>wget http://dl.atrpms.net/el5-x86_64/atrpms/testing/sqlite-3.6.20-1.el5.x86_64.rpm
wget http://dl.atrpms.net/el5-x86_64/atrpms/testing/sqlite-devel-3.6.20-1.el5.x86_64.rpm
rpm -Uvh sqlite-3.6.20-1.el5.x86_64.rpm sqlite-devel-3.6.20-1.el5.x86_64.rpm
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Differences with the Swift manuals for the &#8220;Storage nodes&#8221;</p>
<ul>
<li><p class="first">Step 4. /etc/xinetd.d/rsync to enable it</p>
</li>
<li><p class="first">Step 5. service xinetd restart</p>
</li>
<li><p class="first">Iptable config (/etc/sysconfig/iptalbes). Add this:</p>
<div class="highlight-bash"><div class="highlight"><pre>-A RH-Firewall-1-INPUT -p udp -m udp --dport 6000 -j ACCEPT
-A RH-Firewall-1-INPUT -p tcp -m tcp --dport 6000 -j ACCEPT
-A RH-Firewall-1-INPUT -p udp -m udp --dport 6001 -j ACCEPT
-A RH-Firewall-1-INPUT -p tcp -m tcp --dport 6001 -j ACCEPT
-A RH-Firewall-1-INPUT -p udp -m udp --dport 6002 -j ACCEPT
-A RH-Firewall-1-INPUT -p tcp -m tcp --dport 6002 -j ACCEPT
</pre></div>
</div>
</li>
<li><p class="first">If you don&#8217;t have another partition, you can create a file. In this case we don&#8217;t have xfs support, so we use ext3</p>
<div class="highlight-bash"><div class="highlight"><pre>dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>/srv/swift-disk <span class="nv">bs</span><span class="o">=</span>1024 <span class="nv">count</span><span class="o">=</span>0 <span class="nv">seek</span><span class="o">=</span>20000000
mkfs.ext3 /srv/swift-disk
</pre></div>
</div>
</li>
<li><p class="first">Edit /etc/fstab and add</p>
<div class="highlight-bash"><div class="highlight"><pre>/srv/swift-disk /srv/node/sdb1 ext3  loop,noatime,user_xattr 0 0
</pre></div>
</div>
</li>
<li><p class="first">Mount it</p>
<div class="highlight-bash"><div class="highlight"><pre>mount /srv/swift-disk
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember the <tt class="docutils literal"><span class="pre">userId:usergroup</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt> to fill out the fg-server.conf file (the <tt class="docutils literal"><span class="pre">userId:usergroup</span></tt> will be the <tt class="docutils literal"><span class="pre">userAdminS</span></tt> and the <tt class="docutils literal"><span class="pre">password</span></tt> will be in
the file specified in <tt class="docutils literal"><span class="pre">configfileS</span></tt>). More details can be found in <a class="reference internal" href="index.html#imagerepo-config"><em>Configure Image Repository</em></a>. Swift users are defined in
the file <tt class="docutils literal"><span class="pre">/etc/swift/proxy-server.conf</span></tt>.</p>
</div>
</div>
</div>
<span id="document-config_ref_index"></span><div class="section" id="configuration-file-reference">
<span id="chap-config-ref"></span><h4>Configuration file reference<a class="headerlink" href="#configuration-file-reference" title="Permalink to this headline">¶</a></h4>
<div class="toctree-wrapper compound">
<span id="document-config_ref_server"></span><div class="section" id="fg-server-conf-configuration-file">
<span id="sec-fg-server-conf"></span><h5><tt class="docutils literal"><span class="pre">fg-server.conf</span></tt> configuration file<a class="headerlink" href="#fg-server-conf-configuration-file" title="Permalink to this headline">¶</a></h5>
<div class="section" id="section-ldap">
<span id="fg-server-ldap"></span><h6>Section <tt class="docutils literal"><span class="pre">[LDAP]</span></tt><a class="headerlink" href="#section-ldap" title="Permalink to this headline">¶</a></h6>
<p>This section is used to configure the access to LDAP to verify the user passwords.</p>
<p><em>This section is required by all services</em></p>
<div class="section" id="option-ldaphost">
<h7>Option <tt class="docutils literal"><span class="pre">LDAPHOST</span></tt><a class="headerlink" href="#option-ldaphost" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Hostname or IP address of the LDAP server that manages the user&#8217;s authentication.</p>
</div>
<div class="section" id="option-ldapuser">
<h7>Option <tt class="docutils literal"><span class="pre">LDAPUSER</span></tt><a class="headerlink" href="#option-ldapuser" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> user-dn</p>
<p><strong>Required:</strong> Yes</p>
<p>This is the DN of an user that have read access to the encrypted passwords of every user. This looks
like <tt class="docutils literal"><span class="pre">uid=USER,ou=People,dc=futuregrid,dc=org</span></tt></p>
</div>
<div class="section" id="option-ldappass">
<h7>Option <tt class="docutils literal"><span class="pre">LDAPPASS</span></tt><a class="headerlink" href="#option-ldappass" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Password of the user specified in the previous section.</p>
</div>
<div class="section" id="option-log">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#option-log" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="option-test">
<h7>Option <tt class="docutils literal"><span class="pre">test</span></tt><a class="headerlink" href="#option-test" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">True</span></tt>, <tt class="docutils literal"><span class="pre">False</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>This option is for development purposes. For security reasons, the LDAP server cannot be contacted from outside of FutureGrid network.
Therefore, we need this option to go test our services before we deploy them on production.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="section-reposerver">
<span id="fg-server-reposerver"></span><h6>Section <tt class="docutils literal"><span class="pre">[RepoServer]</span></tt><a class="headerlink" href="#section-reposerver" title="Permalink to this headline">¶</a></h6>
<p>This section is used to configure the Image Repository Server. To complete the configuration of this service we need to configure also a
:ref:<tt class="docutils literal"><span class="pre">Repository</span> <span class="pre">Backend</span> <span class="pre">&lt;repo_backend_example&gt;</span></tt> section.</p>
<div class="section" id="option-port">
<h7>Option <tt class="docutils literal"><span class="pre">port</span></tt><a class="headerlink" href="#option-port" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Image Repository server will be listening.</p>
</div>
<div class="section" id="option-proc-max">
<h7>Option <tt class="docutils literal"><span class="pre">proc_max</span></tt><a class="headerlink" href="#option-proc-max" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Maximum number of request that can be processed at the same time.</p>
</div>
<div class="section" id="option-refresh">
<h7>Option <tt class="docutils literal"><span class="pre">refresh</span></tt><a class="headerlink" href="#option-refresh" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Interval to check the status of the running requests when <tt class="docutils literal"><span class="pre">proc_max</span></tt> is reached and determine if new request can be processed.</p>
</div>
<div class="section" id="option-authorizedusers">
<h7>Option <tt class="docutils literal"><span class="pre">authorizedusers</span></tt><a class="headerlink" href="#option-authorizedusers" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String-list (comma separated)</p>
<p><strong>Required:</strong> No</p>
<p>List of users (separated by commas) that can use the Image Repository in behalf of other users. This could be useful for other FutureGrid
services that need to call the repository in behalf of an user. This also prevents that other users can hack the client to use the
repository as if they were other users.</p>
</div>
<div class="section" id="option-nopasswdusers">
<h7>Option <tt class="docutils literal"><span class="pre">nopasswdusers</span></tt><a class="headerlink" href="#option-nopasswdusers" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Dictionary-list (semicolon separated)</p>
<p><strong>Required:</strong> No</p>
<p>Users listed here does need to introduce their password when using the Image Repository. Each user will be associated to one or several
IP address. The format is <tt class="docutils literal"><span class="pre">userid:ip,ip1;</span> <span class="pre">userid1:ip2,ip3</span></tt>.</p>
</div>
<div class="section" id="option-backend">
<h7>Option <tt class="docutils literal"><span class="pre">backend</span></tt><a class="headerlink" href="#option-backend" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">mongodb</span></tt>, <tt class="docutils literal"><span class="pre">mysql</span></tt>, <tt class="docutils literal"><span class="pre">swiftmysql</span></tt>, <tt class="docutils literal"><span class="pre">swiftmongo</span></tt>, <tt class="docutils literal"><span class="pre">cumulusmysql</span></tt>, <tt class="docutils literal"><span class="pre">cumulusmongo</span></tt></p>
<p><strong>Required:</strong> Yes</p>
<p>Specify the desired storage backend (see <a class="reference internal" href="index.html#imagerepo-config"><em>Image Repository Backend Table</em></a> for more details). The value specified
in this option will be the name of a section that has the configuration. See <a class="reference internal" href="index.html#repo-backend-example"><em>Backend example</em></a> below.</p>
</div>
<div class="section" id="id1">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="option-log-level">
<h7>Option <tt class="docutils literal"><span class="pre">log_level</span></tt><a class="headerlink" href="#option-log-level" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">debug</span></tt>, <tt class="docutils literal"><span class="pre">error</span></tt>, <tt class="docutils literal"><span class="pre">warning</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>Desired log level. The default option is <tt class="docutils literal"><span class="pre">debug</span></tt>.</p>
</div>
<div class="section" id="option-ca-cert">
<h7>Option <tt class="docutils literal"><span class="pre">ca_cert</span></tt><a class="headerlink" href="#option-ca-cert" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> ca-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of CA certificate (PEM-encoded) used to generate user and service certificates.</p>
</div>
<div class="section" id="option-certfile">
<h7>Option <tt class="docutils literal"><span class="pre">certfile</span></tt><a class="headerlink" href="#option-certfile" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> service-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the certificate (PEM-encoded) used by the Image Repository.</p>
</div>
<div class="section" id="option-keyfile">
<h7>Option <tt class="docutils literal"><span class="pre">keyfile</span></tt><a class="headerlink" href="#option-keyfile" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> key-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the private key (PEM-encoded) of the certificate specified in <tt class="docutils literal"><span class="pre">certfile</span></tt>.</p>
</div>
<div class="section" id="option-restconffile">
<h7>Option <tt class="docutils literal"><span class="pre">restConfFile</span></tt><a class="headerlink" href="#option-restconffile" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> file-path</p>
<p><strong>Required:</strong> No</p>
<p>Location of the configuration file for the Image Repository Rest Interface.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="section-cumulusmongo">
<span id="repo-backend-example"></span><h6>Section <tt class="docutils literal"><span class="pre">[cumulusmongo]</span></tt><a class="headerlink" href="#section-cumulusmongo" title="Permalink to this headline">¶</a></h6>
<p>This sections is an example of a backend configurations.</p>
<div class="section" id="option-address">
<h7>Option <tt class="docutils literal"><span class="pre">address</span></tt><a class="headerlink" href="#option-address" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the server where MongoDB or MySQL are listening. In the case of MongoDB we can use a list of <tt class="docutils literal"><span class="pre">address:ports</span></tt> separated by commas.
In MySQL we only specify the <tt class="docutils literal"><span class="pre">address</span></tt> of the server.</p>
</div>
<div class="section" id="option-useradmin">
<h7>Option <tt class="docutils literal"><span class="pre">userAdmin</span></tt><a class="headerlink" href="#option-useradmin" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>User that is going to access MongoDB or MySQL to store/retrieve the data. Although the option is required, it can be with no value.</p>
</div>
<div class="section" id="option-configfile">
<h7>Option <tt class="docutils literal"><span class="pre">configFile</span></tt><a class="headerlink" href="#option-configfile" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> file-path</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file that contains the password of the user specified in <tt class="docutils literal"><span class="pre">userAdmin</span></tt>. Although the option is required, it can
be with no value.</p>
</div>
<div class="section" id="option-addresss">
<h7>Option <tt class="docutils literal"><span class="pre">addressS</span></tt><a class="headerlink" href="#option-addresss" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the server where the complementary service is listening. Currently, this complementary service can be Cumulus or Swift.
In both cases we only specify the <tt class="docutils literal"><span class="pre">address</span></tt> of the server.</p>
</div>
<div class="section" id="option-useradmins">
<h7>Option <tt class="docutils literal"><span class="pre">userAdminS</span></tt><a class="headerlink" href="#option-useradmins" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>User that is going to access the complementary service (Cumulus or Swift) to store/retrieve the data. In the case of Swift, the user is
typically <tt class="docutils literal"><span class="pre">&lt;user-name&gt;</span></tt>:<tt class="docutils literal"><span class="pre">&lt;group-name&gt;</span></tt>.</p>
</div>
<div class="section" id="option-configfiles">
<h7>Option <tt class="docutils literal"><span class="pre">configFileS</span></tt><a class="headerlink" href="#option-configfiles" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> file-path</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file that contains the password of the user specified in <tt class="docutils literal"><span class="pre">userAdminS</span></tt>.</p>
</div>
<div class="section" id="option-imgstore">
<h7>Option <tt class="docutils literal"><span class="pre">imgStore</span></tt><a class="headerlink" href="#option-imgstore" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> directory-path</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the directory where images are uploaded to the server. This is a temporal directory in all cases but MySQL. When this is a temporal
directory the permission must be <tt class="docutils literal"><span class="pre">777</span></tt> without the <strong>t bit</strong>, because the user that is running the server must be able to remove the images
once they are stored in the final destination. This bit is disable by default when you create a directory. However the <tt class="docutils literal"><span class="pre">/tmp/</span></tt>
directory has this bit enabled.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="section-generateserver">
<span id="fg-server-generateserver"></span><h6>Section <tt class="docutils literal"><span class="pre">[GenerateServer]</span></tt><a class="headerlink" href="#section-generateserver" title="Permalink to this headline">¶</a></h6>
<p>This section is used to configure the Image Generation Server.</p>
<div class="section" id="id2">
<h7>Option <tt class="docutils literal"><span class="pre">port</span></tt><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Image Generation server will be listening.</p>
</div>
<div class="section" id="id3">
<h7>Option <tt class="docutils literal"><span class="pre">proc_max</span></tt><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Maximum number of request that can be processed at the same time.</p>
</div>
<div class="section" id="id4">
<h7>Option <tt class="docutils literal"><span class="pre">refresh</span></tt><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Interval to check the status of the running requests when <tt class="docutils literal"><span class="pre">proc_max</span></tt> is reached and determine if new request can be processed.</p>
</div>
<div class="section" id="option-wait-max">
<h7>Option <tt class="docutils literal"><span class="pre">wait_max</span></tt><a class="headerlink" href="#option-wait-max" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Maximum time that the service will wait for an image to boot, that is, the time from <tt class="docutils literal"><span class="pre">penn</span></tt> status to the <tt class="docutils literal"><span class="pre">runn</span></tt> one. If the time
is exceeded, the VM is killed and the Image Generation request fails.</p>
</div>
<div class="section" id="id5">
<h7>Option <tt class="docutils literal"><span class="pre">nopasswdusers</span></tt><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Dictionary-list (semicolon separated)</p>
<p><strong>Required:</strong> No</p>
<p>Users listed here does need to introduce their password when using the Image Generation. Each user will be associated to one or several
IP address. The format is <tt class="docutils literal"><span class="pre">userid:ip,ip1;</span> <span class="pre">userid1:ip2,ip3</span></tt>.</p>
</div>
<div class="section" id="option-vmfile-os-name">
<h7>Option <tt class="docutils literal"><span class="pre">vmfile_&lt;os-name&gt;</span></tt><a class="headerlink" href="#option-vmfile-os-name" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the OpenNebula VM templates that boots the VMs where the image requested by the user will be generated. Currently,
four OSes are considered: <tt class="docutils literal"><span class="pre">centos</span></tt>, <tt class="docutils literal"><span class="pre">rhel</span></tt>, <tt class="docutils literal"><span class="pre">ubuntu</span></tt> and <tt class="docutils literal"><span class="pre">debian</span></tt>. Therefore, we will have four options named
<tt class="docutils literal"><span class="pre">vmfile_centos</span></tt>, <tt class="docutils literal"><span class="pre">vmfile_rhel</span></tt>, <tt class="docutils literal"><span class="pre">vmfile_ubuntu</span></tt>, <tt class="docutils literal"><span class="pre">vmfile_debian</span></tt>. However, only <tt class="docutils literal"><span class="pre">centos</span></tt> and <tt class="docutils literal"><span class="pre">ubuntu</span></tt> are implemented.
The other options have to be there but we do not need to specify any value until they are implemented. In the case of CentOS, the value is
a list of <tt class="docutils literal"><span class="pre">&lt;version&gt;:&lt;template-file-location&gt;</span></tt> separated by commas because CentOS 5 is not compatible with CentOS 6.</p>
</div>
<div class="section" id="option-xmlrpcserver">
<h7>Option <tt class="docutils literal"><span class="pre">xmlrpcserver</span></tt><a class="headerlink" href="#option-xmlrpcserver" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> URL</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the OpenNebula service. It should be something like <tt class="docutils literal"><span class="pre">http://localhost:2633/RPC2</span></tt></p>
</div>
<div class="section" id="option-bridge">
<h7>Option <tt class="docutils literal"><span class="pre">bridge</span></tt><a class="headerlink" href="#option-bridge" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Bridge where the VM network interface will be attached. This is used to identify the IP that OpenNebula has assigned to the VM.</p>
</div>
<div class="section" id="option-addrnfs">
<h7>Option <tt class="docutils literal"><span class="pre">addrnfs</span></tt><a class="headerlink" href="#option-addrnfs" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the machine that shares the directory <tt class="docutils literal"><span class="pre">tempdirserver</span></tt>. This address must be in the same network that the VM address.</p>
</div>
<div class="section" id="option-tempdirserver">
<h7>Option <tt class="docutils literal"><span class="pre">tempdirserver</span></tt><a class="headerlink" href="#option-tempdirserver" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the directory shared with the VMs. This directory will be used as scratch partition for the Vms. In this way, the VM disks can
be small and we don&#8217;t need to transfer the image back to the server. Users must be able to read the files in this directory to retrieve
their images when needed.</p>
</div>
<div class="section" id="option-tempdir">
<h7>Option <tt class="docutils literal"><span class="pre">tempdir</span></tt><a class="headerlink" href="#option-tempdir" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the <tt class="docutils literal"><span class="pre">tempdirserver</span></tt> directory inside the VM when it is mounted via NFS.</p>
</div>
<div class="section" id="option-http-server">
<h7>Option <tt class="docutils literal"><span class="pre">http_server</span></tt><a class="headerlink" href="#option-http-server" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> URL</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the http server that keeps configuration files needed to generate the images. Thus, the VMs has to have access to this http
server.</p>
</div>
<div class="section" id="option-oneuser">
<h7>Option <tt class="docutils literal"><span class="pre">oneuser</span></tt><a class="headerlink" href="#option-oneuser" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> URL</p>
<p><strong>Required:</strong> Yes</p>
<p>User that will manage the VMs for the Image Generation server. It could be <tt class="docutils literal"><span class="pre">oneadmin</span></tt> directly or a user created for this purpose.</p>
</div>
<div class="section" id="option-onepass">
<h7>Option <tt class="docutils literal"><span class="pre">onepass</span></tt><a class="headerlink" href="#option-onepass" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> URL</p>
<p><strong>Required:</strong> Yes</p>
<p>Password of the user specified in <tt class="docutils literal"><span class="pre">oneuser</span></tt>. You get that password by executing <tt class="docutils literal"><span class="pre">oneuser</span> <span class="pre">list</span></tt> as <tt class="docutils literal"><span class="pre">oneadmin</span></tt> user.</p>
</div>
<div class="section" id="id6">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="id7">
<h7>Option <tt class="docutils literal"><span class="pre">log_level</span></tt><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">debug</span></tt>, <tt class="docutils literal"><span class="pre">error</span></tt>, <tt class="docutils literal"><span class="pre">warning</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>Desired log level. The default option is <tt class="docutils literal"><span class="pre">debug</span></tt>.</p>
</div>
<div class="section" id="id8">
<h7>Option <tt class="docutils literal"><span class="pre">ca_cert</span></tt><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> ca-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of CA certificate (PEM-encoded) used to generate user and service certificates.</p>
</div>
<div class="section" id="id9">
<h7>Option <tt class="docutils literal"><span class="pre">certfile</span></tt><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> service-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the certificate (PEM-encoded) used by the Image Generation server.</p>
</div>
<div class="section" id="id10">
<h7>Option <tt class="docutils literal"><span class="pre">keyfile</span></tt><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> key-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the private key (PEM-encoded) of the certificate specified in <tt class="docutils literal"><span class="pre">certfile</span></tt>.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="section-registerserverxcat">
<span id="fg-server-registerserverxcat"></span><h6>Section <tt class="docutils literal"><span class="pre">[RegisterServerXcat]</span></tt><a class="headerlink" href="#section-registerserverxcat" title="Permalink to this headline">¶</a></h6>
<p>This section is used to configure the Image Registration xCAT Server for HPC infrastructures.</p>
<div class="section" id="option-xcat-port">
<h7>Option <tt class="docutils literal"><span class="pre">xcat_port</span></tt><a class="headerlink" href="#option-xcat-port" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Image Registration xCAT server will be listening.</p>
</div>
<div class="section" id="option-xcatnetbootimgpath">
<h7>Option <tt class="docutils literal"><span class="pre">xcatNetbootImgPath</span></tt><a class="headerlink" href="#option-xcatnetbootimgpath" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the directory used by xCAT to store the netboot images. Typically, this is <tt class="docutils literal"><span class="pre">/install/netboot</span></tt></p>
</div>
<div class="section" id="id11">
<h7>Option <tt class="docutils literal"><span class="pre">nopasswdusers</span></tt><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Dictionary-list (semicolon separated)</p>
<p><strong>Required:</strong> No</p>
<p>Users listed here does need to introduce their password when using the Image Registration xCAT. Each user will be associated to one or several
IP address. The format is <tt class="docutils literal"><span class="pre">userid:ip,ip1;</span> <span class="pre">userid1:ip2,ip3</span></tt>.</p>
</div>
<div class="section" id="id12">
<h7>Option <tt class="docutils literal"><span class="pre">http_server</span></tt><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> URL</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the http server that keeps configuration files needed to adapt the images and get the kernel files.</p>
</div>
<div class="section" id="id13">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="id14">
<h7>Option <tt class="docutils literal"><span class="pre">log_level</span></tt><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">debug</span></tt>, <tt class="docutils literal"><span class="pre">error</span></tt>, <tt class="docutils literal"><span class="pre">warning</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>Desired log level. The default option is <tt class="docutils literal"><span class="pre">debug</span></tt>.</p>
</div>
<div class="section" id="option-test-mode">
<h7>Option <tt class="docutils literal"><span class="pre">test_mode</span></tt><a class="headerlink" href="#option-test-mode" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">True</span></tt>,``False``</p>
<p><strong>Required:</strong> No</p>
<p>This option is for testing the service in a machine without xCAT. The default value is False.</p>
</div>
<div class="section" id="option-default-xcat-kernel-os-name">
<h7>Option <tt class="docutils literal"><span class="pre">default_xcat_kernel_&lt;os-name&gt;</span></tt><a class="headerlink" href="#option-default-xcat-kernel-os-name" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Dictionary-List (comma separated)</p>
<p><strong>Required:</strong> Yes</p>
<p>Default kernel name for each supported OS. The syntax is a list of <tt class="docutils literal"><span class="pre">&lt;os_version&gt;</span></tt>:<tt class="docutils literal"><span class="pre">&lt;kernel_version&gt;</span></tt> separated by commas.
Currently, two OSes are considered: <tt class="docutils literal"><span class="pre">centos</span></tt> and <tt class="docutils literal"><span class="pre">ubuntu</span></tt>. Therefore, we will have two options named
<tt class="docutils literal"><span class="pre">default_xcat_kernel_centos</span></tt> and <tt class="docutils literal"><span class="pre">default_xcat_kernel_ubuntu</span></tt></p>
</div>
<div class="section" id="option-auth-kernels-os-name">
<h7>Option <tt class="docutils literal"><span class="pre">auth_kernels_&lt;os-name&gt;</span></tt><a class="headerlink" href="#option-auth-kernels-os-name" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Dictionary-list (semicolon separated)</p>
<p><strong>Required:</strong> Yes</p>
<p>Authorized kernels for each supported OS. The syntax is <tt class="docutils literal"><span class="pre">&lt;os_version&gt;:&lt;kernel1&gt;,&lt;kernel2&gt;;</span> <span class="pre">&lt;os_version2&gt;:&lt;kernel3&gt;,&lt;kernel4&gt;</span></tt>.
Currently, two OSes are considered: <tt class="docutils literal"><span class="pre">centos</span></tt> and <tt class="docutils literal"><span class="pre">ubuntu</span></tt>. Therefore, we will have two options named
<tt class="docutils literal"><span class="pre">auth_kernels_centos</span></tt> and <tt class="docutils literal"><span class="pre">auth_kernels_ubuntu</span></tt>.</p>
</div>
<div class="section" id="id15">
<h7>Option <tt class="docutils literal"><span class="pre">tempdir</span></tt><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the scratch directory used to extract the image and read the manifest. Then, the image is moved to the real directory
using the manifest information.</p>
</div>
<div class="section" id="id16">
<h7>Option <tt class="docutils literal"><span class="pre">ca_cert</span></tt><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> ca-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of CA certificate (PEM-encoded) used to generate user and service certificates.</p>
</div>
<div class="section" id="id17">
<h7>Option <tt class="docutils literal"><span class="pre">certfile</span></tt><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> service-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the certificate (PEM-encoded) used by the Image Registration server.</p>
</div>
<div class="section" id="id18">
<h7>Option <tt class="docutils literal"><span class="pre">keyfile</span></tt><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> key-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the private key (PEM-encoded) of the certificate specified in <tt class="docutils literal"><span class="pre">certfile</span></tt>.</p>
</div>
<div class="section" id="option-max-diskusage">
<h7>Option <tt class="docutils literal"><span class="pre">max_diskusage</span></tt><a class="headerlink" href="#option-max-diskusage" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer (percentage)</p>
<p><strong>Required:</strong> Yes</p>
<p>Maximum usage of the partition where the <tt class="docutils literal"><span class="pre">xcatNetbootImgPath</span></tt> is located. This is specified in percentage. If the usage is higher than
this value, we do not allow to register more images.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="section-registerservermoab">
<span id="fg-server-registerservermoab"></span><h6>Section <tt class="docutils literal"><span class="pre">[RegisterServerMoab]</span></tt><a class="headerlink" href="#section-registerservermoab" title="Permalink to this headline">¶</a></h6>
<p>This section is used to configure the Image Registration Moab Server for HPC infrastructures.</p>
<div class="section" id="option-moab-port">
<h7>Option <tt class="docutils literal"><span class="pre">moab_port</span></tt><a class="headerlink" href="#option-moab-port" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Image Registration Moab server will be listening.</p>
</div>
<div class="section" id="option-moabinstallpath">
<h7>Option <tt class="docutils literal"><span class="pre">moabInstallPath</span></tt><a class="headerlink" href="#option-moabinstallpath" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Location where Moab is installed. For example <tt class="docutils literal"><span class="pre">/opt/moab/</span></tt></p>
</div>
<div class="section" id="id19">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="id20">
<h7>Option <tt class="docutils literal"><span class="pre">log_level</span></tt><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">debug</span></tt>, <tt class="docutils literal"><span class="pre">error</span></tt>, <tt class="docutils literal"><span class="pre">warning</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>Desired log level. The default option is <tt class="docutils literal"><span class="pre">debug</span></tt>.</p>
</div>
<div class="section" id="id21">
<h7>Option <tt class="docutils literal"><span class="pre">ca_cert</span></tt><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> ca-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of CA certificate (PEM-encoded) used to generate user and service certificates.</p>
</div>
<div class="section" id="id22">
<h7>Option <tt class="docutils literal"><span class="pre">certfile</span></tt><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> service-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the certificate (PEM-encoded) used by the Image Registration server.</p>
</div>
<div class="section" id="id23">
<h7>Option <tt class="docutils literal"><span class="pre">keyfile</span></tt><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> key-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the private key (PEM-encoded) of the certificate specified in <tt class="docutils literal"><span class="pre">certfile</span></tt>.</p>
</div>
</div>
<hr class="docutils" id="fg-server-registerserveriaas" />
<div class="section" id="section-registerserveriaas">
<h6>Section <tt class="docutils literal"><span class="pre">[RegisterServerIaas]</span></tt><a class="headerlink" href="#section-registerserveriaas" title="Permalink to this headline">¶</a></h6>
<p>This section is used to configure the Image Registration Server for Cloud infrastructures.</p>
<div class="section" id="id24">
<h7>Option <tt class="docutils literal"><span class="pre">port</span></tt><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Image Registration IaaS server will be listening.</p>
</div>
<div class="section" id="id25">
<h7>Option <tt class="docutils literal"><span class="pre">proc_max</span></tt><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Maximum number of request that can be processed at the same time.</p>
</div>
<div class="section" id="id26">
<h7>Option <tt class="docutils literal"><span class="pre">refresh</span></tt><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Interval to check the status of the running requests when <tt class="docutils literal"><span class="pre">proc_max</span></tt> is reached and determine if new request can be processed.</p>
</div>
<div class="section" id="id27">
<h7>Option <tt class="docutils literal"><span class="pre">nopasswdusers</span></tt><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Dictionary-list (semicolon separated)</p>
<p><strong>Required:</strong> No</p>
<p>Users listed here does need to introduce their password when using the Image Registration IaaS. Each user will be associated to one or several
IP address. The format is <tt class="docutils literal"><span class="pre">userid:ip,ip1;</span> <span class="pre">userid1:ip2,ip3</span></tt>.</p>
</div>
<div class="section" id="id28">
<h7>Option <tt class="docutils literal"><span class="pre">tempdir</span></tt><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the scratch directory where images are copied and modified. The permisson has to be <tt class="docutils literal"><span class="pre">777</span></tt> with the <strong>t bit</strong> disabled to
allow the user that executes the server remove the original image. This bit is disable by default when you create a directory.
However the <tt class="docutils literal"><span class="pre">/tmp/</span></tt> directory has this bit enabled.</p>
</div>
<div class="section" id="option-default-infrastructure-name-kernel">
<h7>Option <tt class="docutils literal"><span class="pre">default_&lt;infrastructure-name&gt;_kernel</span></tt><a class="headerlink" href="#option-default-infrastructure-name-kernel" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Default kernel that will be used when registering an image in such infrastructure. <tt class="docutils literal"><span class="pre">&lt;infrastructure-name&gt;</span></tt> can be <tt class="docutils literal"><span class="pre">eucalyptus</span></tt>,
<tt class="docutils literal"><span class="pre">openstack</span></tt>, <tt class="docutils literal"><span class="pre">nimbus</span></tt> and <tt class="docutils literal"><span class="pre">opennebula</span></tt>. Therefore, we will have two options named
<tt class="docutils literal"><span class="pre">default_eucalyptus_kernel</span></tt>, <tt class="docutils literal"><span class="pre">default_openstack_kernel</span></tt>, <tt class="docutils literal"><span class="pre">default_nimbus_kernel</span></tt> and <tt class="docutils literal"><span class="pre">default_opennebula_kernel</span></tt>.</p>
</div>
<div class="section" id="option-infrastructure-name-auth-kernels">
<h7>Option <tt class="docutils literal"><span class="pre">&lt;infrastructure-name&gt;_auth_kernels</span></tt><a class="headerlink" href="#option-infrastructure-name-auth-kernels" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> List (semicolon separated)</p>
<p><strong>Required:</strong> Yes</p>
<p>Authorized kernels for registering an image in such infrastructure. <tt class="docutils literal"><span class="pre">&lt;infrastructure-name&gt;</span></tt> can be <tt class="docutils literal"><span class="pre">eucalyptus</span></tt>,
<tt class="docutils literal"><span class="pre">openstack</span></tt>, <tt class="docutils literal"><span class="pre">nimbus</span></tt> and <tt class="docutils literal"><span class="pre">opennebula</span></tt>. Therefore, we will have two options named
<tt class="docutils literal"><span class="pre">eucalyptus_auth_kernels</span></tt>, <tt class="docutils literal"><span class="pre">openstack_auth_kernels</span></tt>, <tt class="docutils literal"><span class="pre">nimbus_auth_kernels</span></tt> and <tt class="docutils literal"><span class="pre">opennebula_auth_kernels</span></tt>.
The syntax is <tt class="docutils literal"><span class="pre">eucalyptus_auth_kernels</span> <span class="pre">=</span> <span class="pre">&lt;kernel1&gt;:eki:eri;&lt;kernel2&gt;:eki:eri</span></tt>. Nimbus uses the name to identify the kernel,
but we keep the syntax just in case they change in the future. OpenNebula does not have ids for now and we have to use the location of the
files.</p>
</div>
<div class="section" id="id29">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="id30">
<h7>Option <tt class="docutils literal"><span class="pre">log_level</span></tt><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">debug</span></tt>, <tt class="docutils literal"><span class="pre">error</span></tt>, <tt class="docutils literal"><span class="pre">warning</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>Desired log level. The default option is <tt class="docutils literal"><span class="pre">debug</span></tt>.</p>
</div>
<div class="section" id="id31">
<h7>Option <tt class="docutils literal"><span class="pre">ca_cert</span></tt><a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> ca-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of CA certificate (PEM-encoded) used to generate user and service certificates.</p>
</div>
<div class="section" id="id32">
<h7>Option <tt class="docutils literal"><span class="pre">certfile</span></tt><a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> service-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the certificate (PEM-encoded) used by the Image Registration server.</p>
</div>
<div class="section" id="id33">
<h7>Option <tt class="docutils literal"><span class="pre">keyfile</span></tt><a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> key-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the private key (PEM-encoded) of the certificate specified in <tt class="docutils literal"><span class="pre">certfile</span></tt>.</p>
</div>
</div>
</div>
<span id="document-config_ref_client"></span><div class="section" id="fg-client-conf-configuration-file">
<span id="sec-fg-client-conf"></span><h5><tt class="docutils literal"><span class="pre">fg-client.conf</span></tt> configuration file<a class="headerlink" href="#fg-client-conf-configuration-file" title="Permalink to this headline">¶</a></h5>
<div class="section" id="section-fg-shell">
<span id="fg-client-fgshell"></span><h6>Section <tt class="docutils literal"><span class="pre">[fg-shell]</span></tt><a class="headerlink" href="#section-fg-shell" title="Permalink to this headline">¶</a></h6>
<p>This section is used to configure the FutureGrid Shell.</p>
<div class="section" id="option-history">
<h7>Option <tt class="docutils literal"><span class="pre">history</span></tt><a class="headerlink" href="#option-history" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> history-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the executed commands are stored.</p>
</div>
<div class="section" id="option-log">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#option-log" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="option-log-level">
<h7>Option <tt class="docutils literal"><span class="pre">log_level</span></tt><a class="headerlink" href="#option-log-level" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">debug</span></tt>,``error``,``warning``,``info``</p>
<p><strong>Required:</strong> No</p>
<p>Desired log level. The default option is <tt class="docutils literal"><span class="pre">debug</span></tt>.</p>
</div>
<div class="section" id="option-script">
<h7>Option <tt class="docutils literal"><span class="pre">script</span></tt><a class="headerlink" href="#option-script" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the default file where the commands executed are recorded after we active the <tt class="docutils literal"><span class="pre">script</span></tt> command in the shell. More information
about how to use the FutureGrid Shell can be found in</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">link to the shell user manual</p>
</div>
<hr class="docutils" />
</div>
</div>
<div class="section" id="section-ldap">
<span id="fg-client-ldap"></span><h6>Section <tt class="docutils literal"><span class="pre">[LDAP]</span></tt><a class="headerlink" href="#section-ldap" title="Permalink to this headline">¶</a></h6>
<p><em>This section is required only by the FutureGrid Shell</em></p>
<div class="section" id="option-ldaphost">
<h7>Option <tt class="docutils literal"><span class="pre">LDAPHOST</span></tt><a class="headerlink" href="#option-ldaphost" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Hostname or IP address of the LDAP server that manages the user&#8217;s authentication.</p>
</div>
<div class="section" id="id1">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="option-test">
<h7>Option <tt class="docutils literal"><span class="pre">test</span></tt><a class="headerlink" href="#option-test" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">True</span></tt>, <tt class="docutils literal"><span class="pre">False</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>This option is for development purposes. For security reasons, the LDAP server cannot be contacted from outside of FutureGrid network.
Therefore, we need this option to go test our services before we deploy them on production.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="section-repo">
<span id="fg-client-repo"></span><h6>Section <tt class="docutils literal"><span class="pre">[Repo]</span></tt><a class="headerlink" href="#section-repo" title="Permalink to this headline">¶</a></h6>
<p>This section is used to configure the Image Repository client.</p>
<div class="section" id="option-port">
<h7>Option <tt class="docutils literal"><span class="pre">port</span></tt><a class="headerlink" href="#option-port" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Image Repository server will be listening.</p>
</div>
<div class="section" id="option-serveraddr">
<h7>Option <tt class="docutils literal"><span class="pre">serveraddr</span></tt><a class="headerlink" href="#option-serveraddr" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the machine where the Image Repository server is running.</p>
</div>
<div class="section" id="id2">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="id3">
<h7>Option <tt class="docutils literal"><span class="pre">log_level</span></tt><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">debug</span></tt>, <tt class="docutils literal"><span class="pre">error</span></tt>, <tt class="docutils literal"><span class="pre">warning</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>Desired log level. The default option is <tt class="docutils literal"><span class="pre">debug</span></tt>.</p>
</div>
<div class="section" id="option-ca-cert">
<h7>Option <tt class="docutils literal"><span class="pre">ca_cert</span></tt><a class="headerlink" href="#option-ca-cert" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> ca-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of CA certificate (PEM-encoded) used to generate user and service certificates.</p>
</div>
<div class="section" id="option-certfile">
<h7>Option <tt class="docutils literal"><span class="pre">certfile</span></tt><a class="headerlink" href="#option-certfile" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> service-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the certificate (PEM-encoded) used by the Image Repository client.</p>
</div>
<div class="section" id="option-keyfile">
<h7>Option <tt class="docutils literal"><span class="pre">keyfile</span></tt><a class="headerlink" href="#option-keyfile" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> key-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the private key (PEM-encoded) of the certificate specified in <tt class="docutils literal"><span class="pre">certfile</span></tt>.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="section-generation">
<span id="fg-client-generation"></span><h6>Section <tt class="docutils literal"><span class="pre">[Generation]</span></tt><a class="headerlink" href="#section-generation" title="Permalink to this headline">¶</a></h6>
<p>This section is used to configure the Image Generation client.</p>
<div class="section" id="id4">
<h7>Option <tt class="docutils literal"><span class="pre">port</span></tt><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Image Repository server will be listening.</p>
</div>
<div class="section" id="id5">
<h7>Option <tt class="docutils literal"><span class="pre">serveraddr</span></tt><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the machine where the Image Generation server is running.</p>
</div>
<div class="section" id="id6">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="id7">
<h7>Option <tt class="docutils literal"><span class="pre">log_level</span></tt><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">debug</span></tt>, <tt class="docutils literal"><span class="pre">error</span></tt>, <tt class="docutils literal"><span class="pre">warning</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>Desired log level. The default option is <tt class="docutils literal"><span class="pre">debug</span></tt>.</p>
</div>
<div class="section" id="id8">
<h7>Option <tt class="docutils literal"><span class="pre">ca_cert</span></tt><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> ca-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of CA certificate (PEM-encoded) used to generate user and service certificates.</p>
</div>
<div class="section" id="id9">
<h7>Option <tt class="docutils literal"><span class="pre">certfile</span></tt><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> service-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the certificate (PEM-encoded) used by the Image Generation client.</p>
</div>
<div class="section" id="id10">
<h7>Option <tt class="docutils literal"><span class="pre">keyfile</span></tt><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> key-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the private key (PEM-encoded) of the certificate specified in <tt class="docutils literal"><span class="pre">certfile</span></tt>.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="section-register">
<span id="fg-client-register"></span><h6>Section <tt class="docutils literal"><span class="pre">[Register]</span></tt><a class="headerlink" href="#section-register" title="Permalink to this headline">¶</a></h6>
<p>This section is used to configure the Image Registration client. To complete the configuration of this service we need to configure also the
:ref:<tt class="docutils literal"><span class="pre">Machines</span> <span class="pre">&lt;fg-client_machines&gt;</span></tt> sections.</p>
<div class="section" id="option-xcat-port">
<h7>Option <tt class="docutils literal"><span class="pre">xcat_port</span></tt><a class="headerlink" href="#option-xcat-port" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Image Registration xCAT server will be listening.</p>
</div>
<div class="section" id="option-moab-port">
<h7>Option <tt class="docutils literal"><span class="pre">moab_port</span></tt><a class="headerlink" href="#option-moab-port" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Image Registration Moab server will be listening.</p>
</div>
<div class="section" id="option-iaas-serveraddr">
<h7>Option <tt class="docutils literal"><span class="pre">iaas_serveraddr</span></tt><a class="headerlink" href="#option-iaas-serveraddr" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the machine where the Image Registration server for Cloud is running.</p>
</div>
<div class="section" id="option-iaas-port">
<h7>Option <tt class="docutils literal"><span class="pre">iaas_port</span></tt><a class="headerlink" href="#option-iaas-port" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Image Registration xCAT server will be listening.</p>
</div>
<div class="section" id="option-tempdir">
<h7>Option <tt class="docutils literal"><span class="pre">tempdir</span></tt><a class="headerlink" href="#option-tempdir" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> No</p>
<p>Location of the scratch directory to extract images when <tt class="docutils literal"><span class="pre">--justregister</span></tt> option is used. If this option is not provided
the current directory will be used.</p>
</div>
<div class="section" id="option-http-server">
<h7>Option <tt class="docutils literal"><span class="pre">http_server</span></tt><a class="headerlink" href="#option-http-server" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> URL</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the http server that keeps configuration files.</p>
</div>
<div class="section" id="id11">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="id12">
<h7>Option <tt class="docutils literal"><span class="pre">log_level</span></tt><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">debug</span></tt>, <tt class="docutils literal"><span class="pre">error</span></tt>, <tt class="docutils literal"><span class="pre">warning</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>Desired log level. The default option is <tt class="docutils literal"><span class="pre">debug</span></tt>.</p>
</div>
<div class="section" id="id13">
<h7>Option <tt class="docutils literal"><span class="pre">ca_cert</span></tt><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> ca-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of CA certificate (PEM-encoded) used to generate user and service certificates.</p>
</div>
<div class="section" id="id14">
<h7>Option <tt class="docutils literal"><span class="pre">certfile</span></tt><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> service-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the certificate (PEM-encoded) used by the Image Repository client.</p>
</div>
<div class="section" id="id15">
<h7>Option <tt class="docutils literal"><span class="pre">keyfile</span></tt><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> key-cert</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the private key (PEM-encoded) of the certificate specified in <tt class="docutils literal"><span class="pre">certfile</span></tt>.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="sections-minicluster-and-india">
<span id="fg-client-machines"></span><h6>Sections <tt class="docutils literal"><span class="pre">[minicluster]</span></tt> and <tt class="docutils literal"><span class="pre">[india]</span></tt><a class="headerlink" href="#sections-minicluster-and-india" title="Permalink to this headline">¶</a></h6>
<div class="section" id="option-loginmachine">
<h7>Option <tt class="docutils literal"><span class="pre">loginmachine</span></tt><a class="headerlink" href="#option-loginmachine" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the login machine of the target cluster.</p>
</div>
<div class="section" id="option-moabmachine">
<h7>Option <tt class="docutils literal"><span class="pre">moabmachine</span></tt><a class="headerlink" href="#option-moabmachine" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the machine where machine where Moab is installed and therefore the <tt class="docutils literal"><span class="pre">IMRegisterServerMoab.py</span></tt> is running.</p>
</div>
<div class="section" id="option-xcatmachine">
<h7>Option <tt class="docutils literal"><span class="pre">xcatmachine</span></tt><a class="headerlink" href="#option-xcatmachine" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the machine where machine where the <tt class="docutils literal"><span class="pre">IMRegisterServerXcat.py</span></tt> is running.</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="section-rain">
<span id="fg-client-rain"></span><h6>Section <tt class="docutils literal"><span class="pre">[Rain]</span></tt><a class="headerlink" href="#section-rain" title="Permalink to this headline">¶</a></h6>
<div class="section" id="option-moab-max-wait">
<h7>Option <tt class="docutils literal"><span class="pre">moab_max_wait</span></tt><a class="headerlink" href="#option-moab-max-wait" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Maximum time that we wait for a image registered on Moab to became available.</p>
</div>
<div class="section" id="option-moab-images-file">
<h7>Option <tt class="docutils literal"><span class="pre">moab_images_file</span></tt><a class="headerlink" href="#option-moab-images-file" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where Moab stores the list of images. If the image requested is not there, we do not wait.</p>
</div>
<div class="section" id="option-refresh">
<h7>Option <tt class="docutils literal"><span class="pre">refresh</span></tt><a class="headerlink" href="#option-refresh" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Interval to check the job status.</p>
</div>
<div class="section" id="id16">
<h7>Option <tt class="docutils literal"><span class="pre">log</span></tt><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the logs will be stored.</p>
</div>
<div class="section" id="id17">
<h7>Option <tt class="docutils literal"><span class="pre">log_level</span></tt><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">debug</span></tt>, <tt class="docutils literal"><span class="pre">error</span></tt>, <tt class="docutils literal"><span class="pre">warning</span></tt>, <tt class="docutils literal"><span class="pre">info</span></tt></p>
<p><strong>Required:</strong> No</p>
<p>Desired log level. The default option is <tt class="docutils literal"><span class="pre">debug</span></tt>.</p>
</div>
</div>
</div>
<span id="document-config_ref_restrepo"></span><div class="section" id="image-repository-rest-interface-configuration-file">
<span id="sec-fg-restrepo-conf"></span><h5>Image Repository Rest Interface configuration file<a class="headerlink" href="#image-repository-rest-interface-configuration-file" title="Permalink to this headline">¶</a></h5>
<div class="section" id="section-global">
<span id="fg-restrepo-global"></span><h6>Section <tt class="docutils literal"><span class="pre">[Global]</span></tt><a class="headerlink" href="#section-global" title="Permalink to this headline">¶</a></h6>
<div class="section" id="option-log-error-file">
<h7>Option <tt class="docutils literal"><span class="pre">log.error_file</span></tt><a class="headerlink" href="#option-log-error-file" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the error logs will be stored.</p>
</div>
<div class="section" id="option-log-accessfile">
<h7>Option <tt class="docutils literal"><span class="pre">log.accessfile</span></tt><a class="headerlink" href="#option-log-accessfile" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the file where the access logs will be stored.</p>
</div>
<div class="section" id="option-server-socket-host">
<h7>Option <tt class="docutils literal"><span class="pre">server.socket_host</span></tt><a class="headerlink" href="#option-server-socket-host" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> String</p>
<p><strong>Required:</strong> Yes</p>
<p>Address of the Rest Interface.</p>
</div>
<div class="section" id="option-server-socket-port">
<h7>Option <tt class="docutils literal"><span class="pre">server.socket_port</span></tt><a class="headerlink" href="#option-server-socket-port" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Port where the Rest Interface is listening.</p>
</div>
<div class="section" id="option-server-thread-pool">
<h7>Option <tt class="docutils literal"><span class="pre">server.thread_pool</span></tt><a class="headerlink" href="#option-server-thread-pool" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> Integer</p>
<p><strong>Required:</strong> Yes</p>
<p>Number of concurrent threads.</p>
</div>
<div class="section" id="option-server-ssl-module">
<h7>Option <tt class="docutils literal"><span class="pre">server.ssl_module</span></tt><a class="headerlink" href="#option-server-ssl-module" title="Permalink to this headline">¶</a></h7>
<p><strong>Valid values:</strong> <tt class="docutils literal"><span class="pre">builtin</span></tt>, <tt class="docutils literal"><span class="pre">pyopenssl</span></tt></p>
<p><strong>Required:</strong> Yes</p>
<p>Determine the ssl module.</p>
</div>
<div class="section" id="option-server-ssl-certificate">
<h7>Option <tt class="docutils literal"><span class="pre">server.ssl_certificate</span></tt><a class="headerlink" href="#option-server-ssl-certificate" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> ssl-cert</p>
<p><strong>Required:</strong> No</p>
<p>Location of the certificate used for https. If this option is not provided the protocol will be http.</p>
</div>
<div class="section" id="option-server-ssl-private-key">
<h7>Option <tt class="docutils literal"><span class="pre">server.ssl_private_key</span></tt><a class="headerlink" href="#option-server-ssl-private-key" title="Permalink to this headline">¶</a></h7>
<p><strong>Type:</strong> log-file</p>
<p><strong>Required:</strong> Yes</p>
<p>Location of the certificate key for the certificate specified in <tt class="docutils literal"><span class="pre">server.ssl_certificate</span></tt>. If this option is not provided
the protocol will be http.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-modules_india"></span><div class="section" id="configuring-a-module-for-futuregrid-software">
<span id="modules-india"></span><h4>Configuring a Module for FutureGrid Software<a class="headerlink" href="#configuring-a-module-for-futuregrid-software" title="Permalink to this headline">¶</a></h4>
<p>The software packages on the FutureGrid machines is manage using the <a class="reference external" href="http://modules.sourceforge.net/">Environment Modules</a>.
The Environment Modules package provides for the dynamic modification of a user&#8217;s environment via modulefiles.</p>
<p>In this section, we explain how to create a module for our software.</p>
<ol class="arabic">
<li><p class="first">Create a directory to place the software <tt class="docutils literal"><span class="pre">/N/soft/futuregrid-1.0/</span></tt>.</p>
</li>
<li><p class="first">Locate the directory where Modules is installed. In the case of India, this is installed in <tt class="docutils literal"><span class="pre">/opt/Modules/</span></tt>. From now on
we will refer to this location as <tt class="docutils literal"><span class="pre">$MODULES_PATH</span></tt>.</p>
</li>
<li><p class="first">Create a directory in <tt class="docutils literal"><span class="pre">$MODULES_PATH/default/modulefiles/tools/futuregrid</span></tt></p>
</li>
<li><p class="first">In this directory we need to create a file with the version number. In this example the file is named 1.0. The content of this file
is some information about the software location and the list of modules that need to be loaded as requirements.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c">#%Module1.0#########################################################</span>

<span class="nb">set </span>ver 1.0
<span class="nb">set </span>path /N/soft/futuregrid-<span class="nv">$ver</span>

proc ModulesHelp <span class="o">{</span> <span class="o">}</span> <span class="o">{</span>
puts stderr <span class="s2">&quot;This module adds the FutureGrid toolkit to your environment&quot;</span>
<span class="o">}</span>

module-whatis <span class="s2">&quot;Configures your environment for the FutureGrid toolkit&quot;</span>

prepend-path PATH <span class="nv">$path</span>
prepend-path PATH <span class="nv">$path</span>/bin/

<span class="k">if</span> <span class="o">[</span> module-info mode load <span class="o">]</span> <span class="o">{</span>
puts stderr <span class="s2">&quot;futuregrid version $ver loaded&quot;</span>
<span class="o">}</span>

<span class="k">if</span> <span class="o">[</span> module-info mode switch2 <span class="o">]</span> <span class="o">{</span>
puts stderr <span class="s2">&quot;futuregrid version $ver loaded&quot;</span>
<span class="o">}</span>

<span class="k">if</span> <span class="o">[</span> module-info mode remove <span class="o">]</span> <span class="o">{</span>
puts stderr <span class="s2">&quot;futuregrid version $ver unloaded&quot;</span>
<span class="o">}</span>

module load euca2ools
module load python_w-cmd2
module load moab
module load torque
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the python is not the one installed in the system, the binaries may be inside your python directory.</p>
</div>
<ol class="arabic simple">
<li>In case the software binaries were copied into <tt class="docutils literal"><span class="pre">/usr/bin</span></tt> or <tt class="docutils literal"><span class="pre">/usr/local/bin</span></tt>. We need to move them to the directory
<tt class="docutils literal"><span class="pre">/N/soft/futuregrid-1.0/bin/</span></tt></li>
</ol>
</div>
<span id="document-build_doc"></span><div class="section" id="building-the-rain-documentation">
<span id="build-doc"></span><h4>Building the Rain Documentation<a class="headerlink" href="#building-the-rain-documentation" title="Permalink to this headline">¶</a></h4>
<p>The documentation has been created using <a class="reference external" href="http://sphinx.pocoo.org/">Sphinx</a> and therefore you have to build it before you can see the final html files. The source
files of the documentation can be found under the <tt class="docutils literal"><span class="pre">doc</span></tt> directory of our software package. Next, we define the needed steps to build the documentation.</p>
<ol class="arabic">
<li><p class="first">Install the documentation <a class="reference internal" href="index.html#source-tarball"><em>Using a source tarball</em></a> or <a class="reference internal" href="index.html#github-install"><em>Downloading the latest code from GitHub</em></a>.</p>
</li>
<li><p class="first">Change your current directory to the <tt class="docutils literal"><span class="pre">doc</span></tt> one.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">cd </span>doc
</pre></div>
</div>
</li>
<li><p class="first">Build the documentation using the Makefile.</p>
<div class="highlight-bash"><div class="highlight"><pre>make website
</pre></div>
</div>
</li>
<li><p class="first">The documentation should be in the directory <tt class="docutils literal"><span class="pre">build/web-&lt;version&gt;/</span></tt>. This basically contains html files that can be copied to a regular http server.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="developer-documentation">
<h3>Developer Documentation<a class="headerlink" href="#developer-documentation" title="Permalink to this headline">¶</a></h3>
<p>In this section you will find information on lower level programming details.</p>
<div class="toctree-wrapper compound">
<span id="document-dev_shell"></span><div class="section" id="fg-shell-development">
<span id="chap-dev-shell"></span><h4>FG-Shell Development<a class="headerlink" href="#fg-shell-development" title="Permalink to this headline">¶</a></h4>
<p>In this section we explain how to develop a new module for the FutureGrid Shell. More information can be found in the <a class="reference internal" href="index.html#man-shell"><em>FutureGrid Shell Manual</em></a>.</p>
<div class="section" id="requirement">
<h5>Requirement<a class="headerlink" href="#requirement" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Download the FutureGrid code:</p>
<div class="highlight-bash"><div class="highlight"><pre>git clone git@github.com:futuregrid/rain.git
</pre></div>
</div>
</li>
<li><p class="first">Create a branch</p>
<div class="highlight-bash"><div class="highlight"><pre>git checkout -b &lt;branch_name&gt;
</pre></div>
</div>
</li>
<li><p class="first">Install in developer mode:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo python setup.py develop
</pre></div>
</div>
</li>
<li><p class="first">Copy configuration files from etc directory to /etc/futuregrid or to ~/.fg/  and set them up (:ref:admin)</p>
</li>
</ul>
</div>
<div class="section" id="add-your-component-functionality-as-a-new-module">
<h5>Add Your Component Functionality as a New Module<a class="headerlink" href="#add-your-component-functionality-as-a-new-module" title="Permalink to this headline">¶</a></h5>
<p>Next, we explain the steps needed to include a new module in the FutureGrid shell. As an example, we use the
repository module, called &#8220;repo&#8221;</p>
<ol class="arabic">
<li><p class="first">Create a file to develop your functionality. This file will be called fgShellRepo.py and will be located in
src/futuregrid/shell/ (change Repo with your module name). The file includes a class with the same name that inherits
from cmd2. See the fgShellRepo.py file for more details.</p>
</li>
<li><p class="first">Add your methods that has to be like &#8220;do_&lt;module&gt;&lt;method&gt;&#8221; i.e. do_repoget. In this way, in the shell we will have a
command called repoget. You can also include a method called help_repoget that show information when execute &#8220;help repoget&#8221;
in the shell.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These methods will not have functionality. They only are a new command line interface for your existing methods.
In the repository example, the functionality is in the class IRServiceProxy.</p>
</div>
</li>
<li><p class="first">Go to file fgCLI.py and make the fgShell class to inherit from your class. For that you have to do three steps</p>
<ul>
<li><p class="first">Import your class.</p>
<div class="highlight-bash"><div class="highlight"><pre>from futuregrid.shell.fgShellRepo import fgShellRepo
</pre></div>
</div>
</li>
<li><p class="first">Add it to the fgShell class.</p>
<div class="highlight-bash"><div class="highlight"><pre>classfgShell<span class="o">(</span>Cmd,
             fgShellUtils,
             fgShellRepo<span class="o">)</span>:
</pre></div>
</div>
</li>
<li><p class="first">We have the list of available commands in a set called self.env to determine the available contexts (each module
will have a context, see section Contexts). Here you have to add the name of your context as a string. This variable
is in the constructor of the class fgShell (__init__(...)) and looks like:</p>
<div class="highlight-bash"><div class="highlight"><pre>self.env<span class="o">=[</span><span class="s2">&quot;repo&quot;</span>,<span class="s2">&quot;rain&quot;</span>,<span class="s2">&quot;&quot;</span><span class="o">]</span>
</pre></div>
</div>
</li>
<li><p class="first">In the constructor we also have to write some information about the module.</p>
<div class="highlight-bash"><pre>self.text = {'repo': 'Image Repository,
             'rain': 'FG Dynamic Provisioning'}</pre>
</div>
</li>
<li><p class="first">Next, we have to specify the modules that are required for the new. In this way, we only initialize the components
that the user needs. This is done in the do_use method (see next section Contexts) of the fgCLI.py file. Thus, we need
to add a condition and a list of requirements that the new module has. Note that the requirements strings MUST be as in
the name of the classes that usually have the first character in uppercase.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="nv">arg</span><span class="o">==</span><span class="s2">&quot;repo&quot;</span><span class="o">)</span>:
   <span class="nv">requirements</span><span class="o">=[</span><span class="s2">&quot;Repo&quot;</span><span class="o">]</span>
<span class="k">elif</span> <span class="o">(</span><span class="nv">arg</span> <span class="o">==</span> <span class="s2">&quot;rain&quot;</span><span class="o">)</span>:
   <span class="nv">requirements</span><span class="o">=[</span><span class="s2">&quot;Repo&quot;</span>,<span class="s2">&quot;Image&quot;</span>,<span class="s2">&quot;Rain&quot;</span><span class="o">]</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p class="first">Attention to the arguments of your methods. No matter how many arguments you have, all them are sent in a unique string.
Then, in your method you have to get them by using the  “getArgs(in: string): list” method, that is in the fgShellUtils class.</p>
</li>
<li><p class="first">In your class (fgShellRepo in this example) you will have an  __init__ method to initialize your module. However, it will
be called only if you change to your module&#8217;s context, see next Section.</p>
</li>
</ol>
</div>
<div class="section" id="contexts">
<h5>Contexts<a class="headerlink" href="#contexts" title="Permalink to this headline">¶</a></h5>
<p>We have created contexts make easier the use of the FutureGrid commands by removing the prefix of your module. For that we have
the show and use command. The show command list the available contexts and the use command change to a particular context. In this
way, we can change to the repo context by executing “use repo”. Note that the prompt change from “fg&gt;” to “fg-repo&gt;” Now, the get
command point to the repoget command.</p>
<p>We have already done several steps focused to enable the context. Here, we explain some other optional steps, but highly
recommendable. All this is done in the fgShellUtils.py file.</p>
<ol class="arabic">
<li><p class="first">If your have a command that is already in this class, you do not need to add anything to it.</p>
</li>
<li><p class="first">If your command is not in this class, you can add it by creating a method. For example, let assume that you have a hello method.</p>
<div class="highlight-bash"><div class="highlight"><pre>def do_hello<span class="o">(</span>self, args<span class="o">)</span>:
    <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    Generic get command that changes its behavior depending on the</span>
<span class="s2">    context specified with use command.</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="k">if</span><span class="o">(</span>self._use !<span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">)</span>:
        <span class="nv">found</span> <span class="o">=</span> False
        <span class="k">for </span>i in self._requirements:
            <span class="nv">prefix</span><span class="o">=</span>string.lower<span class="o">(</span>i<span class="o">)</span>
            <span class="nb">command</span> <span class="o">=</span> <span class="s2">&quot;self.do_&quot;</span> + prefix + <span class="s2">&quot;hello(\&quot;&quot;</span> + args + <span class="s2">&quot;\&quot;)&quot;</span>
            try:
                <span class="nb">eval</span><span class="o">(</span><span class="nb">command</span><span class="o">)</span>
                <span class="nv">found</span> <span class="o">=</span> True
                <span class="nb">break</span>
<span class="nb">            </span>except AttributeError:
                pass
        <span class="k">if </span>not found:
            print <span class="s2">&quot;There is no hello method in any of the active contexts (&quot;</span> + str<span class="o">(</span>self.requirements<span class="o">)</span> + <span class="s2">&quot; )&quot;</span>
            self._log.error<span class="o">(</span>str<span class="o">(</span>sys.exc_info<span class="o">()))</span>
    <span class="k">else</span>:
        self.generic_error<span class="o">()</span>

<span class="nv">help_hello</span> <span class="o">=</span> generic_help
</pre></div>
</div>
</li>
<li><p class="first">This code will call a different method depending of the context. If your context is &#8220;repo&#8221;, you need to have a method called
do_repohello(args) in your fgShellRepo class.</p>
</li>
</ol>
</div>
<div class="section" id="log-file">
<h5>Log File<a class="headerlink" href="#log-file" title="Permalink to this headline">¶</a></h5>
<p>We have created a log file system to be use in the Shell. To use it, you only need to import the fgLog.py file:</p>
<p>from futuregrid.utils import fgLog
Then you can write in the logs using any of this methods:</p>
<div class="highlight-bash"><div class="highlight"><pre>fgLog.degug<span class="o">(</span>“text”<span class="o">)</span>
fgLog.error<span class="o">(</span>“text”<span class="o">)</span>
fgLog.warning<span class="o">(</span>“text”<span class="o">)</span>
fgLog.info<span class="o">(</span>“text”<span class="o">)</span>
</pre></div>
</div>
<p>The log file will be store in log file specified in the &#8220;fg-shell&#8221; section of the fg-client.conf configuration file. This file
is placed in /etc/futuregrid/ or in ~/.fg/</p>
</div>
<div class="section" id="commit-the-changes">
<h5>Commit the Changes<a class="headerlink" href="#commit-the-changes" title="Permalink to this headline">¶</a></h5>
<p>After you have created your new module, you need to push your branch into github and request to merge it with the official dev branch.</p>
<ol class="arabic">
<li><p class="first">Upload new branch to github</p>
<div class="highlight-bash"><div class="highlight"><pre>git push origin &lt;branch_name&gt;
</pre></div>
</div>
</li>
<li><p class="first">Send us a message via github to merge the code</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<span id="document-download"></span><span class="target" id="downloads"></span><div class="section" id="download">
<h2>Download<a class="headerlink" href="#download" title="Permalink to this headline">¶</a></h2>
<p>The latest version of the FutureGrid Rain is 1.0</p>
<p>The recommended way of installing Rain is using <tt class="docutils literal"><span class="pre">easy_install</span></tt>. You can find instructions on how to do this in the
<a class="reference internal" href="index.html#chap-install-futuregrid"><em>Installation</em></a> chapter of the documentation.</p>
<p>If you do need to download Rain as an installable Python Egg or as a source
tarball, both are available for download in the Python Package Index: <a class="reference external" href="http://pypi.python.org/pypi/futuregrid">http://pypi.python.org/pypi/futuregrid</a></p>
<div class="section" id="sample-files">
<h3>Sample files<a class="headerlink" href="#sample-files" title="Permalink to this headline">¶</a></h3>
<p>The sample configuration files shown in the documentation are available for download as a
<a class="reference external" href="futuregrid-docs-configsamples_1.0.tar.gz">tarball</a> or a <a class="reference external" href="futuregrid-docs-configsamples_1.0.zip">ZIP file</a>.</p>
</div>
<div class="section" id="development-version">
<h3>Development version<a class="headerlink" href="#development-version" title="Permalink to this headline">¶</a></h3>
<p>If you want to use the latest development version of Rain, you can
track our <a class="reference external" href="https://github.com/futuregrid/rain">GitHub repository</a>.</p>
<p>The <a class="reference internal" href="index.html#chap-install-futuregrid"><em>Installation</em></a> chapter of the documentation provides
instructions on how to check out our code from GitHub.</p>
</div>
</div>
<span id="document-support"></span><div class="section" id="support">
<span id="id1"></span><h2>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h2>
<p>If you run into problems when using FutureGrid Rain and Image Management, please use our
help form at <a class="reference external" href="https://portal.futuregrid.org/help">https://portal.futuregrid.org/help</a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="index.html#document-index">Home</a>|&nbsp;</li>
        <li><a href="index.html#document-whatis">What is it?</a>|&nbsp;</li>
        <li><a href="index.html#document-quickstart">Quickstart</a>|&nbsp;</li>
        <li><a href="index.html#document-documentation">Documentation</a>|&nbsp;</li>
        <li><a href="index.html#document-download">Download</a>|&nbsp;</li>
        <li><a href="index.html#document-support">Support</a>|&nbsp;</li>
        <li><a href="https://portal.futuregrid.org/">Portal</a>|&nbsp;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, The FutureGrid Team.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>